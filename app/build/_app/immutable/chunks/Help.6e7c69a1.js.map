{"version":3,"file":"Help.6e7c69a1.js","sources":["../../../../../../node_modules/bits-ui/dist/bits/menu/components/menu-sub.svelte","../../../../../../node_modules/bits-ui/dist/bits/menu/components/menu-sub-content.svelte","../../../../../../node_modules/bits-ui/dist/bits/menu/components/menu-sub-trigger.svelte","../../../../../../node_modules/eventsource-parser/dist/index.js","../../../../../../node_modules/eventsource-parser/dist/stream.js","../../../../../../src/lib/apis/streaming/index.ts","../../../../../../src/lib/components/common/Banner.svelte","../../../../../../src/lib/components/chat/MessageInput/PromptCommands.svelte","../../../../../../src/lib/components/chat/MessageInput/Documents.svelte","../../../../../../src/lib/components/chat/MessageInput/Models.svelte","../../../../../../src/lib/components/icons/XMark.svelte","../../../../../../src/lib/components/icons/DocumentArrowUpSolid.svelte","../../../../../../src/lib/components/icons/GlobeAltSolid.svelte","../../../../../../src/lib/components/icons/WrenchSolid.svelte","../../../../../../src/lib/components/chat/MessageInput/InputMenu.svelte","../../../../../../src/lib/components/icons/Headphone.svelte","../../../../../../src/lib/components/chat/MessageInput/VoiceRecording.svelte","../../../../../../src/lib/components/chat/MessageInput/FilesOverlay.svelte","../../../../../../src/lib/components/chat/MessageInput.svelte","../../../../../../src/lib/components/chat/ModelSelector.svelte","../../../../../../src/lib/components/layout/Navbar/Menu.svelte","../../../../../../src/lib/components/icons/AdjustmentsHorizontal.svelte","../../../../../../src/lib/components/layout/Navbar.svelte","../../../../../../src/lib/components/chat/MessageInput/CallOverlay/VideoInputMenu.svelte","../../../../../../src/lib/components/chat/MessageInput/CallOverlay.svelte","../../../../../../src/lib/components/chat/Controls/Controls.svelte","../../../../../../src/lib/components/chat/ChatControls.svelte","../../../../../../src/lib/components/chat/Chat.svelte","../../../../../../src/lib/components/chat/ShortcutsModal.svelte","../../../../../../src/lib/components/icons/QuestionMarkCircle.svelte","../../../../../../src/lib/components/icons/Keyboard.svelte","../../../../../../src/lib/components/layout/Help/HelpMenu.svelte","../../../../../../src/lib/components/layout/Help.svelte"],"sourcesContent":["<script>import { derived } from \"svelte/store\";\nimport { setSubMenuCtx } from \"../ctx.js\";\nexport let disabled = void 0;\nexport let open = void 0;\nexport let onOpenChange = void 0;\nconst {\n  updateOption,\n  ids,\n  states: { subOpen }\n} = setSubMenuCtx({\n  disabled,\n  onOpenChange: ({ next }) => {\n    if (open !== next) {\n      onOpenChange?.(next);\n      open = next;\n    }\n    return next;\n  }\n});\nconst idValues = derived([ids.menu, ids.trigger], ([$menuId, $triggerId]) => ({\n  menu: $menuId,\n  trigger: $triggerId\n}));\n$:\n  open !== void 0 && subOpen.set(open);\n$:\n  updateOption(\"disabled\", disabled);\n</script>\n\n<slot subIds={$idValues} />\n","<script>import { melt } from \"@melt-ui/svelte\";\nimport { createDispatcher } from \"../../../internal/index.js\";\nimport { getSubmenuCtx, updateSubPositioning } from \"../ctx.js\";\nexport let transition = void 0;\nexport let transitionConfig = void 0;\nexport let inTransition = void 0;\nexport let inTransitionConfig = void 0;\nexport let outTransition = void 0;\nexport let outTransitionConfig = void 0;\nexport let asChild = false;\nexport let id = void 0;\nexport let side = \"right\";\nexport let align = \"start\";\nexport let sideOffset = 0;\nexport let alignOffset = 0;\nexport let collisionPadding = 8;\nexport let avoidCollisions = true;\nexport let collisionBoundary = void 0;\nexport let sameWidth = false;\nexport let fitViewport = false;\nexport let strategy = \"absolute\";\nexport let overlap = false;\nexport let el = void 0;\nconst {\n  elements: { subMenu },\n  states: { subOpen },\n  ids,\n  getAttrs\n} = getSubmenuCtx();\nconst dispatch = createDispatcher();\nconst attrs = getAttrs(\"sub-content\");\n$:\n  if (id) {\n    ids.menu.set(id);\n  }\n$:\n  builder = $subMenu;\n$:\n  Object.assign(builder, attrs);\n$:\n  updateSubPositioning({\n    side,\n    align,\n    sideOffset,\n    alignOffset,\n    collisionPadding,\n    avoidCollisions,\n    collisionBoundary,\n    sameWidth,\n    fitViewport,\n    strategy,\n    overlap\n  });\n</script>\n\n{#if asChild && $subOpen}\n\t<slot {builder} />\n{:else if transition && $subOpen}\n\t<div\n\t\tbind:this={el}\n\t\ttransition:transition={transitionConfig}\n\t\t{...builder} use:builder.action\n\t\t{...$$restProps}\n\t\ton:m-focusout={dispatch}\n\t\ton:m-keydown={dispatch}\n\t\ton:m-pointermove={dispatch}\n\t>\n\t\t<slot {builder} />\n\t</div>\n{:else if inTransition && outTransition && $subOpen}\n\t<div\n\t\tbind:this={el}\n\t\tin:inTransition={inTransitionConfig}\n\t\tout:outTransition={outTransitionConfig}\n\t\t{...builder} use:builder.action\n\t\t{...$$restProps}\n\t\ton:m-focusout={dispatch}\n\t\ton:m-keydown={dispatch}\n\t\ton:m-pointermove={dispatch}\n\t>\n\t\t<slot {builder} />\n\t</div>\n{:else if inTransition && $subOpen}\n\t<div\n\t\tbind:this={el}\n\t\tin:inTransition={inTransitionConfig}\n\t\t{...builder} use:builder.action\n\t\t{...$$restProps}\n\t\ton:m-focusout={dispatch}\n\t\ton:m-keydown={dispatch}\n\t\ton:m-pointermove={dispatch}\n\t>\n\t\t<slot {builder} />\n\t</div>\n{:else if outTransition && $subOpen}\n\t<div\n\t\tbind:this={el}\n\t\tout:outTransition={outTransitionConfig}\n\t\t{...builder} use:builder.action\n\t\t{...$$restProps}\n\t\ton:m-focusout={dispatch}\n\t\ton:m-keydown={dispatch}\n\t\ton:m-pointermove={dispatch}\n\t>\n\t\t<slot {builder} />\n\t</div>\n{:else if $subOpen}\n\t<div\n\t\tbind:this={el}\n\t\t{...builder} use:builder.action\n\t\t{...$$restProps}\n\t\ton:m-focusout={dispatch}\n\t\ton:m-keydown={dispatch}\n\t\ton:m-pointermove={dispatch}\n\t>\n\t\t<slot {builder} />\n\t</div>\n{/if}\n","<script>import { melt } from \"@melt-ui/svelte\";\nimport { disabledAttrs } from \"../../../internal/index.js\";\nimport { getSubTrigger } from \"../ctx.js\";\nimport { createDispatcher } from \"../../../internal/events.js\";\nexport let disabled = false;\nexport let asChild = false;\nexport let id = void 0;\nexport let el = void 0;\nconst {\n  elements: { subTrigger },\n  ids,\n  getAttrs,\n  options\n} = getSubTrigger();\nconst { disabled: disabledStore } = options;\nconst dispatch = createDispatcher();\n$:\n  if (id) {\n    ids.trigger.set(id);\n  }\n$:\n  builder = $subTrigger;\n$:\n  attrs = {\n    ...getAttrs(\"sub-trigger\"),\n    ...disabledAttrs(disabled || $disabledStore)\n  };\n$:\n  Object.assign(builder, attrs);\n</script>\n\n{#if asChild}\n\t<slot {builder} />\n{:else}\n\t<div\n\t\tbind:this={el}\n\t\t{...builder} use:builder.action\n\t\t{...$$restProps}\n\t\ton:m-click={dispatch}\n\t\ton:m-focusin={dispatch}\n\t\ton:m-focusout={dispatch}\n\t\ton:m-keydown={dispatch}\n\t\ton:m-pointerleave={dispatch}\n\t\ton:m-pointermove={dispatch}\n\t>\n\t\t<slot {builder} />\n\t</div>\n{/if}\n","function createParser(onParse) {\n  let isFirstChunk;\n  let buffer;\n  let startingPosition;\n  let startingFieldLength;\n  let eventId;\n  let eventName;\n  let data;\n  reset();\n  return {\n    feed,\n    reset\n  };\n  function reset() {\n    isFirstChunk = true;\n    buffer = \"\";\n    startingPosition = 0;\n    startingFieldLength = -1;\n    eventId = void 0;\n    eventName = void 0;\n    data = \"\";\n  }\n  function feed(chunk) {\n    buffer = buffer ? buffer + chunk : chunk;\n    if (isFirstChunk && hasBom(buffer)) {\n      buffer = buffer.slice(BOM.length);\n    }\n    isFirstChunk = false;\n    const length = buffer.length;\n    let position = 0;\n    let discardTrailingNewline = false;\n    while (position < length) {\n      if (discardTrailingNewline) {\n        if (buffer[position] === \"\\n\") {\n          ++position;\n        }\n        discardTrailingNewline = false;\n      }\n      let lineLength = -1;\n      let fieldLength = startingFieldLength;\n      let character;\n      for (let index = startingPosition; lineLength < 0 && index < length; ++index) {\n        character = buffer[index];\n        if (character === \":\" && fieldLength < 0) {\n          fieldLength = index - position;\n        } else if (character === \"\\r\") {\n          discardTrailingNewline = true;\n          lineLength = index - position;\n        } else if (character === \"\\n\") {\n          lineLength = index - position;\n        }\n      }\n      if (lineLength < 0) {\n        startingPosition = length - position;\n        startingFieldLength = fieldLength;\n        break;\n      } else {\n        startingPosition = 0;\n        startingFieldLength = -1;\n      }\n      parseEventStreamLine(buffer, position, fieldLength, lineLength);\n      position += lineLength + 1;\n    }\n    if (position === length) {\n      buffer = \"\";\n    } else if (position > 0) {\n      buffer = buffer.slice(position);\n    }\n  }\n  function parseEventStreamLine(lineBuffer, index, fieldLength, lineLength) {\n    if (lineLength === 0) {\n      if (data.length > 0) {\n        onParse({\n          type: \"event\",\n          id: eventId,\n          event: eventName || void 0,\n          data: data.slice(0, -1)\n          // remove trailing newline\n        });\n\n        data = \"\";\n        eventId = void 0;\n      }\n      eventName = void 0;\n      return;\n    }\n    const noValue = fieldLength < 0;\n    const field = lineBuffer.slice(index, index + (noValue ? lineLength : fieldLength));\n    let step = 0;\n    if (noValue) {\n      step = lineLength;\n    } else if (lineBuffer[index + fieldLength + 1] === \" \") {\n      step = fieldLength + 2;\n    } else {\n      step = fieldLength + 1;\n    }\n    const position = index + step;\n    const valueLength = lineLength - step;\n    const value = lineBuffer.slice(position, position + valueLength).toString();\n    if (field === \"data\") {\n      data += value ? \"\".concat(value, \"\\n\") : \"\\n\";\n    } else if (field === \"event\") {\n      eventName = value;\n    } else if (field === \"id\" && !value.includes(\"\\0\")) {\n      eventId = value;\n    } else if (field === \"retry\") {\n      const retry = parseInt(value, 10);\n      if (!Number.isNaN(retry)) {\n        onParse({\n          type: \"reconnect-interval\",\n          value: retry\n        });\n      }\n    }\n  }\n}\nconst BOM = [239, 187, 191];\nfunction hasBom(buffer) {\n  return BOM.every((charCode, index) => buffer.charCodeAt(index) === charCode);\n}\nexport { createParser };\n//# sourceMappingURL=index.js.map\n","import { createParser } from './index.js';\nclass EventSourceParserStream extends TransformStream {\n  constructor() {\n    let parser;\n    super({\n      start(controller) {\n        parser = createParser(event => {\n          if (event.type === \"event\") {\n            controller.enqueue(event);\n          }\n        });\n      },\n      transform(chunk) {\n        parser.feed(chunk);\n      }\n    });\n  }\n}\nexport { EventSourceParserStream };\n//# sourceMappingURL=stream.js.map\n","import { EventSourceParserStream } from 'eventsource-parser/stream';\nimport type { ParsedEvent } from 'eventsource-parser';\n\ntype TextStreamUpdate = {\n\tdone: boolean;\n\tvalue: string;\n\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\n\tcitations?: any;\n\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\n\terror?: any;\n\tusage?: ResponseUsage;\n};\n\ntype ResponseUsage = {\n\t/** Including images and tools if any */\n\tprompt_tokens: number;\n\t/** The tokens generated */\n\tcompletion_tokens: number;\n\t/** Sum of the above two fields */\n\ttotal_tokens: number;\n};\n\n// createOpenAITextStream takes a responseBody with a SSE response,\n// and returns an async generator that emits delta updates with large deltas chunked into random sized chunks\nexport async function createOpenAITextStream(\n\tresponseBody: ReadableStream<Uint8Array>,\n\tsplitLargeDeltas: boolean\n): Promise<AsyncGenerator<TextStreamUpdate>> {\n\tconst eventStream = responseBody\n\t\t.pipeThrough(new TextDecoderStream())\n\t\t.pipeThrough(new EventSourceParserStream())\n\t\t.getReader();\n\tlet iterator = openAIStreamToIterator(eventStream);\n\tif (splitLargeDeltas) {\n\t\titerator = streamLargeDeltasAsRandomChunks(iterator);\n\t}\n\treturn iterator;\n}\n\nasync function* openAIStreamToIterator(\n\treader: ReadableStreamDefaultReader<ParsedEvent>\n): AsyncGenerator<TextStreamUpdate> {\n\twhile (true) {\n\t\tconst { value, done } = await reader.read();\n\t\tif (done) {\n\t\t\tyield { done: true, value: '' };\n\t\t\tbreak;\n\t\t}\n\t\tif (!value) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst data = value.data;\n\t\tif (data.startsWith('[DONE]')) {\n\t\t\tyield { done: true, value: '' };\n\t\t\tbreak;\n\t\t}\n\n\t\ttry {\n\t\t\tconst parsedData = JSON.parse(data);\n\t\t\tconsole.log(parsedData);\n\n\t\t\tif (parsedData.error) {\n\t\t\t\tyield { done: true, value: '', error: parsedData.error };\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tif (parsedData.citations) {\n\t\t\t\tyield { done: false, value: '', citations: parsedData.citations };\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tyield {\n\t\t\t\tdone: false,\n\t\t\t\tvalue: parsedData.choices?.[0]?.delta?.content ?? '',\n\t\t\t\tusage: parsedData.usage\n\t\t\t};\n\t\t} catch (e) {\n\t\t\tconsole.error('Error extracting delta from SSE event:', e);\n\t\t}\n\t}\n}\n\n// streamLargeDeltasAsRandomChunks will chunk large deltas (length > 5) into random sized chunks between 1-3 characters\n// This is to simulate a more fluid streaming, even though some providers may send large chunks of text at once\nasync function* streamLargeDeltasAsRandomChunks(\n\titerator: AsyncGenerator<TextStreamUpdate>\n): AsyncGenerator<TextStreamUpdate> {\n\tfor await (const textStreamUpdate of iterator) {\n\t\tif (textStreamUpdate.done) {\n\t\t\tyield textStreamUpdate;\n\t\t\treturn;\n\t\t}\n\t\tif (textStreamUpdate.citations) {\n\t\t\tyield textStreamUpdate;\n\t\t\tcontinue;\n\t\t}\n\t\tlet content = textStreamUpdate.value;\n\t\tif (content.length < 5) {\n\t\t\tyield { done: false, value: content };\n\t\t\tcontinue;\n\t\t}\n\t\twhile (content != '') {\n\t\t\tconst chunkSize = Math.min(Math.floor(Math.random() * 3) + 1, content.length);\n\t\t\tconst chunk = content.slice(0, chunkSize);\n\t\t\tyield { done: false, value: chunk };\n\t\t\t// Do not sleep if the tab is hidden\n\t\t\t// Timers are throttled to 1s in hidden tabs\n\t\t\tif (document?.visibilityState !== 'hidden') {\n\t\t\t\tawait sleep(5);\n\t\t\t}\n\t\t\tcontent = content.slice(chunkSize);\n\t\t}\n\t}\n}\n\nconst sleep = (ms: number) => new Promise((resolve) => setTimeout(resolve, ms));\n","<script lang=\"ts\">\n\timport type { Banner } from '$lib/types';\n\timport { onMount, createEventDispatcher } from 'svelte';\n\timport { fade } from 'svelte/transition';\n\n\tconst dispatch = createEventDispatcher();\n\n\texport let banner: Banner = {\n\t\tid: '',\n\t\ttype: 'info',\n\t\ttitle: '',\n\t\tcontent: '',\n\t\turl: '',\n\t\tdismissable: true,\n\t\ttimestamp: Math.floor(Date.now() / 1000)\n\t};\n\n\texport let dismissed = false;\n\n\tlet mounted = false;\n\n\tconst classNames: Record<string, string> = {\n\t\tinfo: 'bg-blue-500/20 text-blue-700 dark:text-blue-200 ',\n\t\tsuccess: 'bg-green-500/20 text-green-700 dark:text-green-200',\n\t\twarning: 'bg-yellow-500/20 text-yellow-700 dark:text-yellow-200',\n\t\terror: 'bg-red-500/20 text-red-700 dark:text-red-200'\n\t};\n\n\tconst dismiss = (id) => {\n\t\tdismissed = true;\n\t\tdispatch('dismiss', id);\n\t};\n\n\tonMount(() => {\n\t\tmounted = true;\n\t});\n</script>\n\n{#if !dismissed}\n\t{#if mounted}\n\t\t<div\n\t\t\tclass=\" top-0 left-0 right-0 p-2 mx-4 px-3 flex justify-center items-center relative rounded-xl border border-gray-50 dark:border-gray-850 text-gray-800 dark:text-gary-100 bg-white dark:bg-gray-900 backdrop-blur-xl z-30\"\n\t\t\ttransition:fade={{ delay: 100, duration: 300 }}\n\t\t>\n\t\t\t<div class=\" flex flex-col md:flex-row md:items-center flex-1 text-sm w-fit gap-1.5\">\n\t\t\t\t<div class=\"flex justify-between self-start\">\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\" text-xs font-bold {classNames[banner.type] ??\n\t\t\t\t\t\t\tclassNames['info']}  w-fit px-2 rounded uppercase line-clamp-1 mr-0.5\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{banner.type}\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{#if banner.url}\n\t\t\t\t\t\t<div class=\"flex md:hidden group w-fit md:items-center\">\n\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\tclass=\"text-gray-700 dark:text-white text-xs font-semibold underline\"\n\t\t\t\t\t\t\t\thref=\"/assets/files/whitepaper.pdf\"\n\t\t\t\t\t\t\t\ttarget=\"_blank\">Learn More</a\n\t\t\t\t\t\t\t>\n\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\" ml-1 text-gray-400 group-hover:text-gray-600 dark:group-hover:text-white\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<!--  -->\n\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\tviewBox=\"0 0 16 16\"\n\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\t\tclass=\"w-4 h-4\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t\td=\"M4.22 11.78a.75.75 0 0 1 0-1.06L9.44 5.5H5.75a.75.75 0 0 1 0-1.5h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V6.56l-5.22 5.22a.75.75 0 0 1-1.06 0Z\"\n\t\t\t\t\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"flex-1 text-xs text-gray-700 dark:text-white\">\n\t\t\t\t\t{banner.content}\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t{#if banner.url}\n\t\t\t\t<div class=\"hidden md:flex group w-fit md:items-center\">\n\t\t\t\t\t<a\n\t\t\t\t\t\tclass=\"text-gray-700 dark:text-white text-xs font-semibold underline\"\n\t\t\t\t\t\thref=\"/\"\n\t\t\t\t\t\ttarget=\"_blank\">Learn More</a\n\t\t\t\t\t>\n\n\t\t\t\t\t<div class=\" ml-1 text-gray-400 group-hover:text-gray-600 dark:group-hover:text-white\">\n\t\t\t\t\t\t<!--  -->\n\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\tviewBox=\"0 0 16 16\"\n\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\tclass=\"size-4\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\t\t\td=\"M4.22 11.78a.75.75 0 0 1 0-1.06L9.44 5.5H5.75a.75.75 0 0 1 0-1.5h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V6.56l-5.22 5.22a.75.75 0 0 1-1.06 0Z\"\n\t\t\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t{/if}\n\t\t\t<div class=\"flex self-start\">\n\t\t\t\t{#if banner.dismissible}\n\t\t\t\t\t<button\n\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\tdismiss(banner.id);\n\t\t\t\t\t\t}}\n\t\t\t\t\t\tclass=\"  -mt-1 -mb-2 -translate-y-[1px] ml-1.5 mr-1 text-gray-400 dark:hover:text-white\"\n\t\t\t\t\t\t>&times;</button\n\t\t\t\t\t>\n\t\t\t\t{/if}\n\t\t\t</div>\n\t\t</div>\n\t{/if}\n{/if}\n","<script lang=\"ts\">\n\timport { prompts } from '$lib/stores';\n\timport { findWordIndices } from '$lib/utils';\n\timport { tick, getContext } from 'svelte';\n\timport { toast } from 'svelte-sonner';\n\n\tconst i18n = getContext('i18n');\n\n\texport let files;\n\texport let prompt = '';\n\tlet selectedCommandIdx = 0;\n\tlet filteredPromptCommands = [];\n\n\t$: filteredPromptCommands = $prompts\n\t\t.filter((p) => p.command.toLowerCase().includes(prompt.toLowerCase()))\n\t\t.sort((a, b) => a.title.localeCompare(b.title));\n\n\t$: if (prompt) {\n\t\tselectedCommandIdx = 0;\n\t}\n\n\texport const selectUp = () => {\n\t\tselectedCommandIdx = Math.max(0, selectedCommandIdx - 1);\n\t};\n\n\texport const selectDown = () => {\n\t\tselectedCommandIdx = Math.min(selectedCommandIdx + 1, filteredPromptCommands.length - 1);\n\t};\n\n\tconst confirmCommand = async (command) => {\n\t\tlet text = command.content;\n\n\t\tif (command.content.includes('{{CLIPBOARD}}')) {\n\t\t\tconst clipboardText = await navigator.clipboard.readText().catch((err) => {\n\t\t\t\ttoast.error($i18n.t('Failed to read clipboard contents'));\n\t\t\t\treturn '{{CLIPBOARD}}';\n\t\t\t});\n\n\t\t\tconsole.log(clipboardText);\n\n\t\t\tconst clipboardItems = await navigator.clipboard.read();\n\n\t\t\tlet imageUrl = null;\n\t\t\tfor (const item of clipboardItems) {\n\t\t\t\t// Check for known image types\n\t\t\t\tfor (const type of item.types) {\n\t\t\t\t\tif (type.startsWith('image/')) {\n\t\t\t\t\t\tconst blob = await item.getType(type);\n\t\t\t\t\t\timageUrl = URL.createObjectURL(blob);\n\t\t\t\t\t\tconsole.log(`Image URL (${type}): ${imageUrl}`);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (imageUrl) {\n\t\t\t\tfiles = [\n\t\t\t\t\t...files,\n\t\t\t\t\t{\n\t\t\t\t\t\ttype: 'image',\n\t\t\t\t\t\turl: imageUrl\n\t\t\t\t\t}\n\t\t\t\t];\n\t\t\t}\n\n\t\t\ttext = command.content.replaceAll('{{CLIPBOARD}}', clipboardText);\n\t\t}\n\n\t\tprompt = text;\n\n\t\tconst chatInputElement = document.getElementById('chat-textarea');\n\n\t\tawait tick();\n\n\t\tchatInputElement.style.height = '';\n\t\tchatInputElement.style.height = Math.min(chatInputElement.scrollHeight, 200) + 'px';\n\n\t\tchatInputElement?.focus();\n\n\t\tawait tick();\n\n\t\tconst words = findWordIndices(prompt);\n\n\t\tif (words.length > 0) {\n\t\t\tconst word = words.at(0);\n\t\t\tchatInputElement.setSelectionRange(word?.startIndex, word.endIndex + 1);\n\t\t}\n\t};\n</script>\n\n{#if filteredPromptCommands.length > 0}\n\t<div class=\"pl-1 pr-12 mb-3 text-left w-full absolute bottom-0 left-0 right-0 z-10\">\n\t\t<div class=\"flex w-full dark:border dark:border-gray-850 rounded-lg\">\n\t\t\t<div class=\"  bg-gray-50 dark:bg-gray-850 w-10 rounded-l-lg text-center\">\n\t\t\t\t<div class=\" text-lg font-semibold mt-2\">/</div>\n\t\t\t</div>\n\n\t\t\t<div\n\t\t\t\tclass=\"max-h-60 flex flex-col w-full rounded-r-lg bg-white dark:bg-gray-900 dark:text-gray-100\"\n\t\t\t>\n\t\t\t\t<div class=\"m-1 overflow-y-auto p-1 rounded-r-lg space-y-0.5 scrollbar-hidden\">\n\t\t\t\t\t{#each filteredPromptCommands as command, commandIdx}\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclass=\" px-3 py-1.5 rounded-xl w-full text-left {commandIdx === selectedCommandIdx\n\t\t\t\t\t\t\t\t? '  bg-gray-50 dark:bg-gray-850 selected-command-option-button'\n\t\t\t\t\t\t\t\t: ''}\"\n\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\tconfirmCommand(command);\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\ton:mousemove={() => {\n\t\t\t\t\t\t\t\tselectedCommandIdx = commandIdx;\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\ton:focus={() => {}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div class=\" font-medium text-black dark:text-gray-100\">\n\t\t\t\t\t\t\t\t{command.command}\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div class=\" text-xs text-gray-600 dark:text-gray-100\">\n\t\t\t\t\t\t\t\t{command.title}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t{/each}\n\t\t\t\t</div>\n\n\t\t\t\t<div\n\t\t\t\t\tclass=\" px-2 pb-1 text-xs text-gray-600 dark:text-gray-100 bg-white dark:bg-gray-900 rounded-br-xl flex items-center space-x-1\"\n\t\t\t\t>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\tstroke-width=\"1.5\"\n\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\tclass=\"w-3 h-3\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\td=\"m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"line-clamp-1\">\n\t\t\t\t\t\t{$i18n.t(\n\t\t\t\t\t\t\t'Tip: Update multiple variable slots consecutively by pressing the tab key in the chat input after each replacement.'\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n{/if}\n","<script lang=\"ts\">\n\timport { createEventDispatcher } from 'svelte';\n\n\timport { documents } from '$lib/stores';\n\timport { removeFirstHashWord, isValidHttpUrl } from '$lib/utils';\n\timport { tick, getContext } from 'svelte';\n\timport { toast } from 'svelte-sonner';\n\n\tconst i18n = getContext('i18n');\n\n\texport let prompt = '';\n\n\tconst dispatch = createEventDispatcher();\n\tlet selectedIdx = 0;\n\n\tlet filteredItems = [];\n\tlet filteredDocs = [];\n\n\tlet collections = [];\n\n\t$: collections = [\n\t\t...($documents.length > 0\n\t\t\t? [\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'All Documents',\n\t\t\t\t\t\ttype: 'collection',\n\t\t\t\t\t\ttitle: $i18n.t('All Documents'),\n\t\t\t\t\t\tcollection_names: $documents.map((doc) => doc.collection_name)\n\t\t\t\t\t}\n\t\t\t  ]\n\t\t\t: []),\n\t\t...$documents\n\t\t\t.reduce((a, e, i, arr) => {\n\t\t\t\treturn [...new Set([...a, ...(e?.content?.tags ?? []).map((tag) => tag.name)])];\n\t\t\t}, [])\n\t\t\t.map((tag) => ({\n\t\t\t\tname: tag,\n\t\t\t\ttype: 'collection',\n\t\t\t\tcollection_names: $documents\n\t\t\t\t\t.filter((doc) => (doc?.content?.tags ?? []).map((tag) => tag.name).includes(tag))\n\t\t\t\t\t.map((doc) => doc.collection_name)\n\t\t\t}))\n\t];\n\n\t$: filteredCollections = collections\n\t\t.filter((collection) => findByName(collection, prompt))\n\t\t.sort((a, b) => a.name.localeCompare(b.name));\n\n\t$: filteredDocs = $documents\n\t\t.filter((doc) => findByName(doc, prompt))\n\t\t.sort((a, b) => a.title.localeCompare(b.title));\n\n\t$: filteredItems = [...filteredCollections, ...filteredDocs];\n\n\t$: if (prompt) {\n\t\tselectedIdx = 0;\n\n\t\tconsole.log(filteredCollections);\n\t}\n\n\ttype ObjectWithName = {\n\t\tname: string;\n\t};\n\n\tconst findByName = (obj: ObjectWithName, prompt: string) => {\n\t\tconst name = obj.name.toLowerCase();\n\t\treturn name.includes(prompt.toLowerCase().split(' ')?.at(0)?.substring(1) ?? '');\n\t};\n\n\texport const selectUp = () => {\n\t\tselectedIdx = Math.max(0, selectedIdx - 1);\n\t};\n\n\texport const selectDown = () => {\n\t\tselectedIdx = Math.min(selectedIdx + 1, filteredItems.length - 1);\n\t};\n\n\tconst confirmSelect = async (doc) => {\n\t\tdispatch('select', doc);\n\n\t\tprompt = removeFirstHashWord(prompt);\n\t\tconst chatInputElement = document.getElementById('chat-textarea');\n\n\t\tawait tick();\n\t\tchatInputElement?.focus();\n\t\tawait tick();\n\t};\n\n\tconst confirmSelectWeb = async (url) => {\n\t\tdispatch('url', url);\n\n\t\tprompt = removeFirstHashWord(prompt);\n\t\tconst chatInputElement = document.getElementById('chat-textarea');\n\n\t\tawait tick();\n\t\tchatInputElement?.focus();\n\t\tawait tick();\n\t};\n\n\tconst confirmSelectYoutube = async (url) => {\n\t\tdispatch('youtube', url);\n\n\t\tprompt = removeFirstHashWord(prompt);\n\t\tconst chatInputElement = document.getElementById('chat-textarea');\n\n\t\tawait tick();\n\t\tchatInputElement?.focus();\n\t\tawait tick();\n\t};\n</script>\n\n{#if filteredItems.length > 0 || prompt.split(' ')?.at(0)?.substring(1).startsWith('http')}\n\t<div class=\"pl-1 pr-12 mb-3 text-left w-full absolute bottom-0 left-0 right-0 z-10\">\n\t\t<div class=\"flex w-full dark:border dark:border-gray-850 rounded-lg\">\n\t\t\t<div class=\" bg-gray-50 dark:bg-gray-850 w-10 rounded-l-lg text-center\">\n\t\t\t\t<div class=\" text-lg font-semibold mt-2\">#</div>\n\t\t\t</div>\n\n\t\t\t<div\n\t\t\t\tclass=\"max-h-60 flex flex-col w-full rounded-r-xl bg-white dark:bg-gray-900 dark:text-gray-100\"\n\t\t\t>\n\t\t\t\t<div class=\"m-1 overflow-y-auto p-1 rounded-r-xl space-y-0.5 scrollbar-hidden\">\n\t\t\t\t\t{#each filteredItems as doc, docIdx}\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclass=\" px-3 py-1.5 rounded-xl w-full text-left {docIdx === selectedIdx\n\t\t\t\t\t\t\t\t? ' bg-gray-50 dark:bg-gray-850 dark:text-gray-100 selected-command-option-button'\n\t\t\t\t\t\t\t\t: ''}\"\n\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\tconsole.log(doc);\n\n\t\t\t\t\t\t\t\tconfirmSelect(doc);\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\ton:mousemove={() => {\n\t\t\t\t\t\t\t\tselectedIdx = docIdx;\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\ton:focus={() => {}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{#if doc.type === 'collection'}\n\t\t\t\t\t\t\t\t<div class=\" font-medium text-black dark:text-gray-100 line-clamp-1\">\n\t\t\t\t\t\t\t\t\t{doc?.title ?? `#${doc.name}`}\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t<div class=\" text-xs text-gray-600 dark:text-gray-100 line-clamp-1\">\n\t\t\t\t\t\t\t\t\t{$i18n.t('Collection')}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t<div class=\" font-medium text-black dark:text-gray-100 line-clamp-1\">\n\t\t\t\t\t\t\t\t\t#{doc.name} ({doc.filename})\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t<div class=\" text-xs text-gray-600 dark:text-gray-100 line-clamp-1\">\n\t\t\t\t\t\t\t\t\t{doc.title}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t</button>\n\t\t\t\t\t{/each}\n\n\t\t\t\t\t{#if prompt\n\t\t\t\t\t\t.split(' ')\n\t\t\t\t\t\t.some((s) => s.substring(1).startsWith('https://www.youtube.com') || s\n\t\t\t\t\t\t\t\t\t.substring(1)\n\t\t\t\t\t\t\t\t\t.startsWith('https://youtu.be'))}\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclass=\"px-3 py-1.5 rounded-xl w-full text-left bg-gray-50 dark:bg-gray-850 dark:text-gray-100 selected-command-option-button\"\n\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\tconst url = prompt.split(' ')?.at(0)?.substring(1);\n\t\t\t\t\t\t\t\tif (isValidHttpUrl(url)) {\n\t\t\t\t\t\t\t\t\tconfirmSelectYoutube(url);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\ttoast.error(\n\t\t\t\t\t\t\t\t\t\t$i18n.t(\n\t\t\t\t\t\t\t\t\t\t\t'Oops! Looks like the URL is invalid. Please double-check and try again.'\n\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div class=\" font-medium text-black dark:text-gray-100 line-clamp-1\">\n\t\t\t\t\t\t\t\t{prompt.split(' ')?.at(0)?.substring(1)}\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div class=\" text-xs text-gray-600 line-clamp-1\">{$i18n.t('Youtube')}</div>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t{:else if prompt.split(' ')?.at(0)?.substring(1).startsWith('http')}\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclass=\"px-3 py-1.5 rounded-xl w-full text-left bg-gray-50 dark:bg-gray-850 dark:text-gray-100 selected-command-option-button\"\n\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\tconst url = prompt.split(' ')?.at(0)?.substring(1);\n\t\t\t\t\t\t\t\tif (isValidHttpUrl(url)) {\n\t\t\t\t\t\t\t\t\tconfirmSelectWeb(url);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\ttoast.error(\n\t\t\t\t\t\t\t\t\t\t$i18n.t(\n\t\t\t\t\t\t\t\t\t\t\t'Oops! Looks like the URL is invalid. Please double-check and try again.'\n\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div class=\" font-medium text-black dark:text-gray-100 line-clamp-1\">\n\t\t\t\t\t\t\t\t{prompt.split(' ')?.at(0)?.substring(1)}\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div class=\" text-xs text-gray-600 line-clamp-1\">{$i18n.t('Web')}</div>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n{/if}\n","<script lang=\"ts\">\n\timport { createEventDispatcher } from 'svelte';\n\n\timport { generatePrompt } from '$lib/apis/ollama';\n\timport { models } from '$lib/stores';\n\timport { splitStream } from '$lib/utils';\n\timport { tick, getContext } from 'svelte';\n\timport { toast } from 'svelte-sonner';\n\n\tconst i18n = getContext('i18n');\n\n\tconst dispatch = createEventDispatcher();\n\n\texport let prompt = '';\n\texport let user = null;\n\n\texport let chatInputPlaceholder = '';\n\texport let messages = [];\n\n\tlet selectedIdx = 0;\n\tlet filteredModels = [];\n\n\t$: filteredModels = $models\n\t\t.filter((p) =>\n\t\t\tp.name.toLowerCase().includes(prompt.toLowerCase().split(' ')?.at(0)?.substring(1) ?? '')\n\t\t)\n\t\t.sort((a, b) => a.name.localeCompare(b.name));\n\n\t$: if (prompt) {\n\t\tselectedIdx = 0;\n\t}\n\n\texport const selectUp = () => {\n\t\tselectedIdx = Math.max(0, selectedIdx - 1);\n\t};\n\n\texport const selectDown = () => {\n\t\tselectedIdx = Math.min(selectedIdx + 1, filteredModels.length - 1);\n\t};\n\n\tconst confirmSelect = async (model) => {\n\t\tprompt = '';\n\t\tdispatch('select', model);\n\t};\n\n\tconst confirmSelectCollaborativeChat = async (model) => {\n\t\t// dispatch('select', model);\n\t\tprompt = '';\n\t\tuser = JSON.parse(JSON.stringify(model.name));\n\t\tawait tick();\n\n\t\tchatInputPlaceholder = $i18n.t('{{modelName}} is thinking...', { modelName: model.name });\n\n\t\tconst chatInputElement = document.getElementById('chat-textarea');\n\n\t\tawait tick();\n\t\tchatInputElement?.focus();\n\t\tawait tick();\n\n\t\tconst convoText = messages.reduce((a, message, i, arr) => {\n\t\t\treturn `${a}### ${message.role.toUpperCase()}\\n${message.content}\\n\\n`;\n\t\t}, '');\n\n\t\tconst res = await generatePrompt(localStorage.token, model.name, convoText);\n\n\t\tif (res && res.ok) {\n\t\t\tconst reader = res.body\n\t\t\t\t.pipeThrough(new TextDecoderStream())\n\t\t\t\t.pipeThrough(splitStream('\\n'))\n\t\t\t\t.getReader();\n\n\t\t\twhile (true) {\n\t\t\t\tconst { value, done } = await reader.read();\n\t\t\t\tif (done) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\tlet lines = value.split('\\n');\n\n\t\t\t\t\tfor (const line of lines) {\n\t\t\t\t\t\tif (line !== '') {\n\t\t\t\t\t\t\tconsole.log(line);\n\t\t\t\t\t\t\tlet data = JSON.parse(line);\n\n\t\t\t\t\t\t\tif ('detail' in data) {\n\t\t\t\t\t\t\t\tthrow data;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif ('id' in data) {\n\t\t\t\t\t\t\t\tconsole.log(data);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tif (data.done == false) {\n\t\t\t\t\t\t\t\t\tif (prompt == '' && data.response == '\\n') {\n\t\t\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tprompt += data.response;\n\t\t\t\t\t\t\t\t\t\tconsole.log(data.response);\n\t\t\t\t\t\t\t\t\t\tchatInputElement.scrollTop = chatInputElement.scrollHeight;\n\t\t\t\t\t\t\t\t\t\tawait tick();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.log(error);\n\t\t\t\t\tif ('detail' in error) {\n\t\t\t\t\t\ttoast.error(error.detail);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tif (res !== null) {\n\t\t\t\tconst error = await res.json();\n\t\t\t\tconsole.log(error);\n\t\t\t\tif ('detail' in error) {\n\t\t\t\t\ttoast.error(error.detail);\n\t\t\t\t} else {\n\t\t\t\t\ttoast.error(error.error);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\ttoast.error(\n\t\t\t\t\t$i18n.t('Uh-oh! There was an issue connecting to {{provider}}.', { provider: 'llama' })\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tchatInputPlaceholder = '';\n\n\t\tconsole.log(user);\n\t};\n</script>\n\n{#if prompt.charAt(0) === '@'}\n\t{#if filteredModels.length > 0}\n\t\t<div class=\"pl-1 pr-12 mb-3 text-left w-full absolute bottom-0 left-0 right-0 z-10\">\n\t\t\t<div class=\"flex w-full dark:border dark:border-gray-850 rounded-lg\">\n\t\t\t\t<div class=\" bg-gray-50 dark:bg-gray-850 w-10 rounded-l-lg text-center\">\n\t\t\t\t\t<div class=\" text-lg font-semibold mt-2\">@</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div\n\t\t\t\t\tclass=\"max-h-60 flex flex-col w-full rounded-r-lg bg-white dark:bg-gray-900 dark:text-gray-100\"\n\t\t\t\t>\n\t\t\t\t\t<div class=\"m-1 overflow-y-auto p-1 rounded-r-lg space-y-0.5 scrollbar-hidden\">\n\t\t\t\t\t\t{#each filteredModels as model, modelIdx}\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\" px-3 py-1.5 rounded-xl w-full text-left {modelIdx === selectedIdx\n\t\t\t\t\t\t\t\t\t? '  bg-gray-50 dark:bg-gray-850  selected-command-option-button'\n\t\t\t\t\t\t\t\t\t: ''}\"\n\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\tconfirmSelect(model);\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\ton:mousemove={() => {\n\t\t\t\t\t\t\t\t\tselectedIdx = modelIdx;\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\ton:focus={() => {}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div class=\" font-medium text-black dark:text-gray-100 line-clamp-1\">\n\t\t\t\t\t\t\t\t\t{model.name}\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t<!-- <div class=\" text-xs text-gray-600 line-clamp-1\">\n\t\t\t\t\t\t\t\t{doc.title}\n\t\t\t\t\t\t\t</div> -->\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t{/each}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t{/if}\n{/if}\n","<script lang=\"ts\">\n\texport let className = 'size-3.5';\n\texport let strokeWidth = '2';\n</script>\n\n<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tfill=\"none\"\n\tviewBox=\"0 0 24 24\"\n\tstroke-width={strokeWidth}\n\tstroke=\"currentColor\"\n\tclass={className}\n>\n\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M6 18 18 6M6 6l12 12\" />\n</svg>\n","<script lang=\"ts\">\n\texport let className = 'size-4';\n</script>\n\n<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" class={className}>\n\t<path\n\t\tfill-rule=\"evenodd\"\n\t\td=\"M5.625 1.5H9a3.75 3.75 0 0 1 3.75 3.75v1.875c0 1.036.84 1.875 1.875 1.875H16.5a3.75 3.75 0 0 1 3.75 3.75v7.875c0 1.035-.84 1.875-1.875 1.875H5.625a1.875 1.875 0 0 1-1.875-1.875V3.375c0-1.036.84-1.875 1.875-1.875Zm6.905 9.97a.75.75 0 0 0-1.06 0l-3 3a.75.75 0 1 0 1.06 1.06l1.72-1.72V18a.75.75 0 0 0 1.5 0v-4.19l1.72 1.72a.75.75 0 1 0 1.06-1.06l-3-3Z\"\n\t\tclip-rule=\"evenodd\"\n\t/>\n\t<path\n\t\td=\"M14.25 5.25a5.23 5.23 0 0 0-1.279-3.434 9.768 9.768 0 0 1 6.963 6.963A5.23 5.23 0 0 0 16.5 7.5h-1.875a.375.375 0 0 1-.375-.375V5.25Z\"\n\t/>\n</svg>\n","<script lang=\"ts\">\n\texport let className = 'size-4';\n</script>\n\n<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" class={className}>\n\t<path\n\t\td=\"M21.721 12.752a9.711 9.711 0 0 0-.945-5.003 12.754 12.754 0 0 1-4.339 2.708 18.991 18.991 0 0 1-.214 4.772 17.165 17.165 0 0 0 5.498-2.477ZM14.634 15.55a17.324 17.324 0 0 0 .332-4.647c-.952.227-1.945.347-2.966.347-1.021 0-2.014-.12-2.966-.347a17.515 17.515 0 0 0 .332 4.647 17.385 17.385 0 0 0 5.268 0ZM9.772 17.119a18.963 18.963 0 0 0 4.456 0A17.182 17.182 0 0 1 12 21.724a17.18 17.18 0 0 1-2.228-4.605ZM7.777 15.23a18.87 18.87 0 0 1-.214-4.774 12.753 12.753 0 0 1-4.34-2.708 9.711 9.711 0 0 0-.944 5.004 17.165 17.165 0 0 0 5.498 2.477ZM21.356 14.752a9.765 9.765 0 0 1-7.478 6.817 18.64 18.64 0 0 0 1.988-4.718 18.627 18.627 0 0 0 5.49-2.098ZM2.644 14.752c1.682.971 3.53 1.688 5.49 2.099a18.64 18.64 0 0 0 1.988 4.718 9.765 9.765 0 0 1-7.478-6.816ZM13.878 2.43a9.755 9.755 0 0 1 6.116 3.986 11.267 11.267 0 0 1-3.746 2.504 18.63 18.63 0 0 0-2.37-6.49ZM12 2.276a17.152 17.152 0 0 1 2.805 7.121c-.897.23-1.837.353-2.805.353-.968 0-1.908-.122-2.805-.353A17.151 17.151 0 0 1 12 2.276ZM10.122 2.43a18.629 18.629 0 0 0-2.37 6.49 11.266 11.266 0 0 1-3.746-2.504 9.754 9.754 0 0 1 6.116-3.985Z\"\n\t/>\n</svg>\n","<script lang=\"ts\">\n\texport let className = 'size-4';\n</script>\n\n<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" class={className}>\n\t<path\n\t\tfill-rule=\"evenodd\"\n\t\td=\"M12 6.75a5.25 5.25 0 0 1 6.775-5.025.75.75 0 0 1 .313 1.248l-3.32 3.319c.063.475.276.934.641 1.299.365.365.824.578 1.3.64l3.318-3.319a.75.75 0 0 1 1.248.313 5.25 5.25 0 0 1-5.472 6.756c-1.018-.086-1.87.1-2.309.634L7.344 21.3A3.298 3.298 0 1 1 2.7 16.657l8.684-7.151c.533-.44.72-1.291.634-2.309A5.342 5.342 0 0 1 12 6.75ZM4.117 19.125a.75.75 0 0 1 .75-.75h.008a.75.75 0 0 1 .75.75v.008a.75.75 0 0 1-.75.75h-.008a.75.75 0 0 1-.75-.75v-.008Z\"\n\t\tclip-rule=\"evenodd\"\n\t/>\n</svg>\n","<script lang=\"ts\">\n\timport { DropdownMenu } from 'bits-ui';\n\timport { flyAndScale } from '$lib/utils/transitions';\n\timport { getContext } from 'svelte';\n\n\timport Dropdown from '$lib/components/common/Dropdown.svelte';\n\timport Tooltip from '$lib/components/common/Tooltip.svelte';\n\timport DocumentArrowUpSolid from '$lib/components/icons/DocumentArrowUpSolid.svelte';\n\timport Switch from '$lib/components/common/Switch.svelte';\n\timport GlobeAltSolid from '$lib/components/icons/GlobeAltSolid.svelte';\n\timport { config } from '$lib/stores';\n\timport WrenchSolid from '$lib/components/icons/WrenchSolid.svelte';\n\n\tconst i18n = getContext('i18n');\n\n\texport let uploadFilesHandler: Function;\n\n\texport let selectedToolIds: string[] = [];\n\texport let webSearchEnabled: boolean;\n\n\texport let tools = {};\n\texport let onClose: Function;\n\n\t$: tools = Object.fromEntries(\n\t\tObject.keys(tools).map((toolId) => [\n\t\t\ttoolId,\n\t\t\t{\n\t\t\t\t...tools[toolId],\n\t\t\t\tenabled: selectedToolIds.includes(toolId)\n\t\t\t}\n\t\t])\n\t);\n\n\tlet show = false;\n</script>\n\n<Dropdown\n\tbind:show\n\ton:change={(e) => {\n\t\tif (e.detail === false) {\n\t\t\tonClose();\n\t\t}\n\t}}\n>\n\t<Tooltip content={$i18n.t('More')}>\n\t\t<slot />\n\t</Tooltip>\n\n\t<div slot=\"content\">\n\t\t<DropdownMenu.Content\n\t\t\tclass=\"w-full max-w-[200px] rounded-xl px-1 py-1  border-gray-300/30 dark:border-gray-700/50 z-50 bg-white dark:bg-gray-850 dark:text-white shadow\"\n\t\t\tsideOffset={15}\n\t\t\talignOffset={-8}\n\t\t\tside=\"top\"\n\t\t\talign=\"start\"\n\t\t\ttransition={flyAndScale}\n\t\t>\n\t\t\t{#if Object.keys(tools).length > 0}\n\t\t\t\t<div class=\"  max-h-28 overflow-y-auto scrollbar-hidden\">\n\t\t\t\t\t{#each Object.keys(tools) as toolId}\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-2 text-sm font-medium cursor-pointer rounded-xl\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div class=\"flex-1 flex items-center gap-2\">\n\t\t\t\t\t\t\t\t<WrenchSolid />\n\t\t\t\t\t\t\t\t<Tooltip content={tools[toolId]?.description ?? ''} className=\"flex-1\">\n\t\t\t\t\t\t\t\t\t<div class=\" line-clamp-1\">{tools[toolId].name}</div>\n\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<Switch\n\t\t\t\t\t\t\t\tbind:state={tools[toolId].enabled}\n\t\t\t\t\t\t\t\ton:change={(e) => {\n\t\t\t\t\t\t\t\t\tselectedToolIds = e.detail\n\t\t\t\t\t\t\t\t\t\t? [...selectedToolIds, toolId]\n\t\t\t\t\t\t\t\t\t\t: selectedToolIds.filter((id) => id !== toolId);\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{/each}\n\t\t\t\t</div>\n\n\t\t\t\t<hr class=\"border-gray-100 dark:border-gray-800 my-1\" />\n\t\t\t{/if}\n\n\t\t\t{#if $config?.features?.enable_web_search}\n\t\t\t\t<div\n\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-2 text-sm font-medium cursor-pointer rounded-xl\"\n\t\t\t\t>\n\t\t\t\t\t<div class=\"flex-1 flex items-center gap-2\">\n\t\t\t\t\t\t<GlobeAltSolid />\n\t\t\t\t\t\t<div class=\" line-clamp-1\">{$i18n.t('Web Search')}</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<Switch bind:state={webSearchEnabled} />\n\t\t\t\t</div>\n\n\t\t\t\t<hr class=\"border-gray-100 dark:border-gray-800 my-1\" />\n\t\t\t{/if}\n\n\t\t\t<DropdownMenu.Item\n\t\t\t\tclass=\"flex gap-2 items-center px-3 py-2 text-sm  font-medium cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800  rounded-xl\"\n\t\t\t\ton:click={() => {\n\t\t\t\t\tuploadFilesHandler();\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<DocumentArrowUpSolid />\n\t\t\t\t<div class=\" line-clamp-1\">{$i18n.t('Upload Files')}</div>\n\t\t\t</DropdownMenu.Item>\n\t\t</DropdownMenu.Content>\n\t</div>\n</Dropdown>\n","<script lang=\"ts\">\n\texport let className = 'w-4 h-4';\n\texport let strokeWidth = '0';\n</script>\n\n<svg\n\taria-hidden=\"true\"\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tfill=\"currentColor\"\n\tviewBox=\"0 0 24 24\"\n\tstroke-width={strokeWidth}\n\tstroke=\"currentColor\"\n\tclass={className}\n>\n\t<path\n\t\tfill-rule=\"evenodd\"\n\t\td=\"M12 5a7 7 0 0 0-7 7v1.17c.313-.11.65-.17 1-.17h2a1 1 0 0 1 1 1v6a1 1 0 0 1-1 1H6a3 3 0 0 1-3-3v-6a9 9 0 0 1 18 0v6a3 3 0 0 1-3 3h-2a1 1 0 0 1-1-1v-6a1 1 0 0 1 1-1h2c.35 0 .687.06 1 .17V12a7 7 0 0 0-7-7Z\"\n\t\tclip-rule=\"evenodd\"\n\t/>\n</svg>\n","<script lang=\"ts\">\n\timport { toast } from 'svelte-sonner';\n\timport { createEventDispatcher, tick, getContext } from 'svelte';\n\timport { config, settings } from '$lib/stores';\n\timport { blobToFile, calculateSHA256, findWordIndices } from '$lib/utils';\n\n\timport { transcribeAudio } from '$lib/apis/audio';\n\n\tconst i18n = getContext('i18n');\n\n\tconst dispatch = createEventDispatcher();\n\n\texport let recording = false;\n\n\tlet loading = false;\n\tlet confirmed = false;\n\n\tlet durationSeconds = 0;\n\tlet durationCounter = null;\n\n\tlet transcription = '';\n\n\tconst startDurationCounter = () => {\n\t\tdurationCounter = setInterval(() => {\n\t\t\tdurationSeconds++;\n\t\t}, 1000);\n\t};\n\n\tconst stopDurationCounter = () => {\n\t\tclearInterval(durationCounter);\n\t\tdurationSeconds = 0;\n\t};\n\n\t$: if (recording) {\n\t\tstartRecording();\n\t} else {\n\t\tstopRecording();\n\t}\n\n\tconst formatSeconds = (seconds) => {\n\t\tconst minutes = Math.floor(seconds / 60);\n\t\tconst remainingSeconds = seconds % 60;\n\t\tconst formattedSeconds = remainingSeconds < 10 ? `0${remainingSeconds}` : remainingSeconds;\n\t\treturn `${minutes}:${formattedSeconds}`;\n\t};\n\n\tlet speechRecognition;\n\n\tlet mediaRecorder;\n\tlet audioChunks = [];\n\n\tconst MIN_DECIBELS = -45;\n\tconst VISUALIZER_BUFFER_LENGTH = 300;\n\n\tlet visualizerData = Array(VISUALIZER_BUFFER_LENGTH).fill(0);\n\n\t// Function to calculate the RMS level from time domain data\n\tconst calculateRMS = (data: Uint8Array) => {\n\t\tlet sumSquares = 0;\n\t\tfor (let i = 0; i < data.length; i++) {\n\t\t\tconst normalizedValue = (data[i] - 128) / 128; // Normalize the data\n\t\t\tsumSquares += normalizedValue * normalizedValue;\n\t\t}\n\t\treturn Math.sqrt(sumSquares / data.length);\n\t};\n\n\tconst normalizeRMS = (rms) => {\n\t\trms = rms * 10;\n\t\tconst exp = 1.5; // Adjust exponent value; values greater than 1 expand larger numbers more and compress smaller numbers more\n\t\tconst scaledRMS = Math.pow(rms, exp);\n\n\t\t// Scale between 0.01 (1%) and 1.0 (100%)\n\t\treturn Math.min(1.0, Math.max(0.01, scaledRMS));\n\t};\n\n\tconst analyseAudio = (stream) => {\n\t\tconst audioContext = new AudioContext();\n\t\tconst audioStreamSource = audioContext.createMediaStreamSource(stream);\n\n\t\tconst analyser = audioContext.createAnalyser();\n\t\tanalyser.minDecibels = MIN_DECIBELS;\n\t\taudioStreamSource.connect(analyser);\n\n\t\tconst bufferLength = analyser.frequencyBinCount;\n\n\t\tconst domainData = new Uint8Array(bufferLength);\n\t\tconst timeDomainData = new Uint8Array(analyser.fftSize);\n\n\t\tlet lastSoundTime = Date.now();\n\n\t\tconst detectSound = () => {\n\t\t\tconst processFrame = () => {\n\t\t\t\tif (!recording || loading) return;\n\n\t\t\t\tif (recording && !loading) {\n\t\t\t\t\tanalyser.getByteTimeDomainData(timeDomainData);\n\t\t\t\t\tanalyser.getByteFrequencyData(domainData);\n\n\t\t\t\t\t// Calculate RMS level from time domain data\n\t\t\t\t\tconst rmsLevel = calculateRMS(timeDomainData);\n\t\t\t\t\t// Push the calculated decibel level to visualizerData\n\t\t\t\t\tvisualizerData.push(normalizeRMS(rmsLevel));\n\n\t\t\t\t\t// Ensure visualizerData array stays within the buffer length\n\t\t\t\t\tif (visualizerData.length >= VISUALIZER_BUFFER_LENGTH) {\n\t\t\t\t\t\tvisualizerData.shift();\n\t\t\t\t\t}\n\n\t\t\t\t\tvisualizerData = visualizerData;\n\n\t\t\t\t\t// if (domainData.some((value) => value > 0)) {\n\t\t\t\t\t// \tlastSoundTime = Date.now();\n\t\t\t\t\t// }\n\n\t\t\t\t\t// if (recording && Date.now() - lastSoundTime > 3000) {\n\t\t\t\t\t// \tif ($settings?.speechAutoSend ?? false) {\n\t\t\t\t\t// \t\tconfirmRecording();\n\t\t\t\t\t// \t}\n\t\t\t\t\t// }\n\t\t\t\t}\n\n\t\t\t\twindow.requestAnimationFrame(processFrame);\n\t\t\t};\n\n\t\t\twindow.requestAnimationFrame(processFrame);\n\t\t};\n\n\t\tdetectSound();\n\t};\n\n\tconst transcribeHandler = async (audioBlob) => {\n\t\t// Create a blob from the audio chunks\n\n\t\tawait tick();\n\t\tconst file = blobToFile(audioBlob, 'recording.wav');\n\n\t\tconst res = await transcribeAudio(localStorage.token, file).catch((error) => {\n\t\t\ttoast.error(error);\n\t\t\treturn null;\n\t\t});\n\n\t\tif (res) {\n\t\t\tconsole.log(res.text);\n\t\t\tdispatch('confirm', res.text);\n\t\t}\n\t};\n\n\tconst saveRecording = (blob) => {\n\t\tconst url = URL.createObjectURL(blob);\n\t\tconst a = document.createElement('a');\n\t\tdocument.body.appendChild(a);\n\t\ta.style = 'display: none';\n\t\ta.href = url;\n\t\ta.download = 'recording.wav';\n\t\ta.click();\n\t\twindow.URL.revokeObjectURL(url);\n\t};\n\n\tconst startRecording = async () => {\n\t\tstartDurationCounter();\n\n\t\tconst stream = await navigator.mediaDevices.getUserMedia({ audio: true });\n\t\tmediaRecorder = new MediaRecorder(stream);\n\t\tmediaRecorder.onstart = () => {\n\t\t\tconsole.log('Recording started');\n\t\t\taudioChunks = [];\n\t\t\tanalyseAudio(stream);\n\t\t};\n\t\tmediaRecorder.ondataavailable = (event) => audioChunks.push(event.data);\n\t\tmediaRecorder.onstop = async () => {\n\t\t\tconsole.log('Recording stopped');\n\t\t\tif (($settings?.audio?.stt?.engine ?? '') === 'web') {\n\t\t\t\taudioChunks = [];\n\t\t\t} else {\n\t\t\t\tif (confirmed) {\n\t\t\t\t\tconst audioBlob = new Blob(audioChunks, { type: 'audio/wav' });\n\n\t\t\t\t\tawait transcribeHandler(audioBlob);\n\n\t\t\t\t\tconfirmed = false;\n\t\t\t\t\tloading = false;\n\t\t\t\t}\n\t\t\t\taudioChunks = [];\n\t\t\t\trecording = false;\n\t\t\t}\n\t\t};\n\t\tmediaRecorder.start();\n\t\tif ($config.audio.stt.engine === 'web' || ($settings?.audio?.stt?.engine ?? '') === 'web') {\n\t\t\tif ('SpeechRecognition' in window || 'webkitSpeechRecognition' in window) {\n\t\t\t\t// Create a SpeechRecognition object\n\t\t\t\tspeechRecognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();\n\n\t\t\t\t// Set continuous to true for continuous recognition\n\t\t\t\tspeechRecognition.continuous = true;\n\n\t\t\t\t// Set the timeout for turning off the recognition after inactivity (in milliseconds)\n\t\t\t\tconst inactivityTimeout = 2000; // 3 seconds\n\n\t\t\t\tlet timeoutId;\n\t\t\t\t// Start recognition\n\t\t\t\tspeechRecognition.start();\n\n\t\t\t\t// Event triggered when speech is recognized\n\t\t\t\tspeechRecognition.onresult = async (event) => {\n\t\t\t\t\t// Clear the inactivity timeout\n\t\t\t\t\tclearTimeout(timeoutId);\n\n\t\t\t\t\t// Handle recognized speech\n\t\t\t\t\tconsole.log(event);\n\t\t\t\t\tconst transcript = event.results[Object.keys(event.results).length - 1][0].transcript;\n\n\t\t\t\t\ttranscription = `${transcription}${transcript}`;\n\n\t\t\t\t\tawait tick();\n\t\t\t\t\tdocument.getElementById('chat-textarea')?.focus();\n\n\t\t\t\t\t// Restart the inactivity timeout\n\t\t\t\t\ttimeoutId = setTimeout(() => {\n\t\t\t\t\t\tconsole.log('Speech recognition turned off due to inactivity.');\n\t\t\t\t\t\tspeechRecognition.stop();\n\t\t\t\t\t}, inactivityTimeout);\n\t\t\t\t};\n\n\t\t\t\t// Event triggered when recognition is ended\n\t\t\t\tspeechRecognition.onend = function () {\n\t\t\t\t\t// Restart recognition after it ends\n\t\t\t\t\tconsole.log('recognition ended');\n\n\t\t\t\t\tconfirmRecording();\n\t\t\t\t\tdispatch('confirm', transcription);\n\n\t\t\t\t\tconfirmed = false;\n\t\t\t\t\tloading = false;\n\t\t\t\t};\n\n\t\t\t\t// Event triggered when an error occurs\n\t\t\t\tspeechRecognition.onerror = function (event) {\n\t\t\t\t\tconsole.log(event);\n\t\t\t\t\ttoast.error($i18n.t(`Speech recognition error: {{error}}`, { error: event.error }));\n\t\t\t\t\tdispatch('cancel');\n\n\t\t\t\t\tstopRecording();\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t};\n\n\tconst stopRecording = async () => {\n\t\tif (recording && mediaRecorder) {\n\t\t\tawait mediaRecorder.stop();\n\t\t}\n\t\tstopDurationCounter();\n\t\taudioChunks = [];\n\t};\n\n\tconst confirmRecording = async () => {\n\t\tloading = true;\n\t\tconfirmed = true;\n\n\t\tif (recording && mediaRecorder) {\n\t\t\tawait mediaRecorder.stop();\n\t\t}\n\t\tclearInterval(durationCounter);\n\t};\n</script>\n\n<div\n\tclass=\"{loading\n\t\t? ' bg-gray-100/50 dark:bg-gray-850/50'\n\t\t: 'bg-indigo-300/10 dark:bg-indigo-500/10 '} rounded-full flex p-2.5\"\n>\n\t<div class=\"flex items-center mr-1\">\n\t\t<button\n\t\t\ttype=\"button\"\n\t\t\tclass=\"p-1.5\n\n            {loading\n\t\t\t\t? ' bg-gray-200 dark:bg-gray-700/50'\n\t\t\t\t: 'bg-indigo-400/20 text-indigo-600 dark:text-indigo-300 '} \n\n\n             rounded-full\"\n\t\t\ton:click={async () => {\n\t\t\t\tdispatch('cancel');\n\t\t\t\tstopRecording();\n\t\t\t}}\n\t\t>\n\t\t\t<svg\n\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\tfill=\"none\"\n\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\tstroke-width=\"3\"\n\t\t\t\tstroke=\"currentColor\"\n\t\t\t\tclass=\"size-4\"\n\t\t\t>\n\t\t\t\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M6 18 18 6M6 6l12 12\" />\n\t\t\t</svg>\n\t\t</button>\n\t</div>\n\n\t<div\n\t\tclass=\"flex flex-1 self-center items-center justify-between ml-2 mx-1 overflow-hidden h-6\"\n\t\tdir=\"rtl\"\n\t>\n\t\t<div class=\"flex-1 flex items-center gap-0.5 h-6\">\n\t\t\t{#each visualizerData.slice().reverse() as rms}\n\t\t\t\t<div\n\t\t\t\t\tclass=\"w-[2px]\n                    \n                    {loading\n\t\t\t\t\t\t? ' bg-gray-500 dark:bg-gray-400   '\n\t\t\t\t\t\t: 'bg-indigo-500 dark:bg-indigo-400  '} \n                    \n                    inline-block h-full\"\n\t\t\t\t\tstyle=\"height: {Math.min(100, Math.max(14, rms * 100))}%;\"\n\t\t\t\t/>\n\t\t\t{/each}\n\t\t</div>\n\t</div>\n\n\t<div class=\"  mx-1.5 pr-1 flex justify-center items-center\">\n\t\t<div\n\t\t\tclass=\"text-sm\n        \n        \n        {loading ? ' text-gray-500  dark:text-gray-400  ' : ' text-indigo-400 '} \n       font-medium flex-1 mx-auto text-center\"\n\t\t>\n\t\t\t{formatSeconds(durationSeconds)}\n\t\t</div>\n\t</div>\n\n\t<div class=\"flex items-center mr-1\">\n\t\t{#if loading}\n\t\t\t<div class=\" text-gray-500 rounded-full cursor-not-allowed\">\n\t\t\t\t<svg\n\t\t\t\t\twidth=\"24\"\n\t\t\t\t\theight=\"24\"\n\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t><style>\n\t\t\t\t\t\t.spinner_OSmW {\n\t\t\t\t\t\t\ttransform-origin: center;\n\t\t\t\t\t\t\tanimation: spinner_T6mA 0.75s step-end infinite;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t@keyframes spinner_T6mA {\n\t\t\t\t\t\t\t8.3% {\n\t\t\t\t\t\t\t\ttransform: rotate(30deg);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t16.6% {\n\t\t\t\t\t\t\t\ttransform: rotate(60deg);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t25% {\n\t\t\t\t\t\t\t\ttransform: rotate(90deg);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t33.3% {\n\t\t\t\t\t\t\t\ttransform: rotate(120deg);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t41.6% {\n\t\t\t\t\t\t\t\ttransform: rotate(150deg);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t50% {\n\t\t\t\t\t\t\t\ttransform: rotate(180deg);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t58.3% {\n\t\t\t\t\t\t\t\ttransform: rotate(210deg);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t66.6% {\n\t\t\t\t\t\t\t\ttransform: rotate(240deg);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t75% {\n\t\t\t\t\t\t\t\ttransform: rotate(270deg);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t83.3% {\n\t\t\t\t\t\t\t\ttransform: rotate(300deg);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t91.6% {\n\t\t\t\t\t\t\t\ttransform: rotate(330deg);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t100% {\n\t\t\t\t\t\t\t\ttransform: rotate(360deg);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t</style><g class=\"spinner_OSmW\"\n\t\t\t\t\t\t><rect x=\"11\" y=\"1\" width=\"2\" height=\"5\" opacity=\".14\" /><rect\n\t\t\t\t\t\t\tx=\"11\"\n\t\t\t\t\t\t\ty=\"1\"\n\t\t\t\t\t\t\twidth=\"2\"\n\t\t\t\t\t\t\theight=\"5\"\n\t\t\t\t\t\t\ttransform=\"rotate(30 12 12)\"\n\t\t\t\t\t\t\topacity=\".29\"\n\t\t\t\t\t\t/><rect\n\t\t\t\t\t\t\tx=\"11\"\n\t\t\t\t\t\t\ty=\"1\"\n\t\t\t\t\t\t\twidth=\"2\"\n\t\t\t\t\t\t\theight=\"5\"\n\t\t\t\t\t\t\ttransform=\"rotate(60 12 12)\"\n\t\t\t\t\t\t\topacity=\".43\"\n\t\t\t\t\t\t/><rect\n\t\t\t\t\t\t\tx=\"11\"\n\t\t\t\t\t\t\ty=\"1\"\n\t\t\t\t\t\t\twidth=\"2\"\n\t\t\t\t\t\t\theight=\"5\"\n\t\t\t\t\t\t\ttransform=\"rotate(90 12 12)\"\n\t\t\t\t\t\t\topacity=\".57\"\n\t\t\t\t\t\t/><rect\n\t\t\t\t\t\t\tx=\"11\"\n\t\t\t\t\t\t\ty=\"1\"\n\t\t\t\t\t\t\twidth=\"2\"\n\t\t\t\t\t\t\theight=\"5\"\n\t\t\t\t\t\t\ttransform=\"rotate(120 12 12)\"\n\t\t\t\t\t\t\topacity=\".71\"\n\t\t\t\t\t\t/><rect\n\t\t\t\t\t\t\tx=\"11\"\n\t\t\t\t\t\t\ty=\"1\"\n\t\t\t\t\t\t\twidth=\"2\"\n\t\t\t\t\t\t\theight=\"5\"\n\t\t\t\t\t\t\ttransform=\"rotate(150 12 12)\"\n\t\t\t\t\t\t\topacity=\".86\"\n\t\t\t\t\t\t/><rect x=\"11\" y=\"1\" width=\"2\" height=\"5\" transform=\"rotate(180 12 12)\" /></g\n\t\t\t\t\t></svg\n\t\t\t\t>\n\t\t\t</div>\n\t\t{:else}\n\t\t\t<button\n\t\t\t\ttype=\"button\"\n\t\t\t\tclass=\"p-1.5 bg-indigo-500 text-white dark:bg-indigo-500 dark:text-blue-950 rounded-full\"\n\t\t\t\ton:click={async () => {\n\t\t\t\t\tawait confirmRecording();\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<svg\n\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\tfill=\"none\"\n\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\tstroke-width=\"2.5\"\n\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\tclass=\"size-4\"\n\t\t\t\t>\n\t\t\t\t\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"m4.5 12.75 6 6 9-13.5\" />\n\t\t\t\t</svg>\n\t\t\t</button>\n\t\t{/if}\n\t</div>\n</div>\n\n<style>\n\t.visualizer {\n\t\tdisplay: flex;\n\t\theight: 100%;\n\t}\n\n\t.visualizer-bar {\n\t\twidth: 2px;\n\t\tbackground-color: #4a5aba; /* or whatever color you need */\n\t}\n</style>\n","<script lang=\"ts\">\n\timport { showSidebar } from '$lib/stores';\n\timport AddFilesPlaceholder from '$lib/components/AddFilesPlaceholder.svelte';\n\n\texport let show = false;\n\tlet overlayElement = null;\n\n\t$: if (show && overlayElement) {\n\t\tdocument.body.appendChild(overlayElement);\n\t\tdocument.body.style.overflow = 'hidden';\n\t} else if (overlayElement) {\n\t\tdocument.body.removeChild(overlayElement);\n\t\tdocument.body.style.overflow = 'unset';\n\t}\n</script>\n\n{#if show}\n\t<div\n\t\tbind:this={overlayElement}\n\t\tclass=\"fixed {$showSidebar\n\t\t\t? 'left-0 md:left-[260px] md:w-[calc(100%-260px)]'\n\t\t\t: 'left-0'}  fixed top-0 right-0 bottom-0 w-full h-full flex z-[9999] touch-none pointer-events-none\"\n\t\tid=\"dropzone\"\n\t\trole=\"region\"\n\t\taria-label=\"Drag and Drop Container\"\n\t>\n\t\t<div class=\"absolute w-full h-full backdrop-blur bg-gray-800/40 flex justify-center\">\n\t\t\t<div class=\"m-auto pt-64 flex flex-col justify-center\">\n\t\t\t\t<div class=\"max-w-md\">\n\t\t\t\t\t<AddFilesPlaceholder />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n{/if}\n","<script lang=\"ts\">\n\timport { toast } from 'svelte-sonner';\n\timport { onMount, tick, getContext } from 'svelte';\n\timport {\n\t\ttype Model,\n\t\tmobile,\n\t\tsettings,\n\t\tshowSidebar,\n\t\tmodels,\n\t\tconfig,\n\t\tshowCallOverlay,\n\t\ttools,\n\t\tuser as _user\n\t} from '$lib/stores';\n\timport { blobToFile, calculateSHA256, findWordIndices } from '$lib/utils';\n\n\timport {\n\t\tprocessDocToVectorDB,\n\t\tuploadDocToVectorDB,\n\t\tuploadWebToVectorDB,\n\t\tuploadYoutubeTranscriptionToVectorDB\n\t} from '$lib/apis/rag';\n\n\timport { uploadFile } from '$lib/apis/files';\n\timport {\n\t\tSUPPORTED_FILE_TYPE,\n\t\tSUPPORTED_FILE_EXTENSIONS,\n\t\tWEBUI_BASE_URL,\n\t\tWEBUI_API_BASE_URL\n\t} from '$lib/constants';\n\n\timport Prompts from './MessageInput/PromptCommands.svelte';\n\timport Suggestions from './MessageInput/Suggestions.svelte';\n\timport AddFilesPlaceholder from '../AddFilesPlaceholder.svelte';\n\timport Documents from './MessageInput/Documents.svelte';\n\timport Models from './MessageInput/Models.svelte';\n\timport Tooltip from '../common/Tooltip.svelte';\n\timport XMark from '$lib/components/icons/XMark.svelte';\n\timport InputMenu from './MessageInput/InputMenu.svelte';\n\timport Headphone from '../icons/Headphone.svelte';\n\timport VoiceRecording from './MessageInput/VoiceRecording.svelte';\n\timport { transcribeAudio } from '$lib/apis/audio';\n\timport FileItem from '../common/FileItem.svelte';\n\timport FilesOverlay from './MessageInput/FilesOverlay.svelte';\n\n\tconst i18n = getContext('i18n');\n\n\texport let transparentBackground = false;\n\n\texport let submitPrompt: Function;\n\texport let stopResponse: Function;\n\n\texport let autoScroll = true;\n\n\texport let atSelectedModel: Model | undefined;\n\texport let selectedModels: [''];\n\n\tlet recording = false;\n\n\tlet chatTextAreaElement: HTMLTextAreaElement;\n\tlet filesInputElement;\n\n\tlet promptsElement;\n\tlet documentsElement;\n\tlet modelsElement;\n\n\tlet inputFiles;\n\tlet dragged = false;\n\n\tlet user = null;\n\tlet chatInputPlaceholder = '';\n\n\texport let files = [];\n\n\texport let availableToolIds = [];\n\texport let selectedToolIds = [];\n\texport let webSearchEnabled = false;\n\n\texport let prompt = '';\n\texport let messages = [];\n\n\tlet visionCapableModels = [];\n\t$: visionCapableModels = [...(atSelectedModel ? [atSelectedModel] : selectedModels)].filter(\n\t\t(model) => $models.find((m) => m.id === model)?.info?.meta?.capabilities?.vision ?? true\n\t);\n\n\t$: if (prompt) {\n\t\tif (chatTextAreaElement) {\n\t\t\tchatTextAreaElement.style.height = '';\n\t\t\tchatTextAreaElement.style.height = Math.min(chatTextAreaElement.scrollHeight, 200) + 'px';\n\t\t}\n\t}\n\n\tconst scrollToBottom = () => {\n\t\tconst element = document.getElementById('messages-container');\n\t\telement.scrollTop = element.scrollHeight;\n\t};\n\n\tconst uploadFileHandler = async (file) => {\n\t\tconsole.log(file);\n\t\t// Check if the file is an audio file and transcribe/convert it to text file\n\t\tif (['audio/mpeg', 'audio/wav'].includes(file['type'])) {\n\t\t\tconst res = await transcribeAudio(localStorage.token, file).catch((error) => {\n\t\t\t\ttoast.error(error);\n\t\t\t\treturn null;\n\t\t\t});\n\n\t\t\tif (res) {\n\t\t\t\tconsole.log(res);\n\t\t\t\tconst blob = new Blob([res.text], { type: 'text/plain' });\n\t\t\t\tfile = blobToFile(blob, `${file.name}.txt`);\n\t\t\t}\n\t\t}\n\n\t\t// Upload the file to the server\n\t\tconst uploadedFile = await uploadFile(localStorage.token, file).catch((error) => {\n\t\t\ttoast.error(error);\n\t\t\treturn null;\n\t\t});\n\n\t\tif (uploadedFile) {\n\t\t\tconst fileItem = {\n\t\t\t\ttype: 'file',\n\t\t\t\tfile: uploadedFile,\n\t\t\t\tid: uploadedFile.id,\n\t\t\t\turl: `${WEBUI_API_BASE_URL}/files/${uploadedFile.id}`,\n\t\t\t\tname: file.name,\n\t\t\t\tcollection_name: '',\n\t\t\t\tstatus: 'uploaded',\n\t\t\t\terror: ''\n\t\t\t};\n\t\t\tfiles = [...files, fileItem];\n\n\t\t\t// TODO: Check if tools & functions have files support to skip this step to delegate file processing\n\t\t\t// Default Upload to VectorDB\n\t\t\tif (\n\t\t\t\tSUPPORTED_FILE_TYPE.includes(file['type']) ||\n\t\t\t\tSUPPORTED_FILE_EXTENSIONS.includes(file.name.split('.').at(-1))\n\t\t\t) {\n\t\t\t\tprocessFileItem(fileItem);\n\t\t\t} else {\n\t\t\t\ttoast.error(\n\t\t\t\t\t$i18n.t(`Unknown file type '{{file_type}}'. Proceeding with the file upload anyway.`, {\n\t\t\t\t\t\tfile_type: file['type']\n\t\t\t\t\t})\n\t\t\t\t);\n\t\t\t\tprocessFileItem(fileItem);\n\t\t\t}\n\t\t}\n\t};\n\n\tconst processFileItem = async (fileItem) => {\n\t\ttry {\n\t\t\tconst res = await processDocToVectorDB(localStorage.token, fileItem.id);\n\n\t\t\tif (res) {\n\t\t\t\tfileItem.status = 'processed';\n\t\t\t\tfileItem.collection_name = res.collection_name;\n\t\t\t\tfiles = files;\n\t\t\t}\n\t\t} catch (e) {\n\t\t\t// Remove the failed doc from the files array\n\t\t\t// files = files.filter((f) => f.id !== fileItem.id);\n\t\t\ttoast.error(e);\n\n\t\t\tfileItem.status = 'processed';\n\t\t\tfiles = files;\n\t\t}\n\t};\n\n\tconst uploadWeb = async (url) => {\n\t\tconsole.log(url);\n\n\t\tconst doc = {\n\t\t\ttype: 'doc',\n\t\t\tname: url,\n\t\t\tcollection_name: '',\n\t\t\tstatus: false,\n\t\t\turl: url,\n\t\t\terror: ''\n\t\t};\n\n\t\ttry {\n\t\t\tfiles = [...files, doc];\n\t\t\tconst res = await uploadWebToVectorDB(localStorage.token, '', url);\n\n\t\t\tif (res) {\n\t\t\t\tdoc.status = 'processed';\n\t\t\t\tdoc.collection_name = res.collection_name;\n\t\t\t\tfiles = files;\n\t\t\t}\n\t\t} catch (e) {\n\t\t\t// Remove the failed doc from the files array\n\t\t\tfiles = files.filter((f) => f.name !== url);\n\t\t\ttoast.error(e);\n\t\t}\n\t};\n\n\tconst uploadYoutubeTranscription = async (url) => {\n\t\tconsole.log(url);\n\n\t\tconst doc = {\n\t\t\ttype: 'doc',\n\t\t\tname: url,\n\t\t\tcollection_name: '',\n\t\t\tstatus: false,\n\t\t\turl: url,\n\t\t\terror: ''\n\t\t};\n\n\t\ttry {\n\t\t\tfiles = [...files, doc];\n\t\t\tconst res = await uploadYoutubeTranscriptionToVectorDB(localStorage.token, url);\n\n\t\t\tif (res) {\n\t\t\t\tdoc.status = 'processed';\n\t\t\t\tdoc.collection_name = res.collection_name;\n\t\t\t\tfiles = files;\n\t\t\t}\n\t\t} catch (e) {\n\t\t\t// Remove the failed doc from the files array\n\t\t\tfiles = files.filter((f) => f.name !== url);\n\t\t\ttoast.error(e);\n\t\t}\n\t};\n\n\tonMount(() => {\n\t\twindow.setTimeout(() => chatTextAreaElement?.focus(), 0);\n\n\t\tconst dropZone = document.querySelector('body');\n\n\t\tconst handleKeyDown = (event: KeyboardEvent) => {\n\t\t\tif (event.key === 'Escape') {\n\t\t\t\tconsole.log('Escape');\n\t\t\t\tdragged = false;\n\t\t\t}\n\t\t};\n\n\t\tconst onDragOver = (e) => {\n\t\t\te.preventDefault();\n\t\t\tdragged = true;\n\t\t};\n\n\t\tconst onDragLeave = () => {\n\t\t\tdragged = false;\n\t\t};\n\n\t\tconst onDrop = async (e) => {\n\t\t\te.preventDefault();\n\t\t\tconsole.log(e);\n\n\t\t\tif (e.dataTransfer?.files) {\n\t\t\t\tconst inputFiles = Array.from(e.dataTransfer?.files);\n\n\t\t\t\tif (inputFiles && inputFiles.length > 0) {\n\t\t\t\t\tinputFiles.forEach((file) => {\n\t\t\t\t\t\tconsole.log(file, file.name.split('.').at(-1));\n\t\t\t\t\t\tif (['image/gif', 'image/webp', 'image/jpeg', 'image/png'].includes(file['type'])) {\n\t\t\t\t\t\t\tif (visionCapableModels.length === 0) {\n\t\t\t\t\t\t\t\ttoast.error($i18n.t('Selected model(s) do not support image inputs'));\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tlet reader = new FileReader();\n\t\t\t\t\t\t\treader.onload = (event) => {\n\t\t\t\t\t\t\t\tfiles = [\n\t\t\t\t\t\t\t\t\t...files,\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\ttype: 'image',\n\t\t\t\t\t\t\t\t\t\turl: `${event.target.result}`\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t];\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\treader.readAsDataURL(file);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tuploadFileHandler(file);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\ttoast.error($i18n.t(`File not found.`));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tdragged = false;\n\t\t};\n\n\t\twindow.addEventListener('keydown', handleKeyDown);\n\n\t\tdropZone?.addEventListener('dragover', onDragOver);\n\t\tdropZone?.addEventListener('drop', onDrop);\n\t\tdropZone?.addEventListener('dragleave', onDragLeave);\n\n\t\treturn () => {\n\t\t\twindow.removeEventListener('keydown', handleKeyDown);\n\n\t\t\tdropZone?.removeEventListener('dragover', onDragOver);\n\t\t\tdropZone?.removeEventListener('drop', onDrop);\n\t\t\tdropZone?.removeEventListener('dragleave', onDragLeave);\n\t\t};\n\t});\n</script>\n\n<FilesOverlay show={dragged} />\n\n<div class=\"w-full font-primary\">\n\t<div class=\" -mb-0.5 mx-auto inset-x-0 bg-transparent flex justify-center\">\n\t\t<div class=\"flex flex-col max-w-6xl px-2.5 md:px-6 w-full\">\n\t\t\t<div class=\"relative\">\n\t\t\t\t{#if autoScroll === false && messages.length > 0}\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\" absolute -top-12 left-0 right-0 flex justify-center z-30 pointer-events-none\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclass=\" bg-white border border-gray-100 dark:border-none dark:bg-white/20 p-1.5 rounded-full pointer-events-auto\"\n\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\tautoScroll = true;\n\t\t\t\t\t\t\t\tscrollToBottom();\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\tviewBox=\"0 0 20 20\"\n\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\tclass=\"w-5 h-5\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\td=\"M10 3a.75.75 0 01.75.75v10.638l3.96-4.158a.75.75 0 111.08 1.04l-5.25 5.5a.75.75 0 01-1.08 0l-5.25-5.5a.75.75 0 111.08-1.04l3.96 4.158V3.75A.75.75 0 0110 3z\"\n\t\t\t\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t{/if}\n\t\t\t</div>\n\n\t\t\t<div class=\"w-full relative\">\n\t\t\t\t{#if prompt.charAt(0) === '/'}\n\t\t\t\t\t<Prompts bind:this={promptsElement} bind:prompt bind:files />\n\t\t\t\t{:else if prompt.charAt(0) === '#'}\n\t\t\t\t\t<Documents\n\t\t\t\t\t\tbind:this={documentsElement}\n\t\t\t\t\t\tbind:prompt\n\t\t\t\t\t\ton:youtube={(e) => {\n\t\t\t\t\t\t\tconsole.log(e);\n\t\t\t\t\t\t\tuploadYoutubeTranscription(e.detail);\n\t\t\t\t\t\t}}\n\t\t\t\t\t\ton:url={(e) => {\n\t\t\t\t\t\t\tconsole.log(e);\n\t\t\t\t\t\t\tuploadWeb(e.detail);\n\t\t\t\t\t\t}}\n\t\t\t\t\t\ton:select={(e) => {\n\t\t\t\t\t\t\tconsole.log(e);\n\t\t\t\t\t\t\tfiles = [\n\t\t\t\t\t\t\t\t...files,\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttype: e?.detail?.type ?? 'file',\n\t\t\t\t\t\t\t\t\t...e.detail,\n\t\t\t\t\t\t\t\t\tstatus: 'processed'\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t];\n\t\t\t\t\t\t}}\n\t\t\t\t\t/>\n\t\t\t\t{/if}\n\n\t\t\t\t<Models\n\t\t\t\t\tbind:this={modelsElement}\n\t\t\t\t\tbind:prompt\n\t\t\t\t\tbind:chatInputPlaceholder\n\t\t\t\t\t{messages}\n\t\t\t\t\ton:select={(e) => {\n\t\t\t\t\t\tatSelectedModel = e.detail;\n\t\t\t\t\t\tchatTextAreaElement?.focus();\n\t\t\t\t\t}}\n\t\t\t\t/>\n\n\t\t\t\t{#if atSelectedModel !== undefined}\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"px-3 py-2.5 text-left w-full flex justify-between items-center absolute bottom-0 left-0 right-0 bg-gradient-to-t from-50% from-white dark:from-gray-900\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"flex items-center gap-2 text-sm dark:text-gray-500\">\n\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\tcrossorigin=\"anonymous\"\n\t\t\t\t\t\t\t\talt=\"model profile\"\n\t\t\t\t\t\t\t\tclass=\"size-5 max-w-[28px] object-cover rounded-full\"\n\t\t\t\t\t\t\t\tsrc={$models.find((model) => model.id === atSelectedModel.id)?.info?.meta\n\t\t\t\t\t\t\t\t\t?.profile_image_url ??\n\t\t\t\t\t\t\t\t\t($i18n.language === 'dg-DG'\n\t\t\t\t\t\t\t\t\t\t? `/doge.png`\n\t\t\t\t\t\t\t\t\t\t: `${WEBUI_BASE_URL}/static/favicon.png`)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\tTalking to <span class=\" font-medium\">{atSelectedModel.name}</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\"flex items-center\"\n\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\tatSelectedModel = undefined;\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<XMark />\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t{/if}\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\n\t<div class=\"{transparentBackground ? 'bg-transparent' : 'bg-white dark:bg-gray-900'} \">\n\t\t<div class=\"max-w-6xl px-2.5 md:px-6 mx-auto inset-x-0\">\n\t\t\t<div class=\" pb-2\">\n\t\t\t\t<input\n\t\t\t\t\tbind:this={filesInputElement}\n\t\t\t\t\tbind:files={inputFiles}\n\t\t\t\t\ttype=\"file\"\n\t\t\t\t\thidden\n\t\t\t\t\tmultiple\n\t\t\t\t\ton:change={async () => {\n\t\t\t\t\t\tif (inputFiles && inputFiles.length > 0) {\n\t\t\t\t\t\t\tconst _inputFiles = Array.from(inputFiles);\n\t\t\t\t\t\t\t_inputFiles.forEach((file) => {\n\t\t\t\t\t\t\t\tif (['image/gif', 'image/webp', 'image/jpeg', 'image/png'].includes(file['type'])) {\n\t\t\t\t\t\t\t\t\tif (visionCapableModels.length === 0) {\n\t\t\t\t\t\t\t\t\t\ttoast.error($i18n.t('Selected model(s) do not support image inputs'));\n\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tlet reader = new FileReader();\n\t\t\t\t\t\t\t\t\treader.onload = (event) => {\n\t\t\t\t\t\t\t\t\t\tfiles = [\n\t\t\t\t\t\t\t\t\t\t\t...files,\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\ttype: 'image',\n\t\t\t\t\t\t\t\t\t\t\t\turl: `${event.target.result}`\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t];\n\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\treader.readAsDataURL(file);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tuploadFileHandler(file);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\ttoast.error($i18n.t(`File not found.`));\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tfilesInputElement.value = '';\n\t\t\t\t\t}}\n\t\t\t\t/>\n\n\t\t\t\t{#if recording}\n\t\t\t\t\t<VoiceRecording\n\t\t\t\t\t\tbind:recording\n\t\t\t\t\t\ton:cancel={async () => {\n\t\t\t\t\t\t\trecording = false;\n\n\t\t\t\t\t\t\tawait tick();\n\t\t\t\t\t\t\tdocument.getElementById('chat-textarea')?.focus();\n\t\t\t\t\t\t}}\n\t\t\t\t\t\ton:confirm={async (e) => {\n\t\t\t\t\t\t\tconst response = e.detail;\n\t\t\t\t\t\t\tprompt = `${prompt}${response} `;\n\n\t\t\t\t\t\t\trecording = false;\n\n\t\t\t\t\t\t\tawait tick();\n\t\t\t\t\t\t\tdocument.getElementById('chat-textarea')?.focus();\n\n\t\t\t\t\t\t\tif ($settings?.speechAutoSend ?? false) {\n\t\t\t\t\t\t\t\tsubmitPrompt(prompt);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}}\n\t\t\t\t\t/>\n\t\t\t\t{:else}\n\t\t\t\t\t<form\n\t\t\t\t\t\tclass=\"w-full flex gap-1.5\"\n\t\t\t\t\t\ton:submit|preventDefault={() => {\n\t\t\t\t\t\t\t// check if selectedModels support image input\n\t\t\t\t\t\t\tsubmitPrompt(prompt);\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass=\"flex-1 flex flex-col relative w-full rounded-3xl px-1.5 bg-gray-50 dark:bg-gray-850 dark:text-gray-100\"\n\t\t\t\t\t\t\tdir={$settings?.chatDirection ?? 'LTR'}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{#if files.length > 0}\n\t\t\t\t\t\t\t\t<div class=\"mx-1 mt-2.5 mb-1 flex flex-wrap gap-2\">\n\t\t\t\t\t\t\t\t\t{#each files as file, fileIdx}\n\t\t\t\t\t\t\t\t\t\t{#if file.type === 'image'}\n\t\t\t\t\t\t\t\t\t\t\t<div class=\" relative group\">\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"relative\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsrc={file.url}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\talt=\"input\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\" h-16 w-16 rounded-xl object-cover\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{#if atSelectedModel ? visionCapableModels.length === 0 : selectedModels.length !== visionCapableModels.length}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Tooltip\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\" absolute top-1 left-1\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcontent={$i18n.t('{{ models }}', {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmodels: [...(atSelectedModel ? [atSelectedModel] : selectedModels)]\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.filter((id) => !visionCapableModels.includes(id))\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.join(', ')\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"size-4 fill-yellow-300\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\td=\"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003ZM12 8.25a.75.75 0 0 1 .75.75v3.75a.75.75 0 0 1-1.5 0V9a.75.75 0 0 1 .75-.75Zm0 8.25a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\" absolute -top-1 -right-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\" bg-gray-400 text-white border border-white rounded-full group-hover:visible invisible transition\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfiles.splice(fileIdx, 1);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfiles = files;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 20 20\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"w-4 h-4\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\td=\"M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t\t\t<FileItem\n\t\t\t\t\t\t\t\t\t\t\t\tname={file.name}\n\t\t\t\t\t\t\t\t\t\t\t\ttype={file.type}\n\t\t\t\t\t\t\t\t\t\t\t\tstatus={file.status}\n\t\t\t\t\t\t\t\t\t\t\t\tdismissible={true}\n\t\t\t\t\t\t\t\t\t\t\t\ton:dismiss={() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\tfiles.splice(fileIdx, 1);\n\t\t\t\t\t\t\t\t\t\t\t\t\tfiles = files;\n\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t<div class=\" flex\">\n\t\t\t\t\t\t\t\t<div class=\" ml-0.5 self-end mb-1.5 flex space-x-1\">\n\t\t\t\t\t\t\t\t\t<InputMenu\n\t\t\t\t\t\t\t\t\t\tbind:webSearchEnabled\n\t\t\t\t\t\t\t\t\t\tbind:selectedToolIds\n\t\t\t\t\t\t\t\t\t\ttools={$tools.reduce((a, e, i, arr) => {\n\t\t\t\t\t\t\t\t\t\t\tif (availableToolIds.includes(e.id) || ($_user?.role ?? 'user') === 'admin') {\n\t\t\t\t\t\t\t\t\t\t\t\ta[e.id] = {\n\t\t\t\t\t\t\t\t\t\t\t\t\tname: e.name,\n\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: e.meta.description,\n\t\t\t\t\t\t\t\t\t\t\t\t\tenabled: false\n\t\t\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\treturn a;\n\t\t\t\t\t\t\t\t\t\t}, {})}\n\t\t\t\t\t\t\t\t\t\tuploadFilesHandler={() => {\n\t\t\t\t\t\t\t\t\t\t\tfilesInputElement.click();\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\tonClose={async () => {\n\t\t\t\t\t\t\t\t\t\t\tawait tick();\n\t\t\t\t\t\t\t\t\t\t\tchatTextAreaElement?.focus();\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\tclass=\"bg-gray-50 hover:bg-gray-100 text-gray-800 dark:bg-gray-850 dark:text-white dark:hover:bg-gray-800 transition rounded-full p-2 outline-none focus:outline-none\"\n\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 16 16\"\n\t\t\t\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\t\tclass=\"size-5\"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\t\td=\"M8.75 3.75a.75.75 0 0 0-1.5 0v3.5h-3.5a.75.75 0 0 0 0 1.5h3.5v3.5a.75.75 0 0 0 1.5 0v-3.5h3.5a.75.75 0 0 0 0-1.5h-3.5v-3.5Z\"\n\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t</InputMenu>\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t<textarea\n\t\t\t\t\t\t\t\t\tid=\"chat-textarea\"\n\t\t\t\t\t\t\t\t\tbind:this={chatTextAreaElement}\n\t\t\t\t\t\t\t\t\tclass=\"scrollbar-hidden bg-gray-50 dark:bg-gray-850 dark:text-gray-100 outline-none w-full py-3 px-1 rounded-xl resize-none h-[48px]\"\n\t\t\t\t\t\t\t\t\tplaceholder={chatInputPlaceholder !== ''\n\t\t\t\t\t\t\t\t\t\t? chatInputPlaceholder\n\t\t\t\t\t\t\t\t\t\t: $i18n.t('Send a Message')}\n\t\t\t\t\t\t\t\t\tbind:value={prompt}\n\t\t\t\t\t\t\t\t\ton:keypress={(e) => {\n\t\t\t\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t\t\t\t!$mobile ||\n\t\t\t\t\t\t\t\t\t\t\t!(\n\t\t\t\t\t\t\t\t\t\t\t\t'ontouchstart' in window ||\n\t\t\t\t\t\t\t\t\t\t\t\tnavigator.maxTouchPoints > 0 ||\n\t\t\t\t\t\t\t\t\t\t\t\tnavigator.msMaxTouchPoints > 0\n\t\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\t\t\t\t// Prevent Enter key from creating a new line\n\t\t\t\t\t\t\t\t\t\t\tif (e.key === 'Enter' && !e.shiftKey) {\n\t\t\t\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t// Submit the prompt when Enter key is pressed\n\t\t\t\t\t\t\t\t\t\t\tif (prompt !== '' && e.key === 'Enter' && !e.shiftKey) {\n\t\t\t\t\t\t\t\t\t\t\t\tsubmitPrompt(prompt);\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\ton:keydown={async (e) => {\n\t\t\t\t\t\t\t\t\t\tconst isCtrlPressed = e.ctrlKey || e.metaKey; // metaKey is for Cmd key on Mac\n\n\t\t\t\t\t\t\t\t\t\t// Check if Ctrl + R is pressed\n\t\t\t\t\t\t\t\t\t\tif (prompt === '' && isCtrlPressed && e.key.toLowerCase() === 'r') {\n\t\t\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\t\t\tconsole.log('regenerate');\n\n\t\t\t\t\t\t\t\t\t\t\tconst regenerateButton = [\n\t\t\t\t\t\t\t\t\t\t\t\t...document.getElementsByClassName('regenerate-response-button')\n\t\t\t\t\t\t\t\t\t\t\t]?.at(-1);\n\n\t\t\t\t\t\t\t\t\t\t\tregenerateButton?.click();\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tif (prompt === '' && e.key == 'ArrowUp') {\n\t\t\t\t\t\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\t\t\t\t\t\tconst userMessageElement = [\n\t\t\t\t\t\t\t\t\t\t\t\t...document.getElementsByClassName('user-message')\n\t\t\t\t\t\t\t\t\t\t\t]?.at(-1);\n\n\t\t\t\t\t\t\t\t\t\t\tconst editButton = [\n\t\t\t\t\t\t\t\t\t\t\t\t...document.getElementsByClassName('edit-user-message-button')\n\t\t\t\t\t\t\t\t\t\t\t]?.at(-1);\n\n\t\t\t\t\t\t\t\t\t\t\tconsole.log(userMessageElement);\n\n\t\t\t\t\t\t\t\t\t\t\tuserMessageElement.scrollIntoView({ block: 'center' });\n\t\t\t\t\t\t\t\t\t\t\teditButton?.click();\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tif (['/', '#', '@'].includes(prompt.charAt(0)) && e.key === 'ArrowUp') {\n\t\t\t\t\t\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\t\t\t\t\t\t(promptsElement || documentsElement || modelsElement).selectUp();\n\n\t\t\t\t\t\t\t\t\t\t\tconst commandOptionButton = [\n\t\t\t\t\t\t\t\t\t\t\t\t...document.getElementsByClassName('selected-command-option-button')\n\t\t\t\t\t\t\t\t\t\t\t]?.at(-1);\n\t\t\t\t\t\t\t\t\t\t\tcommandOptionButton.scrollIntoView({ block: 'center' });\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tif (['/', '#', '@'].includes(prompt.charAt(0)) && e.key === 'ArrowDown') {\n\t\t\t\t\t\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\t\t\t\t\t\t(promptsElement || documentsElement || modelsElement).selectDown();\n\n\t\t\t\t\t\t\t\t\t\t\tconst commandOptionButton = [\n\t\t\t\t\t\t\t\t\t\t\t\t...document.getElementsByClassName('selected-command-option-button')\n\t\t\t\t\t\t\t\t\t\t\t]?.at(-1);\n\t\t\t\t\t\t\t\t\t\t\tcommandOptionButton.scrollIntoView({ block: 'center' });\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tif (['/', '#', '@'].includes(prompt.charAt(0)) && e.key === 'Enter') {\n\t\t\t\t\t\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\t\t\t\t\t\tconst commandOptionButton = [\n\t\t\t\t\t\t\t\t\t\t\t\t...document.getElementsByClassName('selected-command-option-button')\n\t\t\t\t\t\t\t\t\t\t\t]?.at(-1);\n\n\t\t\t\t\t\t\t\t\t\t\tif (e.shiftKey) {\n\t\t\t\t\t\t\t\t\t\t\t\tprompt = `${prompt}\\n`;\n\t\t\t\t\t\t\t\t\t\t\t} else if (commandOptionButton) {\n\t\t\t\t\t\t\t\t\t\t\t\tcommandOptionButton?.click();\n\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\tdocument.getElementById('send-message-button')?.click();\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tif (['/', '#', '@'].includes(prompt.charAt(0)) && e.key === 'Tab') {\n\t\t\t\t\t\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\t\t\t\t\t\tconst commandOptionButton = [\n\t\t\t\t\t\t\t\t\t\t\t\t...document.getElementsByClassName('selected-command-option-button')\n\t\t\t\t\t\t\t\t\t\t\t]?.at(-1);\n\n\t\t\t\t\t\t\t\t\t\t\tcommandOptionButton?.click();\n\t\t\t\t\t\t\t\t\t\t} else if (e.key === 'Tab') {\n\t\t\t\t\t\t\t\t\t\t\tconst words = findWordIndices(prompt);\n\n\t\t\t\t\t\t\t\t\t\t\tif (words.length > 0) {\n\t\t\t\t\t\t\t\t\t\t\t\tconst word = words.at(0);\n\t\t\t\t\t\t\t\t\t\t\t\tconst fullPrompt = prompt;\n\n\t\t\t\t\t\t\t\t\t\t\t\tprompt = prompt.substring(0, word?.endIndex + 1);\n\t\t\t\t\t\t\t\t\t\t\t\tawait tick();\n\n\t\t\t\t\t\t\t\t\t\t\t\te.target.scrollTop = e.target.scrollHeight;\n\t\t\t\t\t\t\t\t\t\t\t\tprompt = fullPrompt;\n\t\t\t\t\t\t\t\t\t\t\t\tawait tick();\n\n\t\t\t\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\t\t\t\te.target.setSelectionRange(word?.startIndex, word.endIndex + 1);\n\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\te.target.style.height = '';\n\t\t\t\t\t\t\t\t\t\t\te.target.style.height = Math.min(e.target.scrollHeight, 200) + 'px';\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tif (e.key === 'Escape') {\n\t\t\t\t\t\t\t\t\t\t\tconsole.log('Escape');\n\t\t\t\t\t\t\t\t\t\t\tatSelectedModel = undefined;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\trows=\"1\"\n\t\t\t\t\t\t\t\t\ton:input={(e) => {\n\t\t\t\t\t\t\t\t\t\te.target.style.height = '';\n\t\t\t\t\t\t\t\t\t\te.target.style.height = Math.min(e.target.scrollHeight, 200) + 'px';\n\t\t\t\t\t\t\t\t\t\tuser = null;\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\ton:focus={(e) => {\n\t\t\t\t\t\t\t\t\t\te.target.style.height = '';\n\t\t\t\t\t\t\t\t\t\te.target.style.height = Math.min(e.target.scrollHeight, 200) + 'px';\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\ton:paste={(e) => {\n\t\t\t\t\t\t\t\t\t\tconst clipboardData = e.clipboardData || window.clipboardData;\n\n\t\t\t\t\t\t\t\t\t\tif (clipboardData && clipboardData.items) {\n\t\t\t\t\t\t\t\t\t\t\tfor (const item of clipboardData.items) {\n\t\t\t\t\t\t\t\t\t\t\t\tif (item.type.indexOf('image') !== -1) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tconst blob = item.getAsFile();\n\t\t\t\t\t\t\t\t\t\t\t\t\tconst reader = new FileReader();\n\n\t\t\t\t\t\t\t\t\t\t\t\t\treader.onload = function (e) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfiles = [\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t...files,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: 'image',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\turl: `${e.target.result}`\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t];\n\t\t\t\t\t\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\t\t\t\t\t\treader.readAsDataURL(blob);\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t/>\n\n\t\t\t\t\t\t\t\t<div class=\"self-end mb-2 flex space-x-1 mr-1\">\n\t\t\t\t\t\t\t\t\t{#if messages.length == 0 || messages.at(-1).done == true}\n\t\t\t\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Record voice')}>\n\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\tid=\"voice-input-button\"\n\t\t\t\t\t\t\t\t\t\t\t\tclass=\" text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-850 transition rounded-full p-1.5 mr-0.5 self-center\"\n\t\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t\t\ton:click={async () => {\n\t\t\t\t\t\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst res = await navigator.mediaDevices\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.getUserMedia({ audio: true })\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.catch(function (err) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttoast.error(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t$i18n.t(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t`Permission denied when accessing microphone: {{error}}`,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\terror: err\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (res) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\trecording = true;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t} catch {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttoast.error($i18n.t('Permission denied when accessing microphone'));\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 20 20\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"w-5 h-5 translate-y-[0.5px]\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<path d=\"M7 4a3 3 0 016 0v6a3 3 0 11-6 0V4z\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\t\t\td=\"M5.5 9.643a.75.75 0 00-1.5 0V10c0 3.06 2.29 5.585 5.25 5.954V17.5h-1.5a.75.75 0 000 1.5h4.5a.75.75 0 000-1.5h-1.5v-1.546A6.001 6.001 0 0016 10v-.357a.75.75 0 00-1.5 0V10a4.5 4.5 0 01-9 0v-.357z\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"flex items-end w-10\">\n\t\t\t\t\t\t\t{#if messages.length == 0 || messages.at(-1).done == true}\n\t\t\t\t\t\t\t\t{#if prompt === ''}\n\t\t\t\t\t\t\t\t\t<div class=\" flex items-center mb-1\">\n\t\t\t\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Call')}>\n\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\tclass=\" text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-850 transition rounded-full p-2 self-center\"\n\t\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t\t\ton:click={async () => {\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (selectedModels.length > 1) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttoast.error($i18n.t('Select only one model to call'));\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\tif ($config.audio.stt.engine === 'web') {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttoast.error(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t$i18n.t('Call feature is not supported when using Web STT engine')\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t// check if user has access to getUserMedia\n\t\t\t\t\t\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tawait navigator.mediaDevices.getUserMedia({ audio: true });\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// If the user grants the permission, proceed to show the call overlay\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tshowCallOverlay.set(true);\n\t\t\t\t\t\t\t\t\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// If the user denies the permission or an error occurs, show an error message\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttoast.error($i18n.t('Permission denied when accessing media devices'));\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<Headphone className=\"size-6\" />\n\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t<div class=\" flex items-center mb-1\">\n\t\t\t\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Send message')}>\n\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\tid=\"send-message-button\"\n\t\t\t\t\t\t\t\t\t\t\t\tclass=\"{prompt !== ''\n\t\t\t\t\t\t\t\t\t\t\t\t\t? 'bg-black text-white hover:bg-gray-900 dark:bg-white dark:text-black dark:hover:bg-gray-100 '\n\t\t\t\t\t\t\t\t\t\t\t\t\t: 'text-white bg-gray-200 dark:text-gray-900 dark:bg-gray-700 disabled'} transition rounded-full p-1.5 m-0.5 self-center\"\n\t\t\t\t\t\t\t\t\t\t\t\ttype=\"submit\"\n\t\t\t\t\t\t\t\t\t\t\t\tdisabled={prompt === ''}\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 16 16\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"size-6\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\td=\"M8 14a.75.75 0 0 1-.75-.75V4.56L4.03 7.78a.75.75 0 0 1-1.06-1.06l4.5-4.5a.75.75 0 0 1 1.06 0l4.5 4.5a.75.75 0 0 1-1.06 1.06L8.75 4.56v8.69A.75.75 0 0 1 8 14Z\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t<div class=\" flex items-center mb-1.5\">\n\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\tclass=\"bg-white hover:bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-white dark:hover:bg-gray-800 transition rounded-full p-1.5\"\n\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\tstopResponse();\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\tclass=\"size-6\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t\t\t\td=\"M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12zm6-2.438c0-.724.588-1.312 1.313-1.312h4.874c.725 0 1.313.588 1.313 1.313v4.874c0 .725-.588 1.313-1.313 1.313H9.564a1.312 1.312 0 01-1.313-1.313V9.564z\"\n\t\t\t\t\t\t\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</form>\n\t\t\t\t{/if}\n\n\t\t\t\t<div class=\"mt-1.5 text-xs text-gray-500 text-center line-clamp-1\">\n\t\t\t\t\t{$i18n.t('LLMs can make mistakes. Verify important information.')}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n\n<style>\n\t.scrollbar-hidden:active::-webkit-scrollbar-thumb,\n\t.scrollbar-hidden:focus::-webkit-scrollbar-thumb,\n\t.scrollbar-hidden:hover::-webkit-scrollbar-thumb {\n\t\tvisibility: visible;\n\t}\n\t.scrollbar-hidden::-webkit-scrollbar-thumb {\n\t\tvisibility: hidden;\n\t}\n</style>\n","<script lang=\"ts\">\n\timport { models, showSettings, settings, user, mobile } from '$lib/stores';\n\timport { onMount, tick, getContext } from 'svelte';\n\timport { toast } from 'svelte-sonner';\n\timport Selector from './ModelSelector/Selector.svelte';\n\timport Tooltip from '../common/Tooltip.svelte';\n\n\timport { setDefaultModels } from '$lib/apis/configs';\n\timport { updateUserSettings } from '$lib/apis/users';\n\n\tconst i18n = getContext('i18n');\n\n\texport let selectedModels = [''];\n\texport let disabled = false;\n\n\texport let showSetDefault = true;\n\n\tconst saveDefaultModel = async () => {\n\t\tconst hasEmptyModel = selectedModels.filter((it) => it === '');\n\t\tif (hasEmptyModel.length) {\n\t\t\ttoast.error($i18n.t('Choose a model before saving...'));\n\t\t\treturn;\n\t\t}\n\t\tsettings.set({ ...$settings, models: selectedModels });\n\t\tawait updateUserSettings(localStorage.token, { ui: $settings });\n\n\t\ttoast.success($i18n.t('Default model updated'));\n\t};\n\n\t$: if (selectedModels.length > 0 && $models.length > 0) {\n\t\tselectedModels = selectedModels.map((model) =>\n\t\t\t$models.map((m) => m.id).includes(model) ? model : ''\n\t\t);\n\t}\n</script>\n\n<div class=\"flex flex-col w-full items-start\">\n\t{#each selectedModels as selectedModel, selectedModelIdx}\n\t\t<div class=\"flex w-full max-w-fit\">\n\t\t\t<div class=\"overflow-hidden w-full\">\n\t\t\t\t<div class=\"mr-1 max-w-full\">\n\t\t\t\t\t<Selector\n\t\t\t\t\t\tplaceholder={$i18n.t('Select a model')}\n\t\t\t\t\t\titems={$models.map((model) => ({\n\t\t\t\t\t\t\tvalue: model.id,\n\t\t\t\t\t\t\tlabel: model.name,\n\t\t\t\t\t\t\tmodel: model\n\t\t\t\t\t\t}))}\n\t\t\t\t\t\tbind:value={selectedModel}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t{#if selectedModelIdx === 0}\n\t\t\t\t<div class=\"  self-center mr-2 disabled:text-gray-600 disabled:hover:text-gray-600\">\n\t\t\t\t\t<Tooltip content={$i18n.t('Add Model')}>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclass=\" \"\n\t\t\t\t\t\t\t{disabled}\n\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\tselectedModels = [...selectedModels, ''];\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\tclass=\"size-3.5\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M12 6v12m6-6H6\" />\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</Tooltip>\n\t\t\t\t</div>\n\t\t\t{:else}\n\t\t\t\t<div class=\"  self-center disabled:text-gray-600 disabled:hover:text-gray-600 mr-2\">\n\t\t\t\t\t<Tooltip content={$i18n.t('Remove Model')}>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t{disabled}\n\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\tselectedModels.splice(selectedModelIdx, 1);\n\t\t\t\t\t\t\t\tselectedModels = selectedModels;\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\tclass=\"size-3.5\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M19.5 12h-15\" />\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</Tooltip>\n\t\t\t\t</div>\n\t\t\t{/if}\n\t\t</div>\n\t{/each}\n</div>\n\n{#if showSetDefault && !$mobile}\n\t<div class=\"text-left mt-0.5 ml-1 text-[0.7rem] text-gray-500 font-primary\">\n\t\t<button on:click={saveDefaultModel}> {$i18n.t('Set as default')}</button>\n\t</div>\n{/if}\n","<script lang=\"ts\">\n\timport { DropdownMenu } from 'bits-ui';\n\timport { getContext } from 'svelte';\n\n\timport fileSaver from 'file-saver';\n\tconst { saveAs } = fileSaver;\n\n\timport { showSettings } from '$lib/stores';\n\timport { flyAndScale } from '$lib/utils/transitions';\n\n\timport Dropdown from '$lib/components/common/Dropdown.svelte';\n\timport Tags from '$lib/components/chat/Tags.svelte';\n\n\timport { downloadChatAsPDF } from '$lib/apis/utils';\n\n\tconst i18n = getContext('i18n');\n\n\texport let shareEnabled: boolean = false;\n\texport let shareHandler: Function;\n\texport let downloadHandler: Function;\n\n\t// export let tagHandler: Function;\n\n\texport let chat;\n\texport let onClose: Function = () => {};\n\n\tconst downloadTxt = async () => {\n\t\tconst _chat = chat.chat;\n\t\tconsole.log('download', chat);\n\n\t\tconst chatText = _chat.messages.reduce((a, message, i, arr) => {\n\t\t\treturn `${a}### ${message.role.toUpperCase()}\\n${message.content}\\n\\n`;\n\t\t}, '');\n\n\t\tlet blob = new Blob([chatText], {\n\t\t\ttype: 'text/plain'\n\t\t});\n\n\t\tsaveAs(blob, `chat-${_chat.title}.txt`);\n\t};\n\n\tconst downloadPdf = async () => {\n\t\tconst _chat = chat.chat;\n\t\tconsole.log('download', chat);\n\n\t\tconst blob = await downloadChatAsPDF(_chat);\n\n\t\t// Create a URL for the blob\n\t\tconst url = window.URL.createObjectURL(blob);\n\n\t\t// Create a link element to trigger the download\n\t\tconst a = document.createElement('a');\n\t\ta.href = url;\n\t\ta.download = `chat-${_chat.title}.pdf`;\n\n\t\t// Append the link to the body and click it programmatically\n\t\tdocument.body.appendChild(a);\n\t\ta.click();\n\n\t\t// Remove the link from the body\n\t\tdocument.body.removeChild(a);\n\n\t\t// Revoke the URL to release memory\n\t\twindow.URL.revokeObjectURL(url);\n\t};\n\n\tconst downloadJSONExport = async () => {\n\t\tlet blob = new Blob([JSON.stringify([chat])], {\n\t\t\ttype: 'application/json'\n\t\t});\n\t\tsaveAs(blob, `chat-export-${Date.now()}.json`);\n\t};\n</script>\n\n<Dropdown\n\ton:change={(e) => {\n\t\tif (e.detail === false) {\n\t\t\tonClose();\n\t\t}\n\t}}\n>\n\t<slot />\n\n\t<div slot=\"content\">\n\t\t<DropdownMenu.Content\n\t\t\tclass=\"w-full max-w-[200px] rounded-xl px-1 py-1.5 border border-gray-300/30 dark:border-gray-700/50 z-50 bg-white dark:bg-gray-850 dark:text-white shadow-lg\"\n\t\t\tsideOffset={8}\n\t\t\tside=\"bottom\"\n\t\t\talign=\"end\"\n\t\t\ttransition={flyAndScale}\n\t\t>\n\t\t\t<!-- <DropdownMenu.Item\n\t\t\t\tclass=\"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer dark:hover:bg-gray-800 rounded-md\"\n\t\t\t\ton:click={async () => {\n\t\t\t\t\tawait showSettings.set(!$showSettings);\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<svg\n\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\tfill=\"none\"\n\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\tstroke-width=\"1.5\"\n\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\tclass=\"size-4\"\n\t\t\t\t>\n\t\t\t\t\t<path\n\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\td=\"M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a7.723 7.723 0 0 1 0 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.47 6.47 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 0 1 0-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28Z\"\n\t\t\t\t\t/>\n\t\t\t\t\t<path\n\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\td=\"M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z\"\n\t\t\t\t\t/>\n\t\t\t\t</svg>\n\t\t\t\t<div class=\"flex items-center\">{$i18n.t('Settings')}</div>\n\t\t\t</DropdownMenu.Item> -->\n\n\t\t\t<DropdownMenu.Item\n\t\t\t\tclass=\"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md\"\n\t\t\t\tid=\"chat-share-button\"\n\t\t\t\ton:click={() => {\n\t\t\t\t\tshareHandler();\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<svg\n\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\tclass=\"size-4\"\n\t\t\t\t>\n\t\t\t\t\t<path\n\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\td=\"M15.75 4.5a3 3 0 1 1 .825 2.066l-8.421 4.679a3.002 3.002 0 0 1 0 1.51l8.421 4.679a3 3 0 1 1-.729 1.31l-8.421-4.678a3 3 0 1 1 0-4.132l8.421-4.679a3 3 0 0 1-.096-.755Z\"\n\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t/>\n\t\t\t\t</svg>\n\t\t\t\t<div class=\"flex items-center\">{$i18n.t('Share')}</div>\n\t\t\t</DropdownMenu.Item>\n\t\t\t<!-- <DropdownMenu.Item\n\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-2 text-sm  font-medium cursor-pointer\"\n\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\tdownloadHandler();\n\t\t\t\t\t}}\n\t\t\t\t/> -->\n\t\t\t<DropdownMenu.Sub>\n\t\t\t\t<DropdownMenu.SubTrigger\n\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md\"\n\t\t\t\t>\n\t\t\t\t\t<svg\n\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\tstroke-width=\"1.5\"\n\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\tclass=\"size-4\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<path\n\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\td=\"M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</svg>\n\n\t\t\t\t\t<div class=\"flex items-center\">{$i18n.t('Download')}</div>\n\t\t\t\t</DropdownMenu.SubTrigger>\n\t\t\t\t<DropdownMenu.SubContent\n\t\t\t\t\tclass=\"w-full rounded-lg px-1 py-1.5 border border-gray-300/30 dark:border-gray-700/50 z-50 bg-white dark:bg-gray-850 dark:text-white shadow-lg\"\n\t\t\t\t\ttransition={flyAndScale}\n\t\t\t\t\tsideOffset={8}\n\t\t\t\t>\n\t\t\t\t\t<DropdownMenu.Item\n\t\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md\"\n\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\tdownloadJSONExport();\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"flex items-center line-clamp-1\">{$i18n.t('Export chat (.json)')}</div>\n\t\t\t\t\t</DropdownMenu.Item>\n\t\t\t\t\t<DropdownMenu.Item\n\t\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md\"\n\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\tdownloadTxt();\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"flex items-center line-clamp-1\">{$i18n.t('Plain text (.txt)')}</div>\n\t\t\t\t\t</DropdownMenu.Item>\n\n\t\t\t\t\t<DropdownMenu.Item\n\t\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md\"\n\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\tdownloadPdf();\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"flex items-center line-clamp-1\">{$i18n.t('PDF document (.pdf)')}</div>\n\t\t\t\t\t</DropdownMenu.Item>\n\t\t\t\t</DropdownMenu.SubContent>\n\t\t\t</DropdownMenu.Sub>\n\n\t\t\t<hr class=\"border-gray-100 dark:border-gray-800 mt-2.5 mb-1.5\" />\n\n\t\t\t<div class=\"flex p-1\">\n\t\t\t\t<Tags chatId={chat.id} />\n\t\t\t</div>\n\t\t</DropdownMenu.Content>\n\t</div>\n</Dropdown>\n","<script lang=\"ts\">\n\texport let className = 'w-4 h-4';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tviewBox=\"0 0 24 24\"\n\tstroke=\"currentColor\"\n\tfill=\"currentColor\"\n\tclass={className}\n\tstroke-width={strokeWidth}\n>\n\t<path\n\t\td=\"M18.75 12.75h1.5a.75.75 0 0 0 0-1.5h-1.5a.75.75 0 0 0 0 1.5ZM12 6a.75.75 0 0 1 .75-.75h7.5a.75.75 0 0 1 0 1.5h-7.5A.75.75 0 0 1 12 6ZM12 18a.75.75 0 0 1 .75-.75h7.5a.75.75 0 0 1 0 1.5h-7.5A.75.75 0 0 1 12 18ZM3.75 6.75h1.5a.75.75 0 1 0 0-1.5h-1.5a.75.75 0 0 0 0 1.5ZM5.25 18.75h-1.5a.75.75 0 0 1 0-1.5h1.5a.75.75 0 0 1 0 1.5ZM3 12a.75.75 0 0 1 .75-.75h7.5a.75.75 0 0 1 0 1.5h-7.5A.75.75 0 0 1 3 12ZM9 3.75a2.25 2.25 0 1 0 0 4.5 2.25 2.25 0 0 0 0-4.5ZM12.75 12a2.25 2.25 0 1 1 4.5 0 2.25 2.25 0 0 1-4.5 0ZM9 15.75a2.25 2.25 0 1 0 0 4.5 2.25 2.25 0 0 0 0-4.5Z\"\n\t/>\n</svg>\n","<script lang=\"ts\">\n\timport { getContext } from 'svelte';\n\timport { toast } from 'svelte-sonner';\n\n\timport {\n\t\tWEBUI_NAME,\n\t\tchatId,\n\t\tmobile,\n\t\tsettings,\n\t\tshowArchivedChats,\n\t\tshowSettings,\n\t\tshowSidebar,\n\t\tuser\n\t} from '$lib/stores';\n\n\timport { slide } from 'svelte/transition';\n\timport ShareChatModal from '../chat/ShareChatModal.svelte';\n\timport ModelSelector from '../chat/ModelSelector.svelte';\n\timport Tooltip from '../common/Tooltip.svelte';\n\timport Menu from './Navbar/Menu.svelte';\n\timport { page } from '$app/stores';\n\timport UserMenu from './Sidebar/UserMenu.svelte';\n\timport MenuLines from '../icons/MenuLines.svelte';\n\timport AdjustmentsHorizontal from '../icons/AdjustmentsHorizontal.svelte';\n\n\tconst i18n = getContext('i18n');\n\n\texport let initNewChat: Function;\n\texport let title: string = $WEBUI_NAME;\n\texport let shareEnabled: boolean = false;\n\n\texport let chat;\n\texport let selectedModels;\n\n\texport let showModelSelector = true;\n\texport let showControls = false;\n\n\tlet showShareChatModal = false;\n\tlet showDownloadChatModal = false;\n</script>\n\n<ShareChatModal bind:show={showShareChatModal} chatId={$chatId} />\n<nav id=\"nav\" class=\" sticky py-2.5 top-0 flex flex-row justify-center z-10\">\n\t<div class=\" flex max-w-full w-full mx-auto px-5 pt-0.5 md:px-[1rem]\">\n\t\t<div class=\"flex items-center w-full max-w-full\">\n\t\t\t<div\n\t\t\t\tclass=\"{$showSidebar\n\t\t\t\t\t? 'md:hidden'\n\t\t\t\t\t: ''} mr-3 self-start flex flex-none items-center text-gray-600 dark:text-gray-400\"\n\t\t\t>\n\t\t\t\t<button\n\t\t\t\t\tid=\"sidebar-toggle-button\"\n\t\t\t\t\tclass=\"cursor-pointer px-2 py-2 flex rounded-xl hover:bg-gray-50 dark:hover:bg-gray-850 transition\"\n\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\tshowSidebar.set(!$showSidebar);\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<div class=\" m-auto self-center\">\n\t\t\t\t\t\t<MenuLines />\n\t\t\t\t\t</div>\n\t\t\t\t</button>\n\t\t\t</div>\n\n\t\t\t<div class=\"flex-1 overflow-hidden max-w-full\">\n\t\t\t\t{#if showModelSelector}\n\t\t\t\t\t<ModelSelector bind:selectedModels showSetDefault={!shareEnabled} />\n\t\t\t\t{/if}\n\t\t\t</div>\n\n\t\t\t<div class=\"self-start flex flex-none items-center text-gray-600 dark:text-gray-400\">\n\t\t\t\t<!-- <div class=\"md:hidden flex self-center w-[1px] h-5 mx-2 bg-gray-300 dark:bg-stone-700\" /> -->\n\n\t\t\t\t{#if shareEnabled && chat && chat.id}\n\t\t\t\t\t<Menu\n\t\t\t\t\t\t{chat}\n\t\t\t\t\t\t{shareEnabled}\n\t\t\t\t\t\tshareHandler={() => {\n\t\t\t\t\t\t\tshowShareChatModal = !showShareChatModal;\n\t\t\t\t\t\t}}\n\t\t\t\t\t\tdownloadHandler={() => {\n\t\t\t\t\t\t\tshowDownloadChatModal = !showDownloadChatModal;\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclass=\"hidden md:flex cursor-pointer px-2 py-2 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-850 transition\"\n\t\t\t\t\t\t\tid=\"chat-context-menu-button\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div class=\" m-auto self-center\">\n\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\tstroke-width=\"1.5\"\n\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t\tclass=\"size-5\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\t\td=\"M6.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM12.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM18.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0Z\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</Menu>\n\t\t\t\t{/if}\n\n\t\t\t\t<Tooltip content={$i18n.t('Controls')}>\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\" flex cursor-pointer px-2 py-2 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-850 transition\"\n\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\tshowControls = !showControls;\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\" m-auto self-center\">\n\t\t\t\t\t\t\t<AdjustmentsHorizontal className=\" size-5\" strokeWidth=\"0.5\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</button>\n\t\t\t\t</Tooltip>\n\n\t\t\t\t<Tooltip content={$i18n.t('New Chat')}>\n\t\t\t\t\t<button\n\t\t\t\t\t\tid=\"new-chat-button\"\n\t\t\t\t\t\tclass=\" flex {$showSidebar\n\t\t\t\t\t\t\t? 'md:hidden'\n\t\t\t\t\t\t\t: ''} cursor-pointer px-2 py-2 rounded-xl text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-850 transition\"\n\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\tinitNewChat();\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\" m-auto self-center\">\n\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\tviewBox=\"0 0 20 20\"\n\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\tclass=\"w-5 h-5\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\td=\"M5.433 13.917l1.262-3.155A4 4 0 017.58 9.42l6.92-6.918a2.121 2.121 0 013 3l-6.92 6.918c-.383.383-.84.685-1.343.886l-3.154 1.262a.5.5 0 01-.65-.65z\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\td=\"M3.5 5.75c0-.69.56-1.25 1.25-1.25H10A.75.75 0 0010 3H4.75A2.75 2.75 0 002 5.75v9.5A2.75 2.75 0 004.75 18h9.5A2.75 2.75 0 0017 15.25V10a.75.75 0 00-1.5 0v5.25c0 .69-.56 1.25-1.25 1.25h-9.5c-.69 0-1.25-.56-1.25-1.25v-9.5z\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</button>\n\t\t\t\t</Tooltip>\n\n\t\t\t\t{#if $user !== undefined}\n\t\t\t\t\t<UserMenu\n\t\t\t\t\t\tclassName=\"max-w-[200px]\"\n\t\t\t\t\t\trole={$user.role}\n\t\t\t\t\t\ton:show={(e) => {\n\t\t\t\t\t\t\tif (e.detail === 'archived-chat') {\n\t\t\t\t\t\t\t\tshowArchivedChats.set(true);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclass=\"select-none flex rounded-xl p-1.5 w-full hover:bg-gray-50 dark:hover:bg-gray-850 transition\"\n\t\t\t\t\t\t\taria-label=\"User Menu\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div class=\" self-center\">\n\t\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\t\tsrc={$user.profile_image_url}\n\t\t\t\t\t\t\t\t\tclass=\"size-6 object-cover rounded-full\"\n\t\t\t\t\t\t\t\t\talt=\"User profile\"\n\t\t\t\t\t\t\t\t\tdraggable=\"false\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</UserMenu>\n\t\t\t\t{/if}\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</nav>\n","<script lang=\"ts\">\n\timport { DropdownMenu } from 'bits-ui';\n\timport { flyAndScale } from '$lib/utils/transitions';\n\timport { getContext, createEventDispatcher } from 'svelte';\n\n\tconst i18n = getContext('i18n');\n\tconst dispatch = createEventDispatcher();\n\n\timport Dropdown from '$lib/components/common/Dropdown.svelte';\n\n\texport let onClose: Function = () => {};\n\texport let devices: any;\n\n\tlet show = false;\n</script>\n\n<Dropdown\n\tbind:show\n\ton:change={(e) => {\n\t\tif (e.detail === false) {\n\t\t\tonClose();\n\t\t}\n\t}}\n>\n\t<slot />\n\n\t<div slot=\"content\">\n\t\t<DropdownMenu.Content\n\t\t\tclass=\"w-full max-w-[180px] rounded-lg px-1 py-1.5 border border-gray-300/30 dark:border-gray-700/50 z-[9999] bg-white dark:bg-gray-900 dark:text-white shadow-sm\"\n\t\t\tsideOffset={6}\n\t\t\tside=\"top\"\n\t\t\talign=\"start\"\n\t\t\ttransition={flyAndScale}\n\t\t>\n\t\t\t{#each devices as device}\n\t\t\t\t<DropdownMenu.Item\n\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md\"\n\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\tdispatch('change', device.deviceId);\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<div class=\"flex items-center\">\n\t\t\t\t\t\t<div class=\" line-clamp-1\">\n\t\t\t\t\t\t\t{device?.label ?? 'Camera'}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</DropdownMenu.Item>\n\t\t\t{/each}\n\t\t</DropdownMenu.Content>\n\t</div>\n</Dropdown>\n","<script lang=\"ts\">\n\timport { config, models, settings, showCallOverlay } from '$lib/stores';\n\timport { onMount, tick, getContext } from 'svelte';\n\n\timport {\n\t\tblobToFile,\n\t\tcalculateSHA256,\n\t\textractSentencesForAudio,\n\t\tfindWordIndices\n\t} from '$lib/utils';\n\timport { generateEmoji } from '$lib/apis';\n\timport { synthesizeOpenAISpeech, transcribeAudio } from '$lib/apis/audio';\n\n\timport { toast } from 'svelte-sonner';\n\n\timport Tooltip from '$lib/components/common/Tooltip.svelte';\n\timport VideoInputMenu from './CallOverlay/VideoInputMenu.svelte';\n\n\tconst i18n = getContext('i18n');\n\n\texport let eventTarget: EventTarget;\n\n\texport let submitPrompt: Function;\n\texport let stopResponse: Function;\n\n\texport let files;\n\n\texport let chatId;\n\texport let modelId;\n\n\tlet model = null;\n\n\tlet loading = false;\n\tlet confirmed = false;\n\tlet interrupted = false;\n\tlet assistantSpeaking = false;\n\n\tlet emoji = null;\n\n\tlet camera = false;\n\tlet cameraStream = null;\n\n\tlet chatStreaming = false;\n\n\tlet rmsLevel = 0;\n\tlet hasStartedSpeaking = false;\n\tlet mediaRecorder;\n\tlet audioChunks = [];\n\n\tlet videoInputDevices = [];\n\tlet selectedVideoInputDeviceId = null;\n\n\tconst getVideoInputDevices = async () => {\n\t\tconst devices = await navigator.mediaDevices.enumerateDevices();\n\t\tvideoInputDevices = devices.filter((device) => device.kind === 'videoinput');\n\n\t\tif (!!navigator.mediaDevices.getDisplayMedia) {\n\t\t\tvideoInputDevices = [\n\t\t\t\t...videoInputDevices,\n\t\t\t\t{\n\t\t\t\t\tdeviceId: 'screen',\n\t\t\t\t\tlabel: 'Screen Share'\n\t\t\t\t}\n\t\t\t];\n\t\t}\n\n\t\tconsole.log(videoInputDevices);\n\t\tif (selectedVideoInputDeviceId === null && videoInputDevices.length > 0) {\n\t\t\tselectedVideoInputDeviceId = videoInputDevices[0].deviceId;\n\t\t}\n\t};\n\n\tconst startCamera = async () => {\n\t\tawait getVideoInputDevices();\n\n\t\tif (cameraStream === null) {\n\t\t\tcamera = true;\n\t\t\tawait tick();\n\t\t\ttry {\n\t\t\t\tawait startVideoStream();\n\t\t\t} catch (err) {\n\t\t\t\tconsole.error('Error accessing webcam: ', err);\n\t\t\t}\n\t\t}\n\t};\n\n\tconst startVideoStream = async () => {\n\t\tconst video = document.getElementById('camera-feed');\n\t\tif (video) {\n\t\t\tif (selectedVideoInputDeviceId === 'screen') {\n\t\t\t\tcameraStream = await navigator.mediaDevices.getDisplayMedia({\n\t\t\t\t\tvideo: {\n\t\t\t\t\t\tcursor: 'always'\n\t\t\t\t\t},\n\t\t\t\t\taudio: false\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tcameraStream = await navigator.mediaDevices.getUserMedia({\n\t\t\t\t\tvideo: {\n\t\t\t\t\t\tdeviceId: selectedVideoInputDeviceId ? { exact: selectedVideoInputDeviceId } : undefined\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (cameraStream) {\n\t\t\t\tawait getVideoInputDevices();\n\t\t\t\tvideo.srcObject = cameraStream;\n\t\t\t\tawait video.play();\n\t\t\t}\n\t\t}\n\t};\n\n\tconst stopVideoStream = async () => {\n\t\tif (cameraStream) {\n\t\t\tconst tracks = cameraStream.getTracks();\n\t\t\ttracks.forEach((track) => track.stop());\n\t\t}\n\n\t\tcameraStream = null;\n\t};\n\n\tconst takeScreenshot = () => {\n\t\tconst video = document.getElementById('camera-feed');\n\t\tconst canvas = document.getElementById('camera-canvas');\n\n\t\tif (!canvas) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst context = canvas.getContext('2d');\n\n\t\t// Make the canvas match the video dimensions\n\t\tcanvas.width = video.videoWidth;\n\t\tcanvas.height = video.videoHeight;\n\n\t\t// Draw the image from the video onto the canvas\n\t\tcontext.drawImage(video, 0, 0, video.videoWidth, video.videoHeight);\n\n\t\t// Convert the canvas to a data base64 URL and console log it\n\t\tconst dataURL = canvas.toDataURL('image/png');\n\t\tconsole.log(dataURL);\n\n\t\treturn dataURL;\n\t};\n\n\tconst stopCamera = async () => {\n\t\tawait stopVideoStream();\n\t\tcamera = false;\n\t};\n\n\tconst MIN_DECIBELS = -55;\n\tconst VISUALIZER_BUFFER_LENGTH = 300;\n\n\tconst transcribeHandler = async (audioBlob) => {\n\t\t// Create a blob from the audio chunks\n\n\t\tawait tick();\n\t\tconst file = blobToFile(audioBlob, 'recording.wav');\n\n\t\tconst res = await transcribeAudio(localStorage.token, file).catch((error) => {\n\t\t\ttoast.error(error);\n\t\t\treturn null;\n\t\t});\n\n\t\tif (res) {\n\t\t\tconsole.log(res.text);\n\n\t\t\tif (res.text !== '') {\n\t\t\t\tconst _responses = await submitPrompt(res.text, { _raw: true });\n\t\t\t\tconsole.log(_responses);\n\t\t\t}\n\t\t}\n\t};\n\n\tconst stopRecordingCallback = async (_continue = true) => {\n\t\tif ($showCallOverlay) {\n\t\t\tconsole.log('%c%s', 'color: red; font-size: 20px;', ' stopRecordingCallback ');\n\n\t\t\t// deep copy the audioChunks array\n\t\t\tconst _audioChunks = audioChunks.slice(0);\n\n\t\t\taudioChunks = [];\n\t\t\tmediaRecorder = false;\n\n\t\t\tif (_continue) {\n\t\t\t\tstartRecording();\n\t\t\t}\n\n\t\t\tif (confirmed) {\n\t\t\t\tloading = true;\n\t\t\t\temoji = null;\n\n\t\t\t\tif (cameraStream) {\n\t\t\t\t\tconst imageUrl = takeScreenshot();\n\n\t\t\t\t\tfiles = [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttype: 'image',\n\t\t\t\t\t\t\turl: imageUrl\n\t\t\t\t\t\t}\n\t\t\t\t\t];\n\t\t\t\t}\n\n\t\t\t\tconst audioBlob = new Blob(_audioChunks, { type: 'audio/wav' });\n\t\t\t\tawait transcribeHandler(audioBlob);\n\n\t\t\t\tconfirmed = false;\n\t\t\t\tloading = false;\n\t\t\t}\n\t\t} else {\n\t\t\taudioChunks = [];\n\t\t\tmediaRecorder = false;\n\t\t}\n\t};\n\n\tconst startRecording = async () => {\n\t\tconst stream = await navigator.mediaDevices.getUserMedia({ audio: true });\n\t\tmediaRecorder = new MediaRecorder(stream);\n\n\t\tmediaRecorder.onstart = () => {\n\t\t\tconsole.log('Recording started');\n\t\t\taudioChunks = [];\n\t\t\tanalyseAudio(stream);\n\t\t};\n\n\t\tmediaRecorder.ondataavailable = (event) => {\n\t\t\tif (hasStartedSpeaking) {\n\t\t\t\taudioChunks.push(event.data);\n\t\t\t}\n\t\t};\n\n\t\tmediaRecorder.onstop = (e) => {\n\t\t\tconsole.log('Recording stopped', e);\n\t\t\tstopRecordingCallback();\n\t\t};\n\n\t\tmediaRecorder.start();\n\t};\n\n\t// Function to calculate the RMS level from time domain data\n\tconst calculateRMS = (data: Uint8Array) => {\n\t\tlet sumSquares = 0;\n\t\tfor (let i = 0; i < data.length; i++) {\n\t\t\tconst normalizedValue = (data[i] - 128) / 128; // Normalize the data\n\t\t\tsumSquares += normalizedValue * normalizedValue;\n\t\t}\n\t\treturn Math.sqrt(sumSquares / data.length);\n\t};\n\n\tconst analyseAudio = (stream) => {\n\t\tconst audioContext = new AudioContext();\n\t\tconst audioStreamSource = audioContext.createMediaStreamSource(stream);\n\n\t\tconst analyser = audioContext.createAnalyser();\n\t\tanalyser.minDecibels = MIN_DECIBELS;\n\t\taudioStreamSource.connect(analyser);\n\n\t\tconst bufferLength = analyser.frequencyBinCount;\n\n\t\tconst domainData = new Uint8Array(bufferLength);\n\t\tconst timeDomainData = new Uint8Array(analyser.fftSize);\n\n\t\tlet lastSoundTime = Date.now();\n\t\thasStartedSpeaking = false;\n\n\t\tconsole.log(' Sound detection started', lastSoundTime, hasStartedSpeaking);\n\n\t\tconst detectSound = () => {\n\t\t\tconst processFrame = () => {\n\t\t\t\tif (!mediaRecorder || !$showCallOverlay) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (assistantSpeaking && !($settings?.voiceInterruption ?? false)) {\n\t\t\t\t\t// Mute the audio if the assistant is speaking\n\t\t\t\t\tanalyser.maxDecibels = 0;\n\t\t\t\t\tanalyser.minDecibels = -1;\n\t\t\t\t} else {\n\t\t\t\t\tanalyser.minDecibels = MIN_DECIBELS;\n\t\t\t\t\tanalyser.maxDecibels = -30;\n\t\t\t\t}\n\n\t\t\t\tanalyser.getByteTimeDomainData(timeDomainData);\n\t\t\t\tanalyser.getByteFrequencyData(domainData);\n\n\t\t\t\t// Calculate RMS level from time domain data\n\t\t\t\trmsLevel = calculateRMS(timeDomainData);\n\n\t\t\t\t// Check if initial speech/noise has started\n\t\t\t\tconst hasSound = domainData.some((value) => value > 0);\n\t\t\t\tif (hasSound) {\n\t\t\t\t\t// BIG RED TEXT\n\t\t\t\t\tconsole.log('%c%s', 'color: red; font-size: 20px;', ' Sound detected');\n\n\t\t\t\t\tif (!hasStartedSpeaking) {\n\t\t\t\t\t\thasStartedSpeaking = true;\n\t\t\t\t\t\tstopAllAudio();\n\t\t\t\t\t}\n\n\t\t\t\t\tlastSoundTime = Date.now();\n\t\t\t\t}\n\n\t\t\t\t// Start silence detection only after initial speech/noise has been detected\n\t\t\t\tif (hasStartedSpeaking) {\n\t\t\t\t\tif (Date.now() - lastSoundTime > 2000) {\n\t\t\t\t\t\tconfirmed = true;\n\n\t\t\t\t\t\tif (mediaRecorder) {\n\t\t\t\t\t\t\tconsole.log('%c%s', 'color: red; font-size: 20px;', ' Silence detected');\n\t\t\t\t\t\t\tmediaRecorder.stop();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\twindow.requestAnimationFrame(processFrame);\n\t\t\t};\n\n\t\t\twindow.requestAnimationFrame(processFrame);\n\t\t};\n\n\t\tdetectSound();\n\t};\n\n\tlet finishedMessages = {};\n\tlet currentMessageId = null;\n\tlet currentUtterance = null;\n\n\tconst speakSpeechSynthesisHandler = (content) => {\n\t\tif ($showCallOverlay) {\n\t\t\treturn new Promise((resolve) => {\n\t\t\t\tlet voices = [];\n\t\t\t\tconst getVoicesLoop = setInterval(async () => {\n\t\t\t\t\tvoices = await speechSynthesis.getVoices();\n\t\t\t\t\tif (voices.length > 0) {\n\t\t\t\t\t\tclearInterval(getVoicesLoop);\n\n\t\t\t\t\t\tconst voice =\n\t\t\t\t\t\t\tvoices\n\t\t\t\t\t\t\t\t?.filter(\n\t\t\t\t\t\t\t\t\t(v) => v.voiceURI === ($settings?.audio?.tts?.voice ?? $config?.audio?.tts?.voice)\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t?.at(0) ?? undefined;\n\n\t\t\t\t\t\tcurrentUtterance = new SpeechSynthesisUtterance(content);\n\n\t\t\t\t\t\tif (voice) {\n\t\t\t\t\t\t\tcurrentUtterance.voice = voice;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tspeechSynthesis.speak(currentUtterance);\n\t\t\t\t\t\tcurrentUtterance.onend = async (e) => {\n\t\t\t\t\t\t\tawait new Promise((r) => setTimeout(r, 200));\n\t\t\t\t\t\t\tresolve(e);\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t}, 100);\n\t\t\t});\n\t\t} else {\n\t\t\treturn Promise.resolve();\n\t\t}\n\t};\n\n\tconst playAudio = (audio) => {\n\t\tif ($showCallOverlay) {\n\t\t\treturn new Promise((resolve) => {\n\t\t\t\tconst audioElement = document.getElementById('audioElement');\n\n\t\t\t\tif (audioElement) {\n\t\t\t\t\taudioElement.src = audio.src;\n\t\t\t\t\taudioElement.muted = true;\n\n\t\t\t\t\taudioElement\n\t\t\t\t\t\t.play()\n\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\taudioElement.muted = false;\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch((error) => {\n\t\t\t\t\t\t\tconsole.error(error);\n\t\t\t\t\t\t});\n\n\t\t\t\t\taudioElement.onended = async (e) => {\n\t\t\t\t\t\tawait new Promise((r) => setTimeout(r, 100));\n\t\t\t\t\t\tresolve(e);\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\treturn Promise.resolve();\n\t\t}\n\t};\n\n\tconst stopAllAudio = async () => {\n\t\tassistantSpeaking = false;\n\t\tinterrupted = true;\n\n\t\tif (chatStreaming) {\n\t\t\tstopResponse();\n\t\t}\n\n\t\tif (currentUtterance) {\n\t\t\tspeechSynthesis.cancel();\n\t\t\tcurrentUtterance = null;\n\t\t}\n\n\t\tconst audioElement = document.getElementById('audioElement');\n\t\tif (audioElement) {\n\t\t\taudioElement.muted = true;\n\t\t\taudioElement.pause();\n\t\t\taudioElement.currentTime = 0;\n\t\t}\n\t};\n\n\tlet audioAbortController = new AbortController();\n\n\t// Audio cache map where key is the content and value is the Audio object.\n\tconst audioCache = new Map();\n\tconst emojiCache = new Map();\n\n\tconst fetchAudio = async (content) => {\n\t\tif (!audioCache.has(content)) {\n\t\t\ttry {\n\t\t\t\t// Set the emoji for the content if needed\n\t\t\t\tif ($settings?.showEmojiInCall ?? false) {\n\t\t\t\t\tconst emoji = await generateEmoji(localStorage.token, modelId, content, chatId);\n\t\t\t\t\tif (emoji) {\n\t\t\t\t\t\temojiCache.set(content, emoji);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif ($config.audio.tts.engine !== '') {\n\t\t\t\t\tconst res = await synthesizeOpenAISpeech(\n\t\t\t\t\t\tlocalStorage.token,\n\t\t\t\t\t\t$settings?.audio?.tts?.voice ?? $config?.audio?.tts?.voice,\n\t\t\t\t\t\tcontent\n\t\t\t\t\t).catch((error) => {\n\t\t\t\t\t\tconsole.error(error);\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t});\n\n\t\t\t\t\tif (res) {\n\t\t\t\t\t\tconst blob = await res.blob();\n\t\t\t\t\t\tconst blobUrl = URL.createObjectURL(blob);\n\t\t\t\t\t\taudioCache.set(content, new Audio(blobUrl));\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\taudioCache.set(content, true);\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error('Error synthesizing speech:', error);\n\t\t\t}\n\t\t}\n\n\t\treturn audioCache.get(content);\n\t};\n\n\tlet messages = {};\n\n\tconst monitorAndPlayAudio = async (id, signal) => {\n\t\twhile (!signal.aborted) {\n\t\t\tif (messages[id] && messages[id].length > 0) {\n\t\t\t\t// Retrieve the next content string from the queue\n\t\t\t\tconst content = messages[id].shift(); // Dequeues the content for playing\n\n\t\t\t\tif (audioCache.has(content)) {\n\t\t\t\t\t// If content is available in the cache, play it\n\n\t\t\t\t\t// Set the emoji for the content if available\n\t\t\t\t\tif (($settings?.showEmojiInCall ?? false) && emojiCache.has(content)) {\n\t\t\t\t\t\temoji = emojiCache.get(content);\n\t\t\t\t\t} else {\n\t\t\t\t\t\temoji = null;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ($config.audio.tts.engine !== '') {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconsole.log(\n\t\t\t\t\t\t\t\t'%c%s',\n\t\t\t\t\t\t\t\t'color: red; font-size: 20px;',\n\t\t\t\t\t\t\t\t`Playing audio for content: ${content}`\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\tconst audio = audioCache.get(content);\n\t\t\t\t\t\t\tawait playAudio(audio); // Here ensure that playAudio is indeed correct method to execute\n\t\t\t\t\t\t\tconsole.log(`Played audio for content: ${content}`);\n\t\t\t\t\t\t\tawait new Promise((resolve) => setTimeout(resolve, 200)); // Wait before retrying to reduce tight loop\n\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\tconsole.error('Error playing audio:', error);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tawait speakSpeechSynthesisHandler(content);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// If not available in the cache, push it back to the queue and delay\n\t\t\t\t\tmessages[id].unshift(content); // Re-queue the content at the start\n\t\t\t\t\tconsole.log(`Audio for \"${content}\" not yet available in the cache, re-queued...`);\n\t\t\t\t\tawait new Promise((resolve) => setTimeout(resolve, 200)); // Wait before retrying to reduce tight loop\n\t\t\t\t}\n\t\t\t} else if (finishedMessages[id] && messages[id] && messages[id].length === 0) {\n\t\t\t\t// If the message is finished and there are no more messages to process, break the loop\n\t\t\t\tassistantSpeaking = false;\n\t\t\t\tbreak;\n\t\t\t} else {\n\t\t\t\t// No messages to process, sleep for a bit\n\t\t\t\tawait new Promise((resolve) => setTimeout(resolve, 200));\n\t\t\t}\n\t\t}\n\t\tconsole.log(`Audio monitoring and playing stopped for message ID ${id}`);\n\t};\n\n\tonMount(async () => {\n\t\tmodel = $models.find((m) => m.id === modelId);\n\n\t\tstartRecording();\n\n\t\tconst chatStartHandler = async (e) => {\n\t\t\tconst { id } = e.detail;\n\n\t\t\tchatStreaming = true;\n\n\t\t\tif (currentMessageId !== id) {\n\t\t\t\tconsole.log(`Received chat start event for message ID ${id}`);\n\n\t\t\t\tcurrentMessageId = id;\n\t\t\t\tif (audioAbortController) {\n\t\t\t\t\taudioAbortController.abort();\n\t\t\t\t}\n\t\t\t\taudioAbortController = new AbortController();\n\n\t\t\t\tassistantSpeaking = true;\n\t\t\t\t// Start monitoring and playing audio for the message ID\n\t\t\t\tmonitorAndPlayAudio(id, audioAbortController.signal);\n\t\t\t}\n\t\t};\n\n\t\tconst chatEventHandler = async (e) => {\n\t\t\tconst { id, content } = e.detail;\n\t\t\t// \"id\" here is message id\n\t\t\t// if \"id\" is not the same as \"currentMessageId\" then do not process\n\t\t\t// \"content\" here is a sentence from the assistant,\n\t\t\t// there will be many sentences for the same \"id\"\n\n\t\t\tif (currentMessageId === id) {\n\t\t\t\tconsole.log(`Received chat event for message ID ${id}: ${content}`);\n\n\t\t\t\ttry {\n\t\t\t\t\tif (messages[id] === undefined) {\n\t\t\t\t\t\tmessages[id] = [content];\n\t\t\t\t\t} else {\n\t\t\t\t\t\tmessages[id].push(content);\n\t\t\t\t\t}\n\n\t\t\t\t\tconsole.log(content);\n\n\t\t\t\t\tfetchAudio(content);\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.error('Failed to fetch or play audio:', error);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tconst chatFinishHandler = async (e) => {\n\t\t\tconst { id, content } = e.detail;\n\t\t\t// \"content\" here is the entire message from the assistant\n\t\t\tfinishedMessages[id] = true;\n\n\t\t\tchatStreaming = false;\n\t\t};\n\n\t\teventTarget.addEventListener('chat:start', chatStartHandler);\n\t\teventTarget.addEventListener('chat', chatEventHandler);\n\t\teventTarget.addEventListener('chat:finish', chatFinishHandler);\n\n\t\treturn async () => {\n\t\t\teventTarget.removeEventListener('chat:start', chatStartHandler);\n\t\t\teventTarget.removeEventListener('chat', chatEventHandler);\n\t\t\teventTarget.removeEventListener('chat:finish', chatFinishHandler);\n\n\t\t\taudioAbortController.abort();\n\t\t\tawait tick();\n\n\t\t\tawait stopAllAudio();\n\n\t\t\tawait stopRecordingCallback(false);\n\t\t\tawait stopCamera();\n\t\t};\n\t});\n</script>\n\n{#if $showCallOverlay}\n\t<div class=\" absolute w-full h-screen max-h-[100dvh] flex z-[999] overflow-hidden\">\n\t\t<div\n\t\t\tclass=\"absolute w-full h-screen max-h-[100dvh] bg-white text-gray-700 dark:bg-black dark:text-gray-300 flex justify-center\"\n\t\t>\n\t\t\t<div class=\"max-w-lg w-full h-screen max-h-[100dvh] flex flex-col justify-between p-3 md:p-6\">\n\t\t\t\t{#if camera}\n\t\t\t\t\t<button\n\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\tclass=\"flex justify-center items-center w-full h-20 min-h-20\"\n\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\tif (assistantSpeaking) {\n\t\t\t\t\t\t\t\tstopAllAudio();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t{#if emoji}\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\"  transition-all rounded-full\"\n\t\t\t\t\t\t\t\tstyle=\"font-size:{rmsLevel * 100 > 4\n\t\t\t\t\t\t\t\t\t? '4.5'\n\t\t\t\t\t\t\t\t\t: rmsLevel * 100 > 2\n\t\t\t\t\t\t\t\t\t? '4.25'\n\t\t\t\t\t\t\t\t\t: rmsLevel * 100 > 1\n\t\t\t\t\t\t\t\t\t? '3.75'\n\t\t\t\t\t\t\t\t\t: '3.5'}rem;width: 100%; text-align:center;\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{emoji}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{:else if loading || assistantSpeaking}\n\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\tclass=\"size-12 text-gray-900 dark:text-gray-400\"\n\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t><style>\n\t\t\t\t\t\t\t\t\t.spinner_qM83 {\n\t\t\t\t\t\t\t\t\t\tanimation: spinner_8HQG 1.05s infinite;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t.spinner_oXPr {\n\t\t\t\t\t\t\t\t\t\tanimation-delay: 0.1s;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t.spinner_ZTLf {\n\t\t\t\t\t\t\t\t\t\tanimation-delay: 0.2s;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t@keyframes spinner_8HQG {\n\t\t\t\t\t\t\t\t\t\t0%,\n\t\t\t\t\t\t\t\t\t\t57.14% {\n\t\t\t\t\t\t\t\t\t\t\tanimation-timing-function: cubic-bezier(0.33, 0.66, 0.66, 1);\n\t\t\t\t\t\t\t\t\t\t\ttransform: translate(0);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t28.57% {\n\t\t\t\t\t\t\t\t\t\t\tanimation-timing-function: cubic-bezier(0.33, 0, 0.66, 0.33);\n\t\t\t\t\t\t\t\t\t\t\ttransform: translateY(-6px);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t100% {\n\t\t\t\t\t\t\t\t\t\t\ttransform: translate(0);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t</style><circle class=\"spinner_qM83\" cx=\"4\" cy=\"12\" r=\"3\" /><circle\n\t\t\t\t\t\t\t\t\tclass=\"spinner_qM83 spinner_oXPr\"\n\t\t\t\t\t\t\t\t\tcx=\"12\"\n\t\t\t\t\t\t\t\t\tcy=\"12\"\n\t\t\t\t\t\t\t\t\tr=\"3\"\n\t\t\t\t\t\t\t\t/><circle class=\"spinner_qM83 spinner_ZTLf\" cx=\"20\" cy=\"12\" r=\"3\" /></svg\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\" {rmsLevel * 100 > 4\n\t\t\t\t\t\t\t\t\t? ' size-[4.5rem]'\n\t\t\t\t\t\t\t\t\t: rmsLevel * 100 > 2\n\t\t\t\t\t\t\t\t\t? ' size-16'\n\t\t\t\t\t\t\t\t\t: rmsLevel * 100 > 1\n\t\t\t\t\t\t\t\t\t? 'size-14'\n\t\t\t\t\t\t\t\t\t: 'size-12'}  transition-all rounded-full {(model?.info?.meta\n\t\t\t\t\t\t\t\t\t?.profile_image_url ?? '/static/favicon.png') !== '/static/favicon.png'\n\t\t\t\t\t\t\t\t\t? ' bg-cover bg-center bg-no-repeat'\n\t\t\t\t\t\t\t\t\t: 'bg-black dark:bg-white'}  bg-black dark:bg-white\"\n\t\t\t\t\t\t\t\tstyle={(model?.info?.meta?.profile_image_url ?? '/static/favicon.png') !==\n\t\t\t\t\t\t\t\t'/static/favicon.png'\n\t\t\t\t\t\t\t\t\t? `background-image: url('${model?.info?.meta?.profile_image_url}');`\n\t\t\t\t\t\t\t\t\t: ''}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t<!-- navbar -->\n\t\t\t\t\t</button>\n\t\t\t\t{/if}\n\n\t\t\t\t<div class=\"flex justify-center items-center flex-1 h-full w-full max-h-full\">\n\t\t\t\t\t{#if !camera}\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\tif (assistantSpeaking) {\n\t\t\t\t\t\t\t\t\tstopAllAudio();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{#if emoji}\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tclass=\"  transition-all rounded-full\"\n\t\t\t\t\t\t\t\t\tstyle=\"font-size:{rmsLevel * 100 > 4\n\t\t\t\t\t\t\t\t\t\t? '13'\n\t\t\t\t\t\t\t\t\t\t: rmsLevel * 100 > 2\n\t\t\t\t\t\t\t\t\t\t? '12'\n\t\t\t\t\t\t\t\t\t\t: rmsLevel * 100 > 1\n\t\t\t\t\t\t\t\t\t\t? '11.5'\n\t\t\t\t\t\t\t\t\t\t: '11'}rem;width:100%;text-align:center;\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{emoji}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{:else if loading || assistantSpeaking}\n\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\tclass=\"size-44 text-gray-900 dark:text-gray-400\"\n\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t><style>\n\t\t\t\t\t\t\t\t\t\t.spinner_qM83 {\n\t\t\t\t\t\t\t\t\t\t\tanimation: spinner_8HQG 1.05s infinite;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t.spinner_oXPr {\n\t\t\t\t\t\t\t\t\t\t\tanimation-delay: 0.1s;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t.spinner_ZTLf {\n\t\t\t\t\t\t\t\t\t\t\tanimation-delay: 0.2s;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t@keyframes spinner_8HQG {\n\t\t\t\t\t\t\t\t\t\t\t0%,\n\t\t\t\t\t\t\t\t\t\t\t57.14% {\n\t\t\t\t\t\t\t\t\t\t\t\tanimation-timing-function: cubic-bezier(0.33, 0.66, 0.66, 1);\n\t\t\t\t\t\t\t\t\t\t\t\ttransform: translate(0);\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t28.57% {\n\t\t\t\t\t\t\t\t\t\t\t\tanimation-timing-function: cubic-bezier(0.33, 0, 0.66, 0.33);\n\t\t\t\t\t\t\t\t\t\t\t\ttransform: translateY(-6px);\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t100% {\n\t\t\t\t\t\t\t\t\t\t\t\ttransform: translate(0);\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t</style><circle class=\"spinner_qM83\" cx=\"4\" cy=\"12\" r=\"3\" /><circle\n\t\t\t\t\t\t\t\t\t\tclass=\"spinner_qM83 spinner_oXPr\"\n\t\t\t\t\t\t\t\t\t\tcx=\"12\"\n\t\t\t\t\t\t\t\t\t\tcy=\"12\"\n\t\t\t\t\t\t\t\t\t\tr=\"3\"\n\t\t\t\t\t\t\t\t\t/><circle class=\"spinner_qM83 spinner_ZTLf\" cx=\"20\" cy=\"12\" r=\"3\" /></svg\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tclass=\" {rmsLevel * 100 > 4\n\t\t\t\t\t\t\t\t\t\t? ' size-52'\n\t\t\t\t\t\t\t\t\t\t: rmsLevel * 100 > 2\n\t\t\t\t\t\t\t\t\t\t? 'size-48'\n\t\t\t\t\t\t\t\t\t\t: rmsLevel * 100 > 1\n\t\t\t\t\t\t\t\t\t\t? 'size-[11.5rem]'\n\t\t\t\t\t\t\t\t\t\t: 'size-44'}  transition-all rounded-full {(model?.info?.meta\n\t\t\t\t\t\t\t\t\t\t?.profile_image_url ?? '/static/favicon.png') !== '/static/favicon.png'\n\t\t\t\t\t\t\t\t\t\t? ' bg-cover bg-center bg-no-repeat'\n\t\t\t\t\t\t\t\t\t\t: 'bg-black dark:bg-white'} \"\n\t\t\t\t\t\t\t\t\tstyle={(model?.info?.meta?.profile_image_url ?? '/static/favicon.png') !==\n\t\t\t\t\t\t\t\t\t'/static/favicon.png'\n\t\t\t\t\t\t\t\t\t\t? `background-image: url('${model?.info?.meta?.profile_image_url}');`\n\t\t\t\t\t\t\t\t\t\t: ''}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t</button>\n\t\t\t\t\t{:else}\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass=\"relative flex video-container w-full max-h-full pt-2 pb-4 md:py-6 px-2 h-full\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<video\n\t\t\t\t\t\t\t\tid=\"camera-feed\"\n\t\t\t\t\t\t\t\tautoplay\n\t\t\t\t\t\t\t\tclass=\"rounded-2xl h-full min-w-full object-cover object-center\"\n\t\t\t\t\t\t\t\tplaysinline\n\t\t\t\t\t\t\t/>\n\n\t\t\t\t\t\t\t<canvas id=\"camera-canvas\" style=\"display:none;\" />\n\n\t\t\t\t\t\t\t<div class=\" absolute top-4 md:top-8 left-4\">\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\tclass=\"p-1.5 text-white cursor-pointer backdrop-blur-xl bg-black/10 rounded-full\"\n\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\tstopCamera();\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 16 16\"\n\t\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\tclass=\"size-6\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\td=\"M5.28 4.22a.75.75 0 0 0-1.06 1.06L6.94 8l-2.72 2.72a.75.75 0 1 0 1.06 1.06L8 9.06l2.72 2.72a.75.75 0 1 0 1.06-1.06L9.06 8l2.72-2.72a.75.75 0 0 0-1.06-1.06L8 6.94 5.28 4.22Z\"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"flex justify-between items-center pb-2 w-full\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t{#if camera}\n\t\t\t\t\t\t\t<VideoInputMenu\n\t\t\t\t\t\t\t\tdevices={videoInputDevices}\n\t\t\t\t\t\t\t\ton:change={async (e) => {\n\t\t\t\t\t\t\t\t\tconsole.log(e.detail);\n\t\t\t\t\t\t\t\t\tselectedVideoInputDeviceId = e.detail;\n\t\t\t\t\t\t\t\t\tawait stopVideoStream();\n\t\t\t\t\t\t\t\t\tawait startVideoStream();\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<button class=\" p-3 rounded-full bg-gray-50 dark:bg-gray-900\" type=\"button\">\n\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 20 20\"\n\t\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\tclass=\"size-5\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t\t\td=\"M15.312 11.424a5.5 5.5 0 0 1-9.201 2.466l-.312-.311h2.433a.75.75 0 0 0 0-1.5H3.989a.75.75 0 0 0-.75.75v4.242a.75.75 0 0 0 1.5 0v-2.43l.31.31a7 7 0 0 0 11.712-3.138.75.75 0 0 0-1.449-.39Zm1.23-3.723a.75.75 0 0 0 .219-.53V2.929a.75.75 0 0 0-1.5 0V5.36l-.31-.31A7 7 0 0 0 3.239 8.188a.75.75 0 1 0 1.448.389A5.5 5.5 0 0 1 13.89 6.11l.311.31h-2.432a.75.75 0 0 0 0 1.5h4.243a.75.75 0 0 0 .53-.219Z\"\n\t\t\t\t\t\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</VideoInputMenu>\n\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Camera')}>\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\tclass=\" p-3 rounded-full bg-gray-50 dark:bg-gray-900\"\n\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\ton:click={async () => {\n\t\t\t\t\t\t\t\t\t\tawait navigator.mediaDevices.getUserMedia({ video: true });\n\t\t\t\t\t\t\t\t\t\tstartCamera();\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\t\tstroke-width=\"1.5\"\n\t\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\tclass=\"size-5\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\t\t\td=\"M6.827 6.175A2.31 2.31 0 0 1 5.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 0 0-1.134-.175 2.31 2.31 0 0 1-1.64-1.055l-.822-1.316a2.192 2.192 0 0 0-1.736-1.039 48.774 48.774 0 0 0-5.232 0 2.192 2.192 0 0 0-1.736 1.039l-.821 1.316Z\"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\t\t\td=\"M16.5 12.75a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0ZM18.75 10.5h.008v.008h-.008V10.5Z\"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\tif (assistantSpeaking) {\n\t\t\t\t\t\t\t\t\tstopAllAudio();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div class=\" line-clamp-1 text-sm font-medium\">\n\t\t\t\t\t\t\t\t{#if loading}\n\t\t\t\t\t\t\t\t\t{$i18n.t('Thinking...')}\n\t\t\t\t\t\t\t\t{:else if assistantSpeaking}\n\t\t\t\t\t\t\t\t\t{$i18n.t('Tap to interrupt')}\n\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t{$i18n.t('Listening...')}\n\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclass=\" p-3 rounded-full bg-gray-50 dark:bg-gray-900\"\n\t\t\t\t\t\t\ton:click={async () => {\n\t\t\t\t\t\t\t\tshowCallOverlay.set(false);\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\tviewBox=\"0 0 20 20\"\n\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\tclass=\"size-5\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\td=\"M6.28 5.22a.75.75 0 0 0-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 1 0 1.06 1.06L10 11.06l3.72 3.72a.75.75 0 1 0 1.06-1.06L11.06 10l3.72-3.72a.75.75 0 0 0-1.06-1.06L10 8.94 6.28 5.22Z\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n{/if}\n","<script>\n\timport { createEventDispatcher, getContext } from 'svelte';\n\tconst dispatch = createEventDispatcher();\n\tconst i18n = getContext('i18n');\n\n\timport XMark from '$lib/components/icons/XMark.svelte';\n\timport AdvancedParams from '../Settings/Advanced/AdvancedParams.svelte';\n\timport Valves from '$lib/components/common/Valves.svelte';\n\timport FileItem from '$lib/components/common/FileItem.svelte';\n\n\texport let models = [];\n\n\texport let chatFiles = [];\n\texport let valves = {};\n\texport let params = {};\n</script>\n\n<div class=\" dark:text-white\">\n\t<div class=\" flex justify-between dark:text-gray-100 mb-2\">\n\t\t<div class=\" text-lg font-medium self-center font-primary\">{$i18n.t('Chat Controls')}</div>\n\t\t<button\n\t\t\tclass=\"self-center\"\n\t\t\ton:click={() => {\n\t\t\t\tdispatch('close');\n\t\t\t}}\n\t\t>\n\t\t\t<XMark className=\"size-4\" />\n\t\t</button>\n\t</div>\n\n\t<div class=\" dark:text-gray-200 text-sm font-primary\">\n\t\t{#if chatFiles.length > 0}\n\t\t\t<div>\n\t\t\t\t<div class=\"mb-1.5 font-medium\">{$i18n.t('Files')}</div>\n\n\t\t\t\t<div class=\"flex flex-col gap-1\">\n\t\t\t\t\t{#each chatFiles as file, fileIdx}\n\t\t\t\t\t\t<FileItem\n\t\t\t\t\t\t\tclassName=\"w-full\"\n\t\t\t\t\t\t\turl={`${file?.url}`}\n\t\t\t\t\t\t\tname={file.name}\n\t\t\t\t\t\t\ttype={file.type}\n\t\t\t\t\t\t\tdismissible={true}\n\t\t\t\t\t\t\ton:dismiss={() => {\n\t\t\t\t\t\t\t\t// Remove the file from the chatFiles array\n\n\t\t\t\t\t\t\t\tchatFiles.splice(fileIdx, 1);\n\t\t\t\t\t\t\t\tchatFiles = chatFiles;\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t/>\n\t\t\t\t\t{/each}\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<hr class=\"my-2 border-gray-100 dark:border-gray-800\" />\n\t\t{/if}\n\n\t\t{#if models.length === 1 && models[0]?.pipe?.valves_spec}\n\t\t\t<div>\n\t\t\t\t<div class=\" font-medium\">{$i18n.t('Valves')}</div>\n\n\t\t\t\t<div>\n\t\t\t\t\t<Valves valvesSpec={models[0]?.pipe?.valves_spec} bind:valves />\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<hr class=\"my-2 border-gray-100 dark:border-gray-800\" />\n\t\t{/if}\n\n\t\t<div>\n\t\t\t<div class=\"mb-1.5 font-medium\">{$i18n.t('System Prompt')}</div>\n\n\t\t\t<div>\n\t\t\t\t<textarea\n\t\t\t\t\tbind:value={params.system}\n\t\t\t\t\tclass=\"w-full rounded-lg px-4 py-3 text-sm dark:text-gray-300 dark:bg-gray-850 border border-gray-100 dark:border-gray-800 outline-none resize-none\"\n\t\t\t\t\trows=\"3\"\n\t\t\t\t\tplaceholder={$i18n.t('Enter system prompt')}\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<hr class=\"my-2 border-gray-100 dark:border-gray-800\" />\n\n\t\t<div>\n\t\t\t<div class=\"mb-1.5 font-medium\">{$i18n.t('Advanced Params')}</div>\n\n\t\t\t<div>\n\t\t\t\t<AdvancedParams bind:params />\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n","<script lang=\"ts\">\n\timport { slide } from 'svelte/transition';\n\timport Modal from '../common/Modal.svelte';\n\timport Controls from './Controls/Controls.svelte';\n\timport { onMount } from 'svelte';\n\n\texport let show = false;\n\n\texport let models = [];\n\n\texport let chatId = null;\n\n\texport let chatFiles = [];\n\texport let valves = {};\n\texport let params = {};\n\n\tlet largeScreen = false;\n\tonMount(() => {\n\t\t// listen to resize 1024px\n\t\tconst mediaQuery = window.matchMedia('(min-width: 1024px)');\n\n\t\tconst handleMediaQuery = (e) => {\n\t\t\tif (e.matches) {\n\t\t\t\tlargeScreen = true;\n\t\t\t} else {\n\t\t\t\tlargeScreen = false;\n\t\t\t}\n\t\t};\n\n\t\tmediaQuery.addEventListener('change', handleMediaQuery);\n\n\t\thandleMediaQuery(mediaQuery);\n\n\t\treturn () => {\n\t\t\tmediaQuery.removeEventListener('change', handleMediaQuery);\n\t\t};\n\t});\n</script>\n\n{#if largeScreen}\n\t{#if show}\n\t\t<div class=\" absolute bottom-0 right-0 z-20 h-full pointer-events-none\">\n\t\t\t<div class=\"pr-4 pt-14 pb-8 w-[24rem] h-full\" in:slide={{ duration: 200, axis: 'x' }}>\n\t\t\t\t<div\n\t\t\t\t\tclass=\"w-full h-full px-5 py-4 bg-white dark:shadow-lg dark:bg-gray-850 border border-gray-50 dark:border-gray-800 rounded-xl z-50 pointer-events-auto overflow-y-auto scrollbar-hidden\"\n\t\t\t\t>\n\t\t\t\t\t<Controls\n\t\t\t\t\t\ton:close={() => {\n\t\t\t\t\t\t\tshow = false;\n\t\t\t\t\t\t}}\n\t\t\t\t\t\t{models}\n\t\t\t\t\t\tbind:chatFiles\n\t\t\t\t\t\tbind:valves\n\t\t\t\t\t\tbind:params\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t{/if}\n{:else}\n\t<Modal bind:show>\n\t\t<div class=\"  px-6 py-4 h-full\">\n\t\t\t<Controls\n\t\t\t\ton:close={() => {\n\t\t\t\t\tshow = false;\n\t\t\t\t}}\n\t\t\t\t{models}\n\t\t\t\tbind:chatFiles\n\t\t\t\tbind:valves\n\t\t\t\tbind:params\n\t\t\t/>\n\t\t</div>\n\t</Modal>\n{/if}\n","<script lang=\"ts\">\n\timport { v4 as uuidv4 } from 'uuid';\n\timport { toast } from 'svelte-sonner';\n\timport mermaid from 'mermaid';\n\n\timport { getContext, onMount, tick } from 'svelte';\n\timport { goto } from '$app/navigation';\n\timport { page } from '$app/stores';\n\n\timport type { Writable } from 'svelte/store';\n\timport type { i18n as i18nType } from 'i18next';\n\timport { OLLAMA_API_BASE_URL, OPENAI_API_BASE_URL, WEBUI_BASE_URL } from '$lib/constants';\n\n\timport {\n\t\tchatId,\n\t\tchats,\n\t\tconfig,\n\t\ttype Model,\n\t\tmodels,\n\t\tsettings,\n\t\tshowSidebar,\n\t\ttags as _tags,\n\t\tWEBUI_NAME,\n\t\tbanners,\n\t\tuser,\n\t\tsocket,\n\t\tshowCallOverlay,\n\t\ttools\n\t} from '$lib/stores';\n\timport {\n\t\tconvertMessagesToHistory,\n\t\tcopyToClipboard,\n\t\textractSentencesForAudio,\n\t\tgetUserPosition,\n\t\tpromptTemplate,\n\t\tsplitStream\n\t} from '$lib/utils';\n\n\timport { generateChatCompletion } from '$lib/apis/ollama';\n\timport {\n\t\taddTagById,\n\t\tcreateNewChat,\n\t\tdeleteTagById,\n\t\tgetAllChatTags,\n\t\tgetChatById,\n\t\tgetChatList,\n\t\tgetTagsById,\n\t\tupdateChatById\n\t} from '$lib/apis/chats';\n\timport { generateOpenAIChatCompletion } from '$lib/apis/openai';\n\timport { runWebSearch } from '$lib/apis/rag';\n\timport { createOpenAITextStream } from '$lib/apis/streaming';\n\timport { queryMemory } from '$lib/apis/memories';\n\timport { getAndUpdateUserLocation, getUserSettings } from '$lib/apis/users';\n\timport { chatCompleted, generateTitle, generateSearchQuery, chatAction } from '$lib/apis';\n\n\timport Banner from '../common/Banner.svelte';\n\timport MessageInput from '$lib/components/chat/MessageInput.svelte';\n\timport Messages from '$lib/components/chat/Messages.svelte';\n\timport Navbar from '$lib/components/layout/Navbar.svelte';\n\timport CallOverlay from './MessageInput/CallOverlay.svelte';\n\timport { error } from '@sveltejs/kit';\n\timport ChatControls from './ChatControls.svelte';\n\timport EventConfirmDialog from '../common/ConfirmDialog.svelte';\n\n\tconst i18n: Writable<i18nType> = getContext('i18n');\n\n\texport let chatIdProp = '';\n\tlet loaded = false;\n\tconst eventTarget = new EventTarget();\n\n\tlet showControls = false;\n\tlet stopResponseFlag = false;\n\tlet autoScroll = true;\n\tlet processing = '';\n\tlet messagesContainerElement: HTMLDivElement;\n\n\tlet showEventConfirmation = false;\n\tlet eventConfirmationTitle = '';\n\tlet eventConfirmationMessage = '';\n\tlet eventConfirmationInput = false;\n\tlet eventConfirmationInputPlaceholder = '';\n\tlet eventCallback = null;\n\n\tlet showModelSelector = true;\n\n\tlet selectedModels = [''];\n\tlet atSelectedModel: Model | undefined;\n\n\tlet selectedModelIds = [];\n\t$: selectedModelIds = atSelectedModel !== undefined ? [atSelectedModel.id] : selectedModels;\n\n\tlet selectedToolIds = [];\n\tlet webSearchEnabled = false;\n\n\tlet chat = null;\n\tlet tags = [];\n\n\tlet title = '';\n\tlet prompt = '';\n\n\tlet chatFiles = [];\n\tlet files = [];\n\tlet messages = [];\n\tlet history = {\n\t\tmessages: {},\n\t\tcurrentId: null\n\t};\n\n\tlet params = {};\n\tlet valves = {};\n\n\t$: if (history.currentId !== null) {\n\t\tlet _messages = [];\n\n\t\tlet currentMessage = history.messages[history.currentId];\n\t\twhile (currentMessage !== null) {\n\t\t\t_messages.unshift({ ...currentMessage });\n\t\t\tcurrentMessage =\n\t\t\t\tcurrentMessage.parentId !== null ? history.messages[currentMessage.parentId] : null;\n\t\t}\n\t\tmessages = _messages;\n\t} else {\n\t\tmessages = [];\n\t}\n\n\t$: if (chatIdProp) {\n\t\t(async () => {\n\t\t\tconsole.log(chatIdProp);\n\t\t\tif (chatIdProp && (await loadChat())) {\n\t\t\t\tawait tick();\n\t\t\t\tloaded = true;\n\n\t\t\t\twindow.setTimeout(() => scrollToBottom(), 0);\n\t\t\t\tconst chatInput = document.getElementById('chat-textarea');\n\t\t\t\tchatInput?.focus();\n\t\t\t} else {\n\t\t\t\tawait goto('/');\n\t\t\t}\n\t\t})();\n\t}\n\n\tconst chatEventHandler = async (event, cb) => {\n\t\tif (event.chat_id === $chatId) {\n\t\t\tawait tick();\n\t\t\tconsole.log(event);\n\t\t\tlet message = history.messages[event.message_id];\n\n\t\t\tconst type = event?.data?.type ?? null;\n\t\t\tconst data = event?.data?.data ?? null;\n\n\t\t\tif (type === 'status') {\n\t\t\t\tif (message?.statusHistory) {\n\t\t\t\t\tmessage.statusHistory.push(data);\n\t\t\t\t} else {\n\t\t\t\t\tmessage.statusHistory = [data];\n\t\t\t\t}\n\t\t\t} else if (type === 'citation') {\n\t\t\t\tif (message?.citations) {\n\t\t\t\t\tmessage.citations.push(data);\n\t\t\t\t} else {\n\t\t\t\t\tmessage.citations = [data];\n\t\t\t\t}\n\t\t\t} else if (type === 'message') {\n\t\t\t\tmessage.content += data.content;\n\t\t\t} else if (type === 'replace') {\n\t\t\t\tmessage.content = data.content;\n\t\t\t} else if (type === 'confirmation') {\n\t\t\t\teventCallback = cb;\n\n\t\t\t\teventConfirmationInput = false;\n\t\t\t\tshowEventConfirmation = true;\n\n\t\t\t\teventConfirmationTitle = data.title;\n\t\t\t\teventConfirmationMessage = data.message;\n\t\t\t} else if (type === 'input') {\n\t\t\t\teventCallback = cb;\n\n\t\t\t\teventConfirmationInput = true;\n\t\t\t\tshowEventConfirmation = true;\n\n\t\t\t\teventConfirmationTitle = data.title;\n\t\t\t\teventConfirmationMessage = data.message;\n\t\t\t\teventConfirmationInputPlaceholder = data.placeholder;\n\t\t\t} else {\n\t\t\t\tconsole.log('Unknown message type', data);\n\t\t\t}\n\n\t\t\tmessages = messages;\n\t\t}\n\t};\n\n\tonMount(async () => {\n\t\tconst onMessageHandler = async (event) => {\n\t\t\tif (event.origin === window.origin) {\n\t\t\t\t// Replace with your iframe's origin\n\t\t\t\tconsole.log('Message received from iframe:', event.data);\n\t\t\t\tif (event.data.type === 'input:prompt') {\n\t\t\t\t\tconsole.log(event.data.text);\n\n\t\t\t\t\tconst inputElement = document.getElementById('chat-textarea');\n\n\t\t\t\t\tif (inputElement) {\n\t\t\t\t\t\tprompt = event.data.text;\n\t\t\t\t\t\tinputElement.focus();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (event.data.type === 'action:submit') {\n\t\t\t\t\tconsole.log(event.data.text);\n\n\t\t\t\t\tif (prompt !== '') {\n\t\t\t\t\t\tawait tick();\n\t\t\t\t\t\tsubmitPrompt(prompt);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (event.data.type === 'input:prompt:submit') {\n\t\t\t\t\tconsole.log(event.data.text);\n\n\t\t\t\t\tif (prompt !== '') {\n\t\t\t\t\t\tawait tick();\n\t\t\t\t\t\tsubmitPrompt(event.data.text);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\twindow.addEventListener('message', onMessageHandler);\n\n\t\t$socket.on('chat-events', chatEventHandler);\n\n\t\tif (!$chatId) {\n\t\t\tchatId.subscribe(async (value) => {\n\t\t\t\tif (!value) {\n\t\t\t\t\tawait initNewChat();\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tif (!($settings.saveChatHistory ?? true)) {\n\t\t\t\tawait goto('/');\n\t\t\t}\n\t\t}\n\n\t\treturn () => {\n\t\t\twindow.removeEventListener('message', onMessageHandler);\n\n\t\t\t$socket.off('chat-events');\n\t\t};\n\t});\n\n\t//////////////////////////\n\t// Web functions\n\t//////////////////////////\n\n\tconst initNewChat = async () => {\n\t\twindow.history.replaceState(history.state, '', `/`);\n\t\tawait chatId.set('');\n\n\t\tautoScroll = true;\n\n\t\ttitle = '';\n\t\tmessages = [];\n\t\thistory = {\n\t\t\tmessages: {},\n\t\t\tcurrentId: null\n\t\t};\n\n\t\tchatFiles = [];\n\t\tparams = {};\n\n\t\tif ($page.url.searchParams.get('models')) {\n\t\t\tselectedModels = $page.url.searchParams.get('models')?.split(',');\n\t\t} else if ($settings?.models) {\n\t\t\tselectedModels = $settings?.models;\n\t\t} else if ($config?.default_models) {\n\t\t\tconsole.log($config?.default_models.split(',') ?? '');\n\t\t\tselectedModels = $config?.default_models.split(',');\n\t\t} else {\n\t\t\tselectedModels = [''];\n\t\t}\n\n\t\tif ($page.url.searchParams.get('q')) {\n\t\t\tprompt = $page.url.searchParams.get('q') ?? '';\n\n\t\t\tif (prompt) {\n\t\t\t\tawait tick();\n\t\t\t\tsubmitPrompt(prompt);\n\t\t\t}\n\t\t}\n\n\t\tselectedModels = selectedModels.map((modelId) =>\n\t\t\t$models.map((m) => m.id).includes(modelId) ? modelId : ''\n\t\t);\n\n\t\tconst userSettings = await getUserSettings(localStorage.token);\n\n\t\tif (userSettings) {\n\t\t\tsettings.set(userSettings.ui);\n\t\t} else {\n\t\t\tsettings.set(JSON.parse(localStorage.getItem('settings') ?? '{}'));\n\t\t}\n\n\t\tconst chatInput = document.getElementById('chat-textarea');\n\t\tsetTimeout(() => chatInput?.focus(), 0);\n\t};\n\n\tconst loadChat = async () => {\n\t\tchatId.set(chatIdProp);\n\t\tchat = await getChatById(localStorage.token, $chatId).catch(async (error) => {\n\t\t\tawait goto('/');\n\t\t\treturn null;\n\t\t});\n\n\t\tif (chat) {\n\t\t\ttags = await getTags();\n\t\t\tconst chatContent = chat.chat;\n\n\t\t\tif (chatContent) {\n\t\t\t\tconsole.log(chatContent);\n\n\t\t\t\tselectedModels =\n\t\t\t\t\t(chatContent?.models ?? undefined) !== undefined\n\t\t\t\t\t\t? chatContent.models\n\t\t\t\t\t\t: [chatContent.models ?? ''];\n\t\t\t\thistory =\n\t\t\t\t\t(chatContent?.history ?? undefined) !== undefined\n\t\t\t\t\t\t? chatContent.history\n\t\t\t\t\t\t: convertMessagesToHistory(chatContent.messages);\n\t\t\t\ttitle = chatContent.title;\n\n\t\t\t\tconst userSettings = await getUserSettings(localStorage.token);\n\n\t\t\t\tif (userSettings) {\n\t\t\t\t\tawait settings.set(userSettings.ui);\n\t\t\t\t} else {\n\t\t\t\t\tawait settings.set(JSON.parse(localStorage.getItem('settings') ?? '{}'));\n\t\t\t\t}\n\n\t\t\t\tparams = chatContent?.params ?? {};\n\t\t\t\tchatFiles = chatContent?.files ?? [];\n\n\t\t\t\tautoScroll = true;\n\t\t\t\tawait tick();\n\n\t\t\t\tif (messages.length > 0) {\n\t\t\t\t\thistory.messages[messages.at(-1).id].done = true;\n\t\t\t\t}\n\t\t\t\tawait tick();\n\n\t\t\t\treturn true;\n\t\t\t} else {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t}\n\t};\n\n\tconst scrollToBottom = async () => {\n\t\tawait tick();\n\t\tif (messagesContainerElement) {\n\t\t\tmessagesContainerElement.scrollTop = messagesContainerElement.scrollHeight;\n\t\t}\n\t};\n\n\tconst createMessagesList = (responseMessageId) => {\n\t\tconst message = history.messages[responseMessageId];\n\t\tif (message.parentId) {\n\t\t\treturn [...createMessagesList(message.parentId), message];\n\t\t} else {\n\t\t\treturn [message];\n\t\t}\n\t};\n\n\tconst chatCompletedHandler = async (chatId, modelId, responseMessageId, messages) => {\n\t\tawait mermaid.run({\n\t\t\tquerySelector: '.mermaid'\n\t\t});\n\n\t\tconst res = await chatCompleted(localStorage.token, {\n\t\t\tmodel: modelId,\n\t\t\tmessages: messages.map((m) => ({\n\t\t\t\tid: m.id,\n\t\t\t\trole: m.role,\n\t\t\t\tcontent: m.content,\n\t\t\t\tinfo: m.info ? m.info : undefined,\n\t\t\t\ttimestamp: m.timestamp\n\t\t\t})),\n\t\t\tchat_id: chatId,\n\t\t\tsession_id: $socket?.id,\n\t\t\tid: responseMessageId\n\t\t}).catch((error) => {\n\t\t\ttoast.error(error);\n\t\t\tmessages.at(-1).error = { content: error };\n\n\t\t\treturn null;\n\t\t});\n\n\t\tif (res !== null) {\n\t\t\t// Update chat history with the new messages\n\t\t\tfor (const message of res.messages) {\n\t\t\t\thistory.messages[message.id] = {\n\t\t\t\t\t...history.messages[message.id],\n\t\t\t\t\t...(history.messages[message.id].content !== message.content\n\t\t\t\t\t\t? { originalContent: history.messages[message.id].content }\n\t\t\t\t\t\t: {}),\n\t\t\t\t\t...message\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\tif ($chatId == chatId) {\n\t\t\tif ($settings.saveChatHistory ?? true) {\n\t\t\t\tchat = await updateChatById(localStorage.token, chatId, {\n\t\t\t\t\tmodels: selectedModels,\n\t\t\t\t\tmessages: messages,\n\t\t\t\t\thistory: history,\n\t\t\t\t\tparams: params,\n\t\t\t\t\tfiles: chatFiles\n\t\t\t\t});\n\t\t\t\tawait chats.set(await getChatList(localStorage.token));\n\t\t\t}\n\t\t}\n\t};\n\n\tconst chatActionHandler = async (chatId, actionId, modelId, responseMessageId) => {\n\t\tconst res = await chatAction(localStorage.token, actionId, {\n\t\t\tmodel: modelId,\n\t\t\tmessages: messages.map((m) => ({\n\t\t\t\tid: m.id,\n\t\t\t\trole: m.role,\n\t\t\t\tcontent: m.content,\n\t\t\t\tinfo: m.info ? m.info : undefined,\n\t\t\t\ttimestamp: m.timestamp\n\t\t\t})),\n\t\t\tchat_id: chatId,\n\t\t\tsession_id: $socket?.id,\n\t\t\tid: responseMessageId\n\t\t}).catch((error) => {\n\t\t\ttoast.error(error);\n\t\t\tmessages.at(-1).error = { content: error };\n\t\t\treturn null;\n\t\t});\n\n\t\tif (res !== null) {\n\t\t\t// Update chat history with the new messages\n\t\t\tfor (const message of res.messages) {\n\t\t\t\thistory.messages[message.id] = {\n\t\t\t\t\t...history.messages[message.id],\n\t\t\t\t\t...(history.messages[message.id].content !== message.content\n\t\t\t\t\t\t? { originalContent: history.messages[message.id].content }\n\t\t\t\t\t\t: {}),\n\t\t\t\t\t...message\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\tif ($chatId == chatId) {\n\t\t\tif ($settings.saveChatHistory ?? true) {\n\t\t\t\tchat = await updateChatById(localStorage.token, chatId, {\n\t\t\t\t\tmodels: selectedModels,\n\t\t\t\t\tmessages: messages,\n\t\t\t\t\thistory: history,\n\t\t\t\t\tparams: params,\n\t\t\t\t\tfiles: chatFiles\n\t\t\t\t});\n\t\t\t\tawait chats.set(await getChatList(localStorage.token));\n\t\t\t}\n\t\t}\n\t};\n\n\tconst getChatEventEmitter = async (modelId: string, chatId: string = '') => {\n\t\treturn setInterval(() => {\n\t\t\t$socket?.emit('usage', {\n\t\t\t\taction: 'chat',\n\t\t\t\tmodel: modelId,\n\t\t\t\tchat_id: chatId\n\t\t\t});\n\t\t}, 1000);\n\t};\n\n\t//////////////////////////\n\t// Chat functions\n\t//////////////////////////\n\n\tconst submitPrompt = async (userPrompt, { _raw = false } = {}) => {\n\t\tlet _responses = [];\n\t\tconsole.log('submitPrompt', $chatId);\n\n\t\tselectedModels = selectedModels.map((modelId) =>\n\t\t\t$models.map((m) => m.id).includes(modelId) ? modelId : ''\n\t\t);\n\n\t\tif (selectedModels.includes('')) {\n\t\t\ttoast.error($i18n.t('Model not selected'));\n\t\t} else if (messages.length != 0 && messages.at(-1).done != true) {\n\t\t\t// Response not done\n\t\t\tconsole.log('wait');\n\t\t} else if (messages.length != 0 && messages.at(-1).error) {\n\t\t\t// Error in response\n\t\t\ttoast.error(\n\t\t\t\t$i18n.t(\n\t\t\t\t\t`Oops! There was an error in the previous response. Please try again or contact admin.`\n\t\t\t\t)\n\t\t\t);\n\t\t} else if (\n\t\t\tfiles.length > 0 &&\n\t\t\tfiles.filter((file) => file.type !== 'image' && file.status !== 'processed').length > 0\n\t\t) {\n\t\t\t// Upload not done\n\t\t\ttoast.error(\n\t\t\t\t$i18n.t(\n\t\t\t\t\t`Oops! Hold tight! Your files are still in the processing oven. We're cooking them up to perfection. Please be patient and we'll let you know once they're ready.`\n\t\t\t\t)\n\t\t\t);\n\t\t} else {\n\t\t\t// Reset chat input textarea\n\t\t\tconst chatTextAreaElement = document.getElementById('chat-textarea');\n\n\t\t\tif (chatTextAreaElement) {\n\t\t\t\tchatTextAreaElement.value = '';\n\t\t\t\tchatTextAreaElement.style.height = '';\n\t\t\t}\n\n\t\t\tconst _files = JSON.parse(JSON.stringify(files));\n\t\t\tchatFiles.push(..._files.filter((item) => ['doc', 'file', 'collection'].includes(item.type)));\n\t\t\tchatFiles = chatFiles.filter(\n\t\t\t\t// Remove duplicates\n\t\t\t\t(item, index, array) =>\n\t\t\t\t\tarray.findIndex((i) => JSON.stringify(i) === JSON.stringify(item)) === index\n\t\t\t);\n\n\t\t\tfiles = [];\n\n\t\t\tprompt = '';\n\n\t\t\t// Create user message\n\t\t\tlet userMessageId = uuidv4();\n\t\t\tlet userMessage = {\n\t\t\t\tid: userMessageId,\n\t\t\t\tparentId: messages.length !== 0 ? messages.at(-1).id : null,\n\t\t\t\tchildrenIds: [],\n\t\t\t\trole: 'user',\n\t\t\t\tcontent: userPrompt,\n\t\t\t\tfiles: _files.length > 0 ? _files : undefined,\n\t\t\t\ttimestamp: Math.floor(Date.now() / 1000), // Unix epoch\n\t\t\t\tmodels: selectedModels.filter((m, mIdx) => selectedModels.indexOf(m) === mIdx)\n\t\t\t};\n\n\t\t\t// Add message to history and Set currentId to messageId\n\t\t\thistory.messages[userMessageId] = userMessage;\n\t\t\thistory.currentId = userMessageId;\n\n\t\t\t// Append messageId to childrenIds of parent message\n\t\t\tif (messages.length !== 0) {\n\t\t\t\thistory.messages[messages.at(-1).id].childrenIds.push(userMessageId);\n\t\t\t}\n\n\t\t\t// Wait until history/message have been updated\n\t\t\tawait tick();\n\t\t\t_responses = await sendPrompt(userPrompt, userMessageId, { newChat: true });\n\t\t}\n\n\t\treturn _responses;\n\t};\n\n\tconst sendPrompt = async (prompt, parentId, { modelId = null, newChat = false } = {}) => {\n\t\tlet _responses = [];\n\n\t\t// If modelId is provided, use it, else use selected model\n\t\tlet selectedModelIds = modelId\n\t\t\t? [modelId]\n\t\t\t: atSelectedModel !== undefined\n\t\t\t? [atSelectedModel.id]\n\t\t\t: selectedModels;\n\n\t\t// Create response messages for each selected model\n\t\tconst responseMessageIds = {};\n\t\tfor (const modelId of selectedModelIds) {\n\t\t\tconst model = $models.filter((m) => m.id === modelId).at(0);\n\n\t\t\tif (model) {\n\t\t\t\tlet responseMessageId = uuidv4();\n\t\t\t\tlet responseMessage = {\n\t\t\t\t\tparentId: parentId,\n\t\t\t\t\tid: responseMessageId,\n\t\t\t\t\tchildrenIds: [],\n\t\t\t\t\trole: 'assistant',\n\t\t\t\t\tcontent: '',\n\t\t\t\t\tmodel: model.id,\n\t\t\t\t\tmodelName: model.name ?? model.id,\n\t\t\t\t\tuserContext: null,\n\t\t\t\t\ttimestamp: Math.floor(Date.now() / 1000) // Unix epoch\n\t\t\t\t};\n\n\t\t\t\t// Add message to history and Set currentId to messageId\n\t\t\t\thistory.messages[responseMessageId] = responseMessage;\n\t\t\t\thistory.currentId = responseMessageId;\n\n\t\t\t\t// Append messageId to childrenIds of parent message\n\t\t\t\tif (parentId !== null) {\n\t\t\t\t\thistory.messages[parentId].childrenIds = [\n\t\t\t\t\t\t...history.messages[parentId].childrenIds,\n\t\t\t\t\t\tresponseMessageId\n\t\t\t\t\t];\n\t\t\t\t}\n\n\t\t\t\tresponseMessageIds[modelId] = responseMessageId;\n\t\t\t}\n\t\t}\n\t\tawait tick();\n\n\t\t// Create new chat if only one message in messages\n\t\tif (newChat && messages.length == 2) {\n\t\t\tif ($settings.saveChatHistory ?? true) {\n\t\t\t\tchat = await createNewChat(localStorage.token, {\n\t\t\t\t\tid: $chatId,\n\t\t\t\t\ttitle: $i18n.t('New Chat'),\n\t\t\t\t\tmodels: selectedModels,\n\t\t\t\t\tsystem: $settings.system ?? undefined,\n\t\t\t\t\tparams: params,\n\t\t\t\t\tmessages: messages,\n\t\t\t\t\thistory: history,\n\t\t\t\t\ttags: [],\n\t\t\t\t\ttimestamp: Date.now()\n\t\t\t\t});\n\t\t\t\tawait chats.set(await getChatList(localStorage.token));\n\t\t\t\tawait chatId.set(chat.id);\n\t\t\t} else {\n\t\t\t\tawait chatId.set('local');\n\t\t\t}\n\t\t\tawait tick();\n\t\t}\n\n\t\tconst _chatId = JSON.parse(JSON.stringify($chatId));\n\n\t\tawait Promise.all(\n\t\t\tselectedModelIds.map(async (modelId) => {\n\t\t\t\tconsole.log('modelId', modelId);\n\t\t\t\tconst model = $models.filter((m) => m.id === modelId).at(0);\n\n\t\t\t\tif (model) {\n\t\t\t\t\t// If there are image files, check if model is vision capable\n\t\t\t\t\tconst hasImages = messages.some((message) =>\n\t\t\t\t\t\tmessage.files?.some((file) => file.type === 'image')\n\t\t\t\t\t);\n\n\t\t\t\t\tif (hasImages && !(model.info?.meta?.capabilities?.vision ?? true)) {\n\t\t\t\t\t\ttoast.error(\n\t\t\t\t\t\t\t$i18n.t('Model {{modelName}} is not vision capable', {\n\t\t\t\t\t\t\t\tmodelName: model.name ?? model.id\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t\tlet responseMessageId = responseMessageIds[modelId];\n\t\t\t\t\tlet responseMessage = history.messages[responseMessageId];\n\n\t\t\t\t\tlet userContext = null;\n\t\t\t\t\tif ($settings?.memory ?? false) {\n\t\t\t\t\t\tif (userContext === null) {\n\t\t\t\t\t\t\tconst res = await queryMemory(localStorage.token, prompt).catch((error) => {\n\t\t\t\t\t\t\t\ttoast.error(error);\n\t\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tif (res) {\n\t\t\t\t\t\t\t\tif (res.documents[0].length > 0) {\n\t\t\t\t\t\t\t\t\tuserContext = res.documents[0].reduce((acc, doc, index) => {\n\t\t\t\t\t\t\t\t\t\tconst createdAtTimestamp = res.metadatas[0][index].created_at;\n\t\t\t\t\t\t\t\t\t\tconst createdAtDate = new Date(createdAtTimestamp * 1000)\n\t\t\t\t\t\t\t\t\t\t\t.toISOString()\n\t\t\t\t\t\t\t\t\t\t\t.split('T')[0];\n\t\t\t\t\t\t\t\t\t\treturn `${acc}${index + 1}. [${createdAtDate}]. ${doc}\\n`;\n\t\t\t\t\t\t\t\t\t}, '');\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tconsole.log(userContext);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tresponseMessage.userContext = userContext;\n\n\t\t\t\t\tconst chatEventEmitter = await getChatEventEmitter(model.id, _chatId);\n\t\t\t\t\tif (webSearchEnabled) {\n\t\t\t\t\t\tawait getWebSearchResults(model.id, parentId, responseMessageId);\n\t\t\t\t\t}\n\n\t\t\t\t\tlet _response = null;\n\t\t\t\t\tif (model?.owned_by === 'openai') {\n\t\t\t\t\t\t_response = await sendPromptOpenAI(model, prompt, responseMessageId, _chatId);\n\t\t\t\t\t} else if (model) {\n\t\t\t\t\t\t_response = await sendPromptOllama(model, prompt, responseMessageId, _chatId);\n\t\t\t\t\t}\n\t\t\t\t\t_responses.push(_response);\n\n\t\t\t\t\tif (chatEventEmitter) clearInterval(chatEventEmitter);\n\t\t\t\t} else {\n\t\t\t\t\ttoast.error($i18n.t(`Model {{modelId}} not found`, { modelId }));\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\n\t\tawait chats.set(await getChatList(localStorage.token));\n\t\treturn _responses;\n\t};\n\n\tconst sendPromptOllama = async (model, userPrompt, responseMessageId, _chatId) => {\n\t\tlet _response = null;\n\n\t\tconst responseMessage = history.messages[responseMessageId];\n\n\t\t// Wait until history/message have been updated\n\t\tawait tick();\n\n\t\t// Scroll down\n\t\tscrollToBottom();\n\n\t\tconst messagesBody = [\n\t\t\tparams?.system || $settings.system || (responseMessage?.userContext ?? null)\n\t\t\t\t? {\n\t\t\t\t\t\trole: 'system',\n\t\t\t\t\t\tcontent: `${promptTemplate(\n\t\t\t\t\t\t\tparams?.system ?? $settings?.system ?? '',\n\t\t\t\t\t\t\t$user.name,\n\t\t\t\t\t\t\t$settings?.userLocation\n\t\t\t\t\t\t\t\t? await getAndUpdateUserLocation(localStorage.token)\n\t\t\t\t\t\t\t\t: undefined\n\t\t\t\t\t\t)}${\n\t\t\t\t\t\t\tresponseMessage?.userContext ?? null\n\t\t\t\t\t\t\t\t? `\\n\\nUser Context:\\n${responseMessage?.userContext ?? ''}`\n\t\t\t\t\t\t\t\t: ''\n\t\t\t\t\t\t}`\n\t\t\t\t  }\n\t\t\t\t: undefined,\n\t\t\t...messages\n\t\t]\n\t\t\t.filter((message) => message?.content?.trim())\n\t\t\t.map((message, idx, arr) => {\n\t\t\t\t// Prepare the base message object\n\t\t\t\tconst baseMessage = {\n\t\t\t\t\trole: message.role,\n\t\t\t\t\tcontent: message.content\n\t\t\t\t};\n\n\t\t\t\t// Extract and format image URLs if any exist\n\t\t\t\tconst imageUrls = message.files\n\t\t\t\t\t?.filter((file) => file.type === 'image')\n\t\t\t\t\t.map((file) => file.url.slice(file.url.indexOf(',') + 1));\n\n\t\t\t\t// Add images array only if it contains elements\n\t\t\t\tif (imageUrls && imageUrls.length > 0 && message.role === 'user') {\n\t\t\t\t\tbaseMessage.images = imageUrls;\n\t\t\t\t}\n\t\t\t\treturn baseMessage;\n\t\t\t});\n\n\t\tlet lastImageIndex = -1;\n\n\t\t// Find the index of the last object with images\n\t\tmessagesBody.forEach((item, index) => {\n\t\t\tif (item.images) {\n\t\t\t\tlastImageIndex = index;\n\t\t\t}\n\t\t});\n\n\t\t// Remove images from all but the last one\n\t\tmessagesBody.forEach((item, index) => {\n\t\t\tif (index !== lastImageIndex) {\n\t\t\t\tdelete item.images;\n\t\t\t}\n\t\t});\n\n\t\tlet files = JSON.parse(JSON.stringify(chatFiles));\n\t\tif (model?.info?.meta?.knowledge ?? false) {\n\t\t\tfiles.push(...model.info.meta.knowledge);\n\t\t}\n\t\tif (responseMessage?.files) {\n\t\t\tfiles.push(\n\t\t\t\t...responseMessage?.files.filter((item) => ['web_search_results'].includes(item.type))\n\t\t\t);\n\t\t}\n\n\t\teventTarget.dispatchEvent(\n\t\t\tnew CustomEvent('chat:start', {\n\t\t\t\tdetail: {\n\t\t\t\t\tid: responseMessageId\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\n\t\tawait tick();\n\n\t\tconst [res, controller] = await generateChatCompletion(localStorage.token, {\n\t\t\tstream: true,\n\t\t\tmodel: model.id,\n\t\t\tmessages: messagesBody,\n\t\t\toptions: {\n\t\t\t\t...(params ?? $settings.params ?? {}),\n\t\t\t\tstop:\n\t\t\t\t\tparams?.stop ?? $settings?.params?.stop ?? undefined\n\t\t\t\t\t\t? (params?.stop ?? $settings.params.stop).map((str) =>\n\t\t\t\t\t\t\t\tdecodeURIComponent(JSON.parse('\"' + str.replace(/\\\"/g, '\\\\\"') + '\"'))\n\t\t\t\t\t\t  )\n\t\t\t\t\t\t: undefined,\n\t\t\t\tnum_predict: params?.max_tokens ?? $settings?.params?.max_tokens ?? undefined,\n\t\t\t\trepeat_penalty:\n\t\t\t\t\tparams?.frequency_penalty ?? $settings?.params?.frequency_penalty ?? undefined\n\t\t\t},\n\t\t\tformat: $settings.requestFormat ?? undefined,\n\t\t\tkeep_alive: $settings.keepAlive ?? undefined,\n\t\t\ttool_ids: selectedToolIds.length > 0 ? selectedToolIds : undefined,\n\t\t\tfiles: files.length > 0 ? files : undefined,\n\t\t\t...(Object.keys(valves).length ? { valves } : {}),\n\t\t\tsession_id: $socket?.id,\n\t\t\tchat_id: $chatId,\n\t\t\tid: responseMessageId\n\t\t});\n\n\t\tif (res && res.ok) {\n\t\t\tconsole.log('controller', controller);\n\n\t\t\tconst reader = res.body\n\t\t\t\t.pipeThrough(new TextDecoderStream())\n\t\t\t\t.pipeThrough(splitStream('\\n'))\n\t\t\t\t.getReader();\n\n\t\t\twhile (true) {\n\t\t\t\tconst { value, done } = await reader.read();\n\t\t\t\tif (done || stopResponseFlag || _chatId !== $chatId) {\n\t\t\t\t\tresponseMessage.done = true;\n\t\t\t\t\tmessages = messages;\n\n\t\t\t\t\tif (stopResponseFlag) {\n\t\t\t\t\t\tcontroller.abort('User: Stop Response');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconst messages = createMessagesList(responseMessageId);\n\t\t\t\t\t\tawait chatCompletedHandler(_chatId, model.id, responseMessageId, messages);\n\t\t\t\t\t}\n\n\t\t\t\t\t_response = responseMessage.content;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\tlet lines = value.split('\\n');\n\n\t\t\t\t\tfor (const line of lines) {\n\t\t\t\t\t\tif (line !== '') {\n\t\t\t\t\t\t\tconsole.log(line);\n\t\t\t\t\t\t\tlet data = JSON.parse(line);\n\n\t\t\t\t\t\t\tif ('citations' in data) {\n\t\t\t\t\t\t\t\tresponseMessage.citations = data.citations;\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif ('detail' in data) {\n\t\t\t\t\t\t\t\tthrow data;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (data.done == false) {\n\t\t\t\t\t\t\t\tif (responseMessage.content == '' && data.message.content == '\\n') {\n\t\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tresponseMessage.content += data.message.content;\n\n\t\t\t\t\t\t\t\t\tconst sentences = extractSentencesForAudio(responseMessage.content);\n\t\t\t\t\t\t\t\t\tsentences.pop();\n\n\t\t\t\t\t\t\t\t\t// dispatch only last sentence and make sure it hasn't been dispatched before\n\t\t\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t\t\tsentences.length > 0 &&\n\t\t\t\t\t\t\t\t\t\tsentences[sentences.length - 1] !== responseMessage.lastSentence\n\t\t\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\t\t\tresponseMessage.lastSentence = sentences[sentences.length - 1];\n\t\t\t\t\t\t\t\t\t\teventTarget.dispatchEvent(\n\t\t\t\t\t\t\t\t\t\t\tnew CustomEvent('chat', {\n\t\t\t\t\t\t\t\t\t\t\t\tdetail: { id: responseMessageId, content: sentences[sentences.length - 1] }\n\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tmessages = messages;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tresponseMessage.done = true;\n\n\t\t\t\t\t\t\t\tif (responseMessage.content == '') {\n\t\t\t\t\t\t\t\t\tresponseMessage.error = {\n\t\t\t\t\t\t\t\t\t\tcode: 400,\n\t\t\t\t\t\t\t\t\t\tcontent: `Oops! No text generated from Ollama, Please try again.`\n\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tresponseMessage.context = data.context ?? null;\n\t\t\t\t\t\t\t\tresponseMessage.info = {\n\t\t\t\t\t\t\t\t\ttotal_duration: data.total_duration,\n\t\t\t\t\t\t\t\t\tload_duration: data.load_duration,\n\t\t\t\t\t\t\t\t\tsample_count: data.sample_count,\n\t\t\t\t\t\t\t\t\tsample_duration: data.sample_duration,\n\t\t\t\t\t\t\t\t\tprompt_eval_count: data.prompt_eval_count,\n\t\t\t\t\t\t\t\t\tprompt_eval_duration: data.prompt_eval_duration,\n\t\t\t\t\t\t\t\t\teval_count: data.eval_count,\n\t\t\t\t\t\t\t\t\teval_duration: data.eval_duration\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\tmessages = messages;\n\n\t\t\t\t\t\t\t\tif ($settings.notificationEnabled && !document.hasFocus()) {\n\t\t\t\t\t\t\t\t\tconst notification = new Notification(`${model.id}`, {\n\t\t\t\t\t\t\t\t\t\tbody: responseMessage.content,\n\t\t\t\t\t\t\t\t\t\ticon: `${WEBUI_BASE_URL}/static/favicon.png`\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif ($settings?.responseAutoCopy ?? false) {\n\t\t\t\t\t\t\t\t\tcopyToClipboard(responseMessage.content);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif ($settings.responseAutoPlayback && !$showCallOverlay) {\n\t\t\t\t\t\t\t\t\tawait tick();\n\t\t\t\t\t\t\t\t\tdocument.getElementById(`speak-button-${responseMessage.id}`)?.click();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.log(error);\n\t\t\t\t\tif ('detail' in error) {\n\t\t\t\t\t\ttoast.error(error.detail);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (autoScroll) {\n\t\t\t\t\tscrollToBottom();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ($chatId == _chatId) {\n\t\t\t\tif ($settings.saveChatHistory ?? true) {\n\t\t\t\t\tchat = await updateChatById(localStorage.token, _chatId, {\n\t\t\t\t\t\tmessages: messages,\n\t\t\t\t\t\thistory: history,\n\t\t\t\t\t\tmodels: selectedModels,\n\t\t\t\t\t\tparams: params,\n\t\t\t\t\t\tfiles: chatFiles\n\t\t\t\t\t});\n\t\t\t\t\tawait chats.set(await getChatList(localStorage.token));\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tif (res !== null) {\n\t\t\t\tconst error = await res.json();\n\t\t\t\tconsole.log(error);\n\t\t\t\tif ('detail' in error) {\n\t\t\t\t\ttoast.error(error.detail);\n\t\t\t\t\tresponseMessage.error = { content: error.detail };\n\t\t\t\t} else {\n\t\t\t\t\ttoast.error(error.error);\n\t\t\t\t\tresponseMessage.error = { content: error.error };\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\ttoast.error(\n\t\t\t\t\t$i18n.t(`Uh-oh! There was an issue connecting to {{provider}}.`, { provider: 'Ollama' })\n\t\t\t\t);\n\t\t\t\tresponseMessage.error = {\n\t\t\t\t\tcontent: $i18n.t(`Uh-oh! There was an issue connecting to {{provider}}.`, {\n\t\t\t\t\t\tprovider: 'Ollama'\n\t\t\t\t\t})\n\t\t\t\t};\n\t\t\t}\n\t\t\tresponseMessage.done = true;\n\t\t\tmessages = messages;\n\t\t}\n\n\t\tstopResponseFlag = false;\n\t\tawait tick();\n\n\t\tlet lastSentence = extractSentencesForAudio(responseMessage.content)?.at(-1) ?? '';\n\t\tif (lastSentence) {\n\t\t\teventTarget.dispatchEvent(\n\t\t\t\tnew CustomEvent('chat', {\n\t\t\t\t\tdetail: { id: responseMessageId, content: lastSentence }\n\t\t\t\t})\n\t\t\t);\n\t\t}\n\t\teventTarget.dispatchEvent(\n\t\t\tnew CustomEvent('chat:finish', {\n\t\t\t\tdetail: {\n\t\t\t\t\tid: responseMessageId,\n\t\t\t\t\tcontent: responseMessage.content\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\n\t\tif (autoScroll) {\n\t\t\tscrollToBottom();\n\t\t}\n\n\t\tif (messages.length == 2 && messages.at(1).content !== '' && selectedModels[0] === model.id) {\n\t\t\twindow.history.replaceState(history.state, '', `/c/${_chatId}`);\n\t\t\tconst _title = await generateChatTitle(userPrompt);\n\t\t\tawait setChatTitle(_chatId, _title);\n\t\t}\n\n\t\treturn _response;\n\t};\n\n\tconst sendPromptOpenAI = async (model, userPrompt, responseMessageId, _chatId) => {\n\t\tlet _response = null;\n\t\tconst responseMessage = history.messages[responseMessageId];\n\n\t\tlet files = JSON.parse(JSON.stringify(chatFiles));\n\t\tif (model?.info?.meta?.knowledge ?? false) {\n\t\t\tfiles.push(...model.info.meta.knowledge);\n\t\t}\n\t\tif (responseMessage?.files) {\n\t\t\tfiles.push(\n\t\t\t\t...responseMessage?.files.filter((item) => ['web_search_results'].includes(item.type))\n\t\t\t);\n\t\t}\n\n\t\tscrollToBottom();\n\n\t\teventTarget.dispatchEvent(\n\t\t\tnew CustomEvent('chat:start', {\n\t\t\t\tdetail: {\n\t\t\t\t\tid: responseMessageId\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\t\tawait tick();\n\n\t\ttry {\n\t\t\tconst [res, controller] = await generateOpenAIChatCompletion(\n\t\t\t\tlocalStorage.token,\n\t\t\t\t{\n\t\t\t\t\tstream: true,\n\t\t\t\t\tmodel: model.id,\n\t\t\t\t\tstream_options:\n\t\t\t\t\t\tmodel.info?.meta?.capabilities?.usage ?? false\n\t\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\t\tinclude_usage: true\n\t\t\t\t\t\t\t  }\n\t\t\t\t\t\t\t: undefined,\n\t\t\t\t\tmessages: [\n\t\t\t\t\t\tparams?.system || $settings.system || (responseMessage?.userContext ?? null)\n\t\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\t\trole: 'system',\n\t\t\t\t\t\t\t\t\tcontent: `${promptTemplate(\n\t\t\t\t\t\t\t\t\t\tparams?.system ?? $settings?.system ?? '',\n\t\t\t\t\t\t\t\t\t\t$user.name,\n\t\t\t\t\t\t\t\t\t\t$settings?.userLocation\n\t\t\t\t\t\t\t\t\t\t\t? await getAndUpdateUserLocation(localStorage.token)\n\t\t\t\t\t\t\t\t\t\t\t: undefined\n\t\t\t\t\t\t\t\t\t)}${\n\t\t\t\t\t\t\t\t\t\tresponseMessage?.userContext ?? null\n\t\t\t\t\t\t\t\t\t\t\t? `\\n\\nUser Context:\\n${responseMessage?.userContext ?? ''}`\n\t\t\t\t\t\t\t\t\t\t\t: ''\n\t\t\t\t\t\t\t\t\t}`\n\t\t\t\t\t\t\t  }\n\t\t\t\t\t\t\t: undefined,\n\t\t\t\t\t\t...messages\n\t\t\t\t\t]\n\t\t\t\t\t\t.filter((message) => message?.content?.trim())\n\t\t\t\t\t\t.map((message, idx, arr) => ({\n\t\t\t\t\t\t\trole: message.role,\n\t\t\t\t\t\t\t...((message.files?.filter((file) => file.type === 'image').length > 0 ?? false) &&\n\t\t\t\t\t\t\tmessage.role === 'user'\n\t\t\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\t\t\tcontent: [\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\ttype: 'text',\n\t\t\t\t\t\t\t\t\t\t\t\ttext:\n\t\t\t\t\t\t\t\t\t\t\t\t\tarr.length - 1 !== idx\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t? message.content\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t: message?.raContent ?? message.content\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t...message.files\n\t\t\t\t\t\t\t\t\t\t\t\t.filter((file) => file.type === 'image')\n\t\t\t\t\t\t\t\t\t\t\t\t.map((file) => ({\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype: 'image_url',\n\t\t\t\t\t\t\t\t\t\t\t\t\timage_url: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\turl: file.url\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t}))\n\t\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t  }\n\t\t\t\t\t\t\t\t: {\n\t\t\t\t\t\t\t\t\t\tcontent:\n\t\t\t\t\t\t\t\t\t\t\tarr.length - 1 !== idx\n\t\t\t\t\t\t\t\t\t\t\t\t? message.content\n\t\t\t\t\t\t\t\t\t\t\t\t: message?.raContent ?? message.content\n\t\t\t\t\t\t\t\t  })\n\t\t\t\t\t\t})),\n\t\t\t\t\tseed: params?.seed ?? $settings?.params?.seed ?? undefined,\n\t\t\t\t\tstop:\n\t\t\t\t\t\tparams?.stop ?? $settings?.params?.stop ?? undefined\n\t\t\t\t\t\t\t? (params?.stop ?? $settings.params.stop).map((str) =>\n\t\t\t\t\t\t\t\t\tdecodeURIComponent(JSON.parse('\"' + str.replace(/\\\"/g, '\\\\\"') + '\"'))\n\t\t\t\t\t\t\t  )\n\t\t\t\t\t\t\t: undefined,\n\t\t\t\t\ttemperature: params?.temperature ?? $settings?.params?.temperature ?? undefined,\n\t\t\t\t\ttop_p: params?.top_p ?? $settings?.params?.top_p ?? undefined,\n\t\t\t\t\tfrequency_penalty:\n\t\t\t\t\t\tparams?.frequency_penalty ?? $settings?.params?.frequency_penalty ?? undefined,\n\t\t\t\t\tmax_tokens: params?.max_tokens ?? $settings?.params?.max_tokens ?? undefined,\n\t\t\t\t\ttool_ids: selectedToolIds.length > 0 ? selectedToolIds : undefined,\n\t\t\t\t\tfiles: files.length > 0 ? files : undefined,\n\t\t\t\t\t...(Object.keys(valves).length ? { valves } : {}),\n\t\t\t\t\tsession_id: $socket?.id,\n\t\t\t\t\tchat_id: $chatId,\n\t\t\t\t\tid: responseMessageId\n\t\t\t\t},\n\t\t\t\t`${WEBUI_BASE_URL}/api`\n\t\t\t);\n\n\t\t\t// Wait until history/message have been updated\n\t\t\tawait tick();\n\n\t\t\tscrollToBottom();\n\n\t\t\tif (res && res.ok && res.body) {\n\t\t\t\tconst textStream = await createOpenAITextStream(res.body, $settings.splitLargeChunks);\n\t\t\t\tlet lastUsage = null;\n\n\t\t\t\tfor await (const update of textStream) {\n\t\t\t\t\tconst { value, done, citations, error, usage } = update;\n\t\t\t\t\tif (error) {\n\t\t\t\t\t\tawait handleOpenAIError(error, null, model, responseMessage);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tif (done || stopResponseFlag || _chatId !== $chatId) {\n\t\t\t\t\t\tresponseMessage.done = true;\n\t\t\t\t\t\tmessages = messages;\n\n\t\t\t\t\t\tif (stopResponseFlag) {\n\t\t\t\t\t\t\tcontroller.abort('User: Stop Response');\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconst messages = createMessagesList(responseMessageId);\n\n\t\t\t\t\t\t\tawait chatCompletedHandler(_chatId, model.id, responseMessageId, messages);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t_response = responseMessage.content;\n\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (usage) {\n\t\t\t\t\t\tlastUsage = usage;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (citations) {\n\t\t\t\t\t\tresponseMessage.citations = citations;\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (responseMessage.content == '' && value == '\\n') {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresponseMessage.content += value;\n\n\t\t\t\t\t\tconst sentences = extractSentencesForAudio(responseMessage.content);\n\t\t\t\t\t\tsentences.pop();\n\n\t\t\t\t\t\t// dispatch only last sentence and make sure it hasn't been dispatched before\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tsentences.length > 0 &&\n\t\t\t\t\t\t\tsentences[sentences.length - 1] !== responseMessage.lastSentence\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tresponseMessage.lastSentence = sentences[sentences.length - 1];\n\t\t\t\t\t\t\teventTarget.dispatchEvent(\n\t\t\t\t\t\t\t\tnew CustomEvent('chat', {\n\t\t\t\t\t\t\t\t\tdetail: { id: responseMessageId, content: sentences[sentences.length - 1] }\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tmessages = messages;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (autoScroll) {\n\t\t\t\t\t\tscrollToBottom();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif ($settings.notificationEnabled && !document.hasFocus()) {\n\t\t\t\t\tconst notification = new Notification(`${model.id}`, {\n\t\t\t\t\t\tbody: responseMessage.content,\n\t\t\t\t\t\ticon: `${WEBUI_BASE_URL}/static/favicon.png`\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tif ($settings.responseAutoCopy) {\n\t\t\t\t\tcopyToClipboard(responseMessage.content);\n\t\t\t\t}\n\n\t\t\t\tif ($settings.responseAutoPlayback && !$showCallOverlay) {\n\t\t\t\t\tawait tick();\n\n\t\t\t\t\tdocument.getElementById(`speak-button-${responseMessage.id}`)?.click();\n\t\t\t\t}\n\n\t\t\t\tif (lastUsage) {\n\t\t\t\t\tresponseMessage.info = { ...lastUsage, openai: true };\n\t\t\t\t}\n\n\t\t\t\tif ($chatId == _chatId) {\n\t\t\t\t\tif ($settings.saveChatHistory ?? true) {\n\t\t\t\t\t\tchat = await updateChatById(localStorage.token, _chatId, {\n\t\t\t\t\t\t\tmodels: selectedModels,\n\t\t\t\t\t\t\tmessages: messages,\n\t\t\t\t\t\t\thistory: history,\n\t\t\t\t\t\t\tparams: params,\n\t\t\t\t\t\t\tfiles: chatFiles\n\t\t\t\t\t\t});\n\t\t\t\t\t\tawait chats.set(await getChatList(localStorage.token));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tawait handleOpenAIError(null, res, model, responseMessage);\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tawait handleOpenAIError(error, null, model, responseMessage);\n\t\t}\n\t\tmessages = messages;\n\n\t\tstopResponseFlag = false;\n\t\tawait tick();\n\n\t\tlet lastSentence = extractSentencesForAudio(responseMessage.content)?.at(-1) ?? '';\n\t\tif (lastSentence) {\n\t\t\teventTarget.dispatchEvent(\n\t\t\t\tnew CustomEvent('chat', {\n\t\t\t\t\tdetail: { id: responseMessageId, content: lastSentence }\n\t\t\t\t})\n\t\t\t);\n\t\t}\n\n\t\teventTarget.dispatchEvent(\n\t\t\tnew CustomEvent('chat:finish', {\n\t\t\t\tdetail: {\n\t\t\t\t\tid: responseMessageId,\n\t\t\t\t\tcontent: responseMessage.content\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\n\t\tif (autoScroll) {\n\t\t\tscrollToBottom();\n\t\t}\n\n\t\tif (messages.length == 2 && selectedModels[0] === model.id) {\n\t\t\twindow.history.replaceState(history.state, '', `/c/${_chatId}`);\n\n\t\t\tconst _title = await generateChatTitle(userPrompt);\n\t\t\tawait setChatTitle(_chatId, _title);\n\t\t}\n\n\t\treturn _response;\n\t};\n\n\tconst handleOpenAIError = async (error, res: Response | null, model, responseMessage) => {\n\t\tlet errorMessage = '';\n\t\tlet innerError;\n\n\t\tif (error) {\n\t\t\tinnerError = error;\n\t\t} else if (res !== null) {\n\t\t\tinnerError = await res.json();\n\t\t}\n\t\tconsole.error(innerError);\n\t\tif ('detail' in innerError) {\n\t\t\ttoast.error(innerError.detail);\n\t\t\terrorMessage = innerError.detail;\n\t\t} else if ('error' in innerError) {\n\t\t\tif ('message' in innerError.error) {\n\t\t\t\ttoast.error(innerError.error.message);\n\t\t\t\terrorMessage = innerError.error.message;\n\t\t\t} else {\n\t\t\t\ttoast.error(innerError.error);\n\t\t\t\terrorMessage = innerError.error;\n\t\t\t}\n\t\t} else if ('message' in innerError) {\n\t\t\ttoast.error(innerError.message);\n\t\t\terrorMessage = innerError.message;\n\t\t}\n\n\t\tresponseMessage.error = {\n\t\t\tcontent:\n\t\t\t\t$i18n.t(`Uh-oh! There was an issue connecting to {{provider}}.`, {\n\t\t\t\t\tprovider: model.name ?? model.id\n\t\t\t\t}) +\n\t\t\t\t'\\n' +\n\t\t\t\terrorMessage\n\t\t};\n\t\tresponseMessage.done = true;\n\n\t\tmessages = messages;\n\t};\n\n\tconst stopResponse = () => {\n\t\tstopResponseFlag = true;\n\t\tconsole.log('stopResponse');\n\t};\n\n\tconst regenerateResponse = async (message) => {\n\t\tconsole.log('regenerateResponse');\n\n\t\tif (messages.length != 0) {\n\t\t\tlet userMessage = history.messages[message.parentId];\n\t\t\tlet userPrompt = userMessage.content;\n\n\t\t\tif ((userMessage?.models ?? [...selectedModels]).length == 1) {\n\t\t\t\t// If user message has only one model selected, sendPrompt automatically selects it for regeneration\n\t\t\t\tawait sendPrompt(userPrompt, userMessage.id);\n\t\t\t} else {\n\t\t\t\t// If there are multiple models selected, use the model of the response message for regeneration\n\t\t\t\t// e.g. many model chat\n\t\t\t\tawait sendPrompt(userPrompt, userMessage.id, { modelId: message.model });\n\t\t\t}\n\t\t}\n\t};\n\n\tconst continueGeneration = async () => {\n\t\tconsole.log('continueGeneration');\n\t\tconst _chatId = JSON.parse(JSON.stringify($chatId));\n\n\t\tif (messages.length != 0 && messages.at(-1).done == true) {\n\t\t\tconst responseMessage = history.messages[history.currentId];\n\t\t\tresponseMessage.done = false;\n\t\t\tawait tick();\n\n\t\t\tconst model = $models.filter((m) => m.id === responseMessage.model).at(0);\n\n\t\t\tif (model) {\n\t\t\t\tif (model?.owned_by === 'openai') {\n\t\t\t\t\tawait sendPromptOpenAI(\n\t\t\t\t\t\tmodel,\n\t\t\t\t\t\thistory.messages[responseMessage.parentId].content,\n\t\t\t\t\t\tresponseMessage.id,\n\t\t\t\t\t\t_chatId\n\t\t\t\t\t);\n\t\t\t\t} else\n\t\t\t\t\tawait sendPromptOllama(\n\t\t\t\t\t\tmodel,\n\t\t\t\t\t\thistory.messages[responseMessage.parentId].content,\n\t\t\t\t\t\tresponseMessage.id,\n\t\t\t\t\t\t_chatId\n\t\t\t\t\t);\n\t\t\t}\n\t\t} else {\n\t\t\ttoast.error($i18n.t(`Model {{modelId}} not found`, { modelId }));\n\t\t}\n\t};\n\n\tconst generateChatTitle = async (userPrompt) => {\n\t\tif ($settings?.title?.auto ?? true) {\n\t\t\tconst title = await generateTitle(\n\t\t\t\tlocalStorage.token,\n\t\t\t\tselectedModels[0],\n\t\t\t\tuserPrompt,\n\t\t\t\t$chatId\n\t\t\t).catch((error) => {\n\t\t\t\tconsole.error(error);\n\t\t\t\treturn 'New Chat';\n\t\t\t});\n\n\t\t\treturn title;\n\t\t} else {\n\t\t\treturn `${userPrompt}`;\n\t\t}\n\t};\n\n\tconst setChatTitle = async (_chatId, _title) => {\n\t\tif (_chatId === $chatId) {\n\t\t\ttitle = _title;\n\t\t}\n\n\t\tif ($settings.saveChatHistory ?? true) {\n\t\t\tchat = await updateChatById(localStorage.token, _chatId, { title: _title });\n\t\t\tawait chats.set(await getChatList(localStorage.token));\n\t\t}\n\t};\n\n\tconst getWebSearchResults = async (model: string, parentId: string, responseId: string) => {\n\t\tconst responseMessage = history.messages[responseId];\n\t\tconst userMessage = history.messages[parentId];\n\n\t\tresponseMessage.statusHistory = [\n\t\t\t{\n\t\t\t\tdone: false,\n\t\t\t\taction: 'web_search',\n\t\t\t\tdescription: $i18n.t('Generating search query')\n\t\t\t}\n\t\t];\n\t\tmessages = messages;\n\n\t\tconst prompt = userMessage.content;\n\t\tlet searchQuery = await generateSearchQuery(localStorage.token, model, messages, prompt).catch(\n\t\t\t(error) => {\n\t\t\t\tconsole.log(error);\n\t\t\t\treturn prompt;\n\t\t\t}\n\t\t);\n\n\t\tif (!searchQuery) {\n\t\t\ttoast.warning($i18n.t('No search query generated'));\n\t\t\tresponseMessage.statusHistory.push({\n\t\t\t\tdone: true,\n\t\t\t\terror: true,\n\t\t\t\taction: 'web_search',\n\t\t\t\tdescription: 'No search query generated'\n\t\t\t});\n\n\t\t\tmessages = messages;\n\t\t}\n\n\t\tresponseMessage.statusHistory.push({\n\t\t\tdone: false,\n\t\t\taction: 'web_search',\n\t\t\tdescription: $i18n.t(`Searching \"{{searchQuery}}\"`, { searchQuery })\n\t\t});\n\t\tmessages = messages;\n\n\t\tconst results = await runWebSearch(localStorage.token, searchQuery).catch((error) => {\n\t\t\tconsole.log(error);\n\t\t\ttoast.error(error);\n\n\t\t\treturn null;\n\t\t});\n\n\t\tif (results) {\n\t\t\tresponseMessage.statusHistory.push({\n\t\t\t\tdone: true,\n\t\t\t\taction: 'web_search',\n\t\t\t\tdescription: $i18n.t('Searched {{count}} sites', { count: results.filenames.length }),\n\t\t\t\tquery: searchQuery,\n\t\t\t\turls: results.filenames\n\t\t\t});\n\n\t\t\tif (responseMessage?.files ?? undefined === undefined) {\n\t\t\t\tresponseMessage.files = [];\n\t\t\t}\n\n\t\t\tresponseMessage.files.push({\n\t\t\t\tcollection_name: results.collection_name,\n\t\t\t\tname: searchQuery,\n\t\t\t\ttype: 'web_search_results',\n\t\t\t\turls: results.filenames\n\t\t\t});\n\n\t\t\tmessages = messages;\n\t\t} else {\n\t\t\tresponseMessage.statusHistory.push({\n\t\t\t\tdone: true,\n\t\t\t\terror: true,\n\t\t\t\taction: 'web_search',\n\t\t\t\tdescription: 'No search results found'\n\t\t\t});\n\t\t\tmessages = messages;\n\t\t}\n\t};\n\n\tconst getTags = async () => {\n\t\treturn await getTagsById(localStorage.token, $chatId).catch(async (error) => {\n\t\t\treturn [];\n\t\t});\n\t};\n</script>\n\n<svelte:head>\n\t<title>\n\t\t{title\n\t\t\t? `${title.length > 30 ? `${title.slice(0, 30)}...` : title} | ${$WEBUI_NAME}`\n\t\t\t: `${$WEBUI_NAME}`}\n\t</title>\n</svelte:head>\n\n<audio id=\"audioElement\" src=\"\" style=\"display: none;\" />\n\n<EventConfirmDialog\n\tbind:show={showEventConfirmation}\n\ttitle={eventConfirmationTitle}\n\tmessage={eventConfirmationMessage}\n\tinput={eventConfirmationInput}\n\tinputPlaceholder={eventConfirmationInputPlaceholder}\n\ton:confirm={(e) => {\n\t\tif (e.detail) {\n\t\t\teventCallback(e.detail);\n\t\t} else {\n\t\t\teventCallback(true);\n\t\t}\n\t}}\n\ton:cancel={() => {\n\t\teventCallback(false);\n\t}}\n/>\n\n{#if $showCallOverlay}\n\t<CallOverlay\n\t\t{submitPrompt}\n\t\t{stopResponse}\n\t\tbind:files\n\t\tmodelId={selectedModelIds?.at(0) ?? null}\n\t\tchatId={$chatId}\n\t\t{eventTarget}\n\t/>\n{/if}\n\n{#if !chatIdProp || (loaded && chatIdProp)}\n\t<div\n\t\tclass=\"h-screen max-h-[100dvh] {$showSidebar\n\t\t\t? 'md:max-w-[calc(100%-260px)]'\n\t\t\t: ''} w-full max-w-full flex flex-col\"\n\t>\n\t\t{#if $settings?.backgroundImageUrl ?? null}\n\t\t\t<div\n\t\t\t\tclass=\"absolute {$showSidebar\n\t\t\t\t\t? 'md:max-w-[calc(100%-260px)] md:translate-x-[260px]'\n\t\t\t\t\t: ''} top-0 left-0 w-full h-full bg-cover bg-center bg-no-repeat\"\n\t\t\t\tstyle=\"background-image: url({$settings.backgroundImageUrl})  \"\n\t\t\t/>\n\n\t\t\t<div\n\t\t\t\tclass=\"absolute top-0 left-0 w-full h-full bg-gradient-to-t from-white to-white/85 dark:from-gray-900 dark:to-[#171717]/90 z-0\"\n\t\t\t/>\n\t\t{/if}\n\n\t\t<Navbar\n\t\t\t{title}\n\t\t\tbind:selectedModels\n\t\t\tbind:showModelSelector\n\t\t\tbind:showControls\n\t\t\tshareEnabled={messages.length > 0}\n\t\t\t{chat}\n\t\t\t{initNewChat}\n\t\t/>\n\n\t\t{#if $banners.length > 0 && messages.length === 0 && !$chatId && selectedModels.length <= 1}\n\t\t\t<div\n\t\t\t\tclass=\"absolute top-[4.25rem] w-full {$showSidebar\n\t\t\t\t\t? 'md:max-w-[calc(100%-260px)]'\n\t\t\t\t\t: ''} {showControls ? 'lg:pr-[24rem]' : ''} z-20\"\n\t\t\t>\n\t\t\t\t<div class=\" flex flex-col gap-1 w-full\">\n\t\t\t\t\t{#each $banners.filter( (b) => (b.dismissible ? !JSON.parse(localStorage.getItem('dismissedBannerIds') ?? '[]').includes(b.id) : true) ) as banner}\n\t\t\t\t\t\t<Banner\n\t\t\t\t\t\t\t{banner}\n\t\t\t\t\t\t\ton:dismiss={(e) => {\n\t\t\t\t\t\t\t\tconst bannerId = e.detail;\n\n\t\t\t\t\t\t\t\tlocalStorage.setItem(\n\t\t\t\t\t\t\t\t\t'dismissedBannerIds',\n\t\t\t\t\t\t\t\t\tJSON.stringify(\n\t\t\t\t\t\t\t\t\t\t[\n\t\t\t\t\t\t\t\t\t\t\tbannerId,\n\t\t\t\t\t\t\t\t\t\t\t...JSON.parse(localStorage.getItem('dismissedBannerIds') ?? '[]')\n\t\t\t\t\t\t\t\t\t\t].filter((id) => $banners.find((b) => b.id === id))\n\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t/>\n\t\t\t\t\t{/each}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t{/if}\n\n\t\t<div class=\"flex flex-col flex-auto z-10\">\n\t\t\t<div\n\t\t\t\tclass=\" pb-2.5 flex flex-col justify-between w-full flex-auto overflow-auto h-0 max-w-full z-10 scrollbar-hidden {showControls\n\t\t\t\t\t? 'lg:pr-[24rem]'\n\t\t\t\t\t: ''}\"\n\t\t\t\tid=\"messages-container\"\n\t\t\t\tbind:this={messagesContainerElement}\n\t\t\t\ton:scroll={(e) => {\n\t\t\t\t\tautoScroll =\n\t\t\t\t\t\tmessagesContainerElement.scrollHeight - messagesContainerElement.scrollTop <=\n\t\t\t\t\t\tmessagesContainerElement.clientHeight + 5;\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<div class=\" h-full w-full flex flex-col {chatIdProp ? 'py-4' : 'pt-2 pb-4'}\">\n\t\t\t\t\t<Messages\n\t\t\t\t\t\tchatId={$chatId}\n\t\t\t\t\t\t{selectedModels}\n\t\t\t\t\t\t{processing}\n\t\t\t\t\t\tbind:history\n\t\t\t\t\t\tbind:messages\n\t\t\t\t\t\tbind:autoScroll\n\t\t\t\t\t\tbind:prompt\n\t\t\t\t\t\tbottomPadding={files.length > 0}\n\t\t\t\t\t\t{sendPrompt}\n\t\t\t\t\t\t{continueGeneration}\n\t\t\t\t\t\t{regenerateResponse}\n\t\t\t\t\t\t{chatActionHandler}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class={showControls ? 'lg:pr-[24rem]' : ''}>\n\t\t\t\t<MessageInput\n\t\t\t\t\tbind:files\n\t\t\t\t\tbind:prompt\n\t\t\t\t\tbind:autoScroll\n\t\t\t\t\tbind:selectedToolIds\n\t\t\t\t\tbind:webSearchEnabled\n\t\t\t\t\tbind:atSelectedModel\n\t\t\t\t\tavailableToolIds={selectedModelIds.reduce((a, e, i, arr) => {\n\t\t\t\t\t\tconst model = $models.find((m) => m.id === e);\n\t\t\t\t\t\tif (model?.info?.meta?.toolIds ?? false) {\n\t\t\t\t\t\t\treturn [...new Set([...a, ...model.info.meta.toolIds])];\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn a;\n\t\t\t\t\t}, [])}\n\t\t\t\t\ttransparentBackground={$settings?.backgroundImageUrl ?? false}\n\t\t\t\t\t{selectedModels}\n\t\t\t\t\t{messages}\n\t\t\t\t\t{submitPrompt}\n\t\t\t\t\t{stopResponse}\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<ChatControls\n\t\t\tmodels={selectedModelIds.reduce((a, e, i, arr) => {\n\t\t\t\tconst model = $models.find((m) => m.id === e);\n\t\t\t\tif (model) {\n\t\t\t\t\treturn [...a, model];\n\t\t\t\t}\n\t\t\t\treturn a;\n\t\t\t}, [])}\n\t\t\tbind:show={showControls}\n\t\t\tbind:chatFiles\n\t\t\tbind:params\n\t\t\tbind:valves\n\t\t/>\n\t</div>\n{/if}\n","<script lang=\"ts\">\n\timport { getContext } from 'svelte';\n\timport Modal from '../common/Modal.svelte';\n\n\tconst i18n = getContext('i18n');\n\n\texport let show = false;\n</script>\n\n<Modal bind:show>\n\t<div class=\"text-gray-700 dark:text-gray-100\">\n\t\t<div class=\" flex justify-between dark:text-gray-300 px-5 pt-4\">\n\t\t\t<div class=\" text-lg font-medium self-center\">{$i18n.t('Keyboard shortcuts')}</div>\n\t\t\t<button\n\t\t\t\tclass=\"self-center\"\n\t\t\t\ton:click={() => {\n\t\t\t\t\tshow = false;\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<svg\n\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\tviewBox=\"0 0 20 20\"\n\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\tclass=\"w-5 h-5\"\n\t\t\t\t>\n\t\t\t\t\t<path\n\t\t\t\t\t\td=\"M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z\"\n\t\t\t\t\t/>\n\t\t\t\t</svg>\n\t\t\t</button>\n\t\t</div>\n\n\t\t<div class=\"flex flex-col md:flex-row w-full p-5 md:space-x-4 dark:text-gray-200\">\n\t\t\t<div class=\" flex flex-col w-full sm:flex-row sm:justify-center sm:space-x-6\">\n\t\t\t\t<div class=\"flex flex-col space-y-3 w-full self-start\">\n\t\t\t\t\t<div class=\"w-full flex justify-between items-center\">\n\t\t\t\t\t\t<div class=\" text-sm\">{$i18n.t('Open new chat')}</div>\n\n\t\t\t\t\t\t<div class=\"flex space-x-1 text-xs\">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\" h-fit py-1 px-2 flex items-center justify-center rounded border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\tCtrl/\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\" h-fit py-1 px-2 flex items-center justify-center rounded border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\tShift\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\" h-fit py-1 px-2 flex items-center justify-center rounded border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\tO\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"w-full flex justify-between items-center\">\n\t\t\t\t\t\t<div class=\" text-sm\">{$i18n.t('Focus chat input')}</div>\n\n\t\t\t\t\t\t<div class=\"flex space-x-1 text-xs\">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\" h-fit py-1 px-2 flex items-center justify-center rounded border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\tShift\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\" h-fit py-1 px-2 flex items-center justify-center rounded border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\tEsc\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"w-full flex justify-between items-center\">\n\t\t\t\t\t\t<div class=\" text-sm\">{$i18n.t('Copy last code block')}</div>\n\n\t\t\t\t\t\t<div class=\"flex space-x-1 text-xs\">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\" h-fit py-1 px-2 flex items-center justify-center rounded border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\tCtrl/\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\" h-fit py-1 px-2 flex items-center justify-center rounded border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\tShift\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\" h-fit py-1 px-2 flex items-center justify-center rounded border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t;\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"w-full flex justify-between items-center\">\n\t\t\t\t\t\t<div class=\" text-sm\">{$i18n.t('Copy last response')}</div>\n\n\t\t\t\t\t\t<div class=\"flex space-x-1 text-xs\">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\" h-fit py-1 px-2 flex items-center justify-center rounded border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\tCtrl/\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\" h-fit py-1 px-2 flex items-center justify-center rounded border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\tShift\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\" h-fit py-1 px-2 flex items-center justify-center rounded border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\tC\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"flex flex-col space-y-3 w-full self-start\">\n\t\t\t\t\t<div class=\"w-full flex justify-between items-center\">\n\t\t\t\t\t\t<div class=\" text-sm\">{$i18n.t('Toggle settings')}</div>\n\n\t\t\t\t\t\t<div class=\"flex space-x-1 text-xs\">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\" h-fit py-1 px-2 flex items-center justify-center rounded border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\tCtrl/\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\" h-fit py-1 px-2 flex items-center justify-center rounded border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t.\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"w-full flex justify-between items-center\">\n\t\t\t\t\t\t<div class=\" text-sm\">{$i18n.t('Toggle sidebar')}</div>\n\n\t\t\t\t\t\t<div class=\"flex space-x-1 text-xs\">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\" h-fit py-1 px-2 flex items-center justify-center rounded border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\tCtrl/\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\" h-fit py-1 px-2 flex items-center justify-center rounded border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\tShift\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\" h-fit py-1 px-2 flex items-center justify-center rounded border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\tS\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"w-full flex justify-between items-center\">\n\t\t\t\t\t\t<div class=\" text-sm\">{$i18n.t('Delete chat')}</div>\n\n\t\t\t\t\t\t<div class=\"flex space-x-1 text-xs\">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\" h-fit py-1 px-2 flex items-center justify-center rounded border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\tCtrl/\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\" h-fit py-1 px-2 flex items-center justify-center rounded border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\tShift\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\" h-fit py-1 px-2 flex items-center justify-center rounded border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"w-full flex justify-between items-center\">\n\t\t\t\t\t\t<div class=\" text-sm\">{$i18n.t('Show shortcuts')}</div>\n\n\t\t\t\t\t\t<div class=\"flex space-x-1 text-xs\">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\" h-fit py-1 px-2 flex items-center justify-center rounded border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\tCtrl/\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\" h-fit py-1 px-2 flex items-center justify-center rounded border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t/\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class=\" flex justify-between dark:text-gray-300 px-5\">\n\t\t\t<div class=\" text-lg font-medium self-center\">{$i18n.t('Input commands')}</div>\n\t\t</div>\n\n\t\t<div class=\"flex flex-col md:flex-row w-full p-5 md:space-x-4 dark:text-gray-200\">\n\t\t\t<div class=\" flex flex-col w-full sm:flex-row sm:justify-center sm:space-x-6\">\n\t\t\t\t<div class=\"flex flex-col space-y-3 w-full self-start\">\n\t\t\t\t\t<div class=\"w-full flex justify-between items-center\">\n\t\t\t\t\t\t<div class=\" text-sm\">\n\t\t\t\t\t\t\t{$i18n.t('Attach file')}\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class=\"flex space-x-1 text-xs\">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\" h-fit py-1 px-2 flex items-center justify-center rounded border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t#\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"w-full flex justify-between items-center\">\n\t\t\t\t\t\t<div class=\" text-sm\">\n\t\t\t\t\t\t\t{$i18n.t('Add custom prompt')}\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class=\"flex space-x-1 text-xs\">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\" h-fit py-1 px-2 flex items-center justify-center rounded border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t/\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"w-full flex justify-between items-center\">\n\t\t\t\t\t\t<div class=\" text-sm\">\n\t\t\t\t\t\t\t{$i18n.t('Select model')}\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class=\"flex space-x-1 text-xs\">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\" h-fit py-1 px-2 flex items-center justify-center rounded border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t@\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</Modal>\n\n<style>\n\tinput::-webkit-outer-spin-button,\n\tinput::-webkit-inner-spin-button {\n\t\t/* display: none; <- Crashes Chrome on hover */\n\t\t-webkit-appearance: none;\n\t\tmargin: 0; /* <-- Apparently some margin are still there even though it's hidden */\n\t}\n\n\t.tabs::-webkit-scrollbar {\n\t\tdisplay: none; /* for Chrome, Safari and Opera */\n\t}\n\n\t.tabs {\n\t\t-ms-overflow-style: none; /* IE and Edge */\n\t\tscrollbar-width: none; /* Firefox */\n\t}\n\n\tinput[type='number'] {\n\t\t-moz-appearance: textfield; /* Firefox */\n\t}\n</style>\n","<script lang=\"ts\">\n\texport let className = 'w-4 h-4';\n\texport let strokeWidth = '2';\n</script>\n\n<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tfill=\"none\"\n\tviewBox=\"0 0 24 24\"\n\tstroke-width={strokeWidth}\n\tstroke=\"currentColor\"\n\tclass={className}\n>\n\t<path\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t\td=\"M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 5.25h.008v.008H12v-.008Z\"\n\t/>\n</svg>\n","<script lang=\"ts\">\n\texport let className = 'size-4';\n\texport let strokeWidth = '2';\n</script>\n\n<svg\n\taria-hidden=\"true\"\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tfill=\"currentColor\"\n\tviewBox=\"0 0 24 24\"\n\tstroke-width={strokeWidth}\n\tclass={className}\n>\n\t<path\n\t\tfill-rule=\"evenodd\"\n\t\td=\"M2 7a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V7Zm5.01 1H5v2.01h2.01V8Zm3 0H8v2.01h2.01V8Zm3 0H11v2.01h2.01V8Zm3 0H14v2.01h2.01V8Zm3 0H17v2.01h2.01V8Zm-12 3H5v2.01h2.01V11Zm3 0H8v2.01h2.01V11Zm3 0H11v2.01h2.01V11Zm3 0H14v2.01h2.01V11Zm3 0H17v2.01h2.01V11Zm-12 3H5v2.01h2.01V14ZM8 14l-.001 2 8.011.01V14H8Zm11.01 0H17v2.01h2.01V14Z\"\n\t\tclip-rule=\"evenodd\"\n\t/>\n</svg>\n","<script lang=\"ts\">\n\timport { DropdownMenu } from 'bits-ui';\n\timport { getContext } from 'svelte';\n\n\timport { showSettings } from '$lib/stores';\n\timport { flyAndScale } from '$lib/utils/transitions';\n\n\timport Dropdown from '$lib/components/common/Dropdown.svelte';\n\timport QuestionMarkCircle from '$lib/components/icons/QuestionMarkCircle.svelte';\n\timport Lifebuoy from '$lib/components/icons/Lifebuoy.svelte';\n\timport Keyboard from '$lib/components/icons/Keyboard.svelte';\n\tconst i18n = getContext('i18n');\n\n\texport let showDocsHandler: Function;\n\texport let showShortcutsHandler: Function;\n\n\texport let onClose: Function = () => {};\n</script>\n\n<Dropdown\n\ton:change={(e) => {\n\t\tif (e.detail === false) {\n\t\t\tonClose();\n\t\t}\n\t}}\n>\n\t<slot />\n\n\t<div slot=\"content\">\n\t\t<DropdownMenu.Content\n\t\t\tclass=\"w-full max-w-[200px] rounded-xl px-1 py-1.5 border border-gray-300/30 dark:border-gray-700/50 z-50 bg-white dark:bg-gray-850 dark:text-white shadow-lg\"\n\t\t\tsideOffset={4}\n\t\t\tside=\"top\"\n\t\t\talign=\"end\"\n\t\t\ttransition={flyAndScale}\n\t\t>\n\t\t\t<DropdownMenu.Item\n\t\t\t\tclass=\"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md\"\n\t\t\t\tid=\"chat-share-button\"\n\t\t\t\ton:click={() => {\n\t\t\t\t\twindow.open('https://docs.openwebui.com', '_blank');\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<QuestionMarkCircle className=\"size-5\" />\n\t\t\t\t<div class=\"flex items-center\">{$i18n.t('Documentation')}</div>\n\t\t\t</DropdownMenu.Item>\n\n\t\t\t<DropdownMenu.Item\n\t\t\t\tclass=\"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md\"\n\t\t\t\tid=\"chat-share-button\"\n\t\t\t\ton:click={() => {\n\t\t\t\t\tshowShortcutsHandler();\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<Keyboard className=\"size-5\" />\n\t\t\t\t<div class=\"flex items-center\">{$i18n.t('Keyboard shortcuts')}</div>\n\t\t\t</DropdownMenu.Item>\n\t\t</DropdownMenu.Content>\n\t</div>\n</Dropdown>\n","<script lang=\"ts\">\n\timport { onMount, tick, getContext } from 'svelte';\n\n\tconst i18n = getContext('i18n');\n\n\timport ShortcutsModal from '../chat/ShortcutsModal.svelte';\n\timport Tooltip from '../common/Tooltip.svelte';\n\timport HelpMenu from './Help/HelpMenu.svelte';\n\n\tlet showShortcuts = false;\n</script>\n\n<div class=\" hidden lg:flex fixed bottom-0 right-0 px-2 py-2 z-20\">\n\t<button\n\t\tid=\"show-shortcuts-button\"\n\t\tclass=\"hidden\"\n\t\ton:click={() => {\n\t\t\tshowShortcuts = !showShortcuts;\n\t\t}}\n\t/>\n\n\t<HelpMenu\n\t\tshowDocsHandler={() => {\n\t\t\tshowShortcuts = !showShortcuts;\n\t\t}}\n\t\tshowShortcutsHandler={() => {\n\t\t\tshowShortcuts = !showShortcuts;\n\t\t}}\n\t>\n\t\t<Tooltip content={$i18n.t('Help')} placement=\"left\">\n\t\t\t<button\n\t\t\t\tclass=\"text-gray-600 dark:text-gray-300 bg-gray-300/20 size-5 flex items-center justify-center text-[0.7rem] rounded-full\"\n\t\t\t>\n\t\t\t\t?\n\t\t\t</button>\n\t\t</Tooltip>\n\t</HelpMenu>\n</div>\n\n<ShortcutsModal bind:show={showShortcuts} />\n"],"names":["ctx","disabled","$$props","open","onOpenChange","updateOption","ids","subOpen","setSubMenuCtx","next","$$invalidate","idValues","derived","$menuId","$triggerId","div_levels","insert_hydration","target","div","anchor","transition","transitionConfig","inTransition","inTransitionConfig","outTransition","outTransitionConfig","asChild","id","side","align","sideOffset","alignOffset","collisionPadding","avoidCollisions","collisionBoundary","sameWidth","fitViewport","strategy","overlap","el","subMenu","getAttrs","getSubmenuCtx","dispatch","createDispatcher","attrs","$$value","builder","$subMenu","updateSubPositioning","subTrigger","options","getSubTrigger","disabledStore","$subTrigger","disabledAttrs","$disabledStore","createParser","onParse","isFirstChunk","buffer","startingPosition","startingFieldLength","eventId","eventName","data","reset","feed","chunk","hasBom","BOM","length","position","discardTrailingNewline","lineLength","fieldLength","character","index","parseEventStreamLine","lineBuffer","noValue","field","step","valueLength","value","retry","charCode","EventSourceParserStream","parser","controller","event","createOpenAITextStream","responseBody","splitLargeDeltas","eventStream","iterator","openAIStreamToIterator","streamLargeDeltasAsRandomChunks","reader","done","parsedData","_c","_b","_a","e","textStreamUpdate","content","chunkSize","sleep","ms","resolve","create_if_block_1","t0_value","t3_value","if_block0","create_if_block_4","if_block1","create_if_block_3","if_block2","create_if_block_2","attr","div0","div0_class_value","div5","append_hydration","div3","div1","div2","div4","current","dirty","set_data","t0","t3","div5_transition","create_bidirectional_transition","fade","button","create_if_block","createEventDispatcher","banner","dismissed","mounted","classNames","dismiss","onMount","i","div8","div7","div6","t4","t4_value","t2_value","button_class_value","t2","i18n","getContext","files","prompt","selectedCommandIdx","filteredPromptCommands","selectUp","selectDown","confirmCommand","command","text","clipboardText","err","toast","$i18n","clipboardItems","imageUrl","item","type","blob","chatInputElement","tick","words","findWordIndices","word","commandIdx","$prompts","p","a","b","show_if","func","show_if_1","t1_value","t6_value","t1","t6","selectedIdx","filteredItems","filteredDocs","collections","findByName","obj","confirmSelect","doc","removeFirstHashWord","confirmSelectWeb","url","confirmSelectYoutube","docIdx","isValidHttpUrl","$documents","arr","tag","filteredCollections","collection","user","chatInputPlaceholder","messages","filteredModels","model","modelIdx","$models","svg","path","className","strokeWidth","path0","path1","hr","each_blocks","t","t_value","tooltip_changes","flyAndScale","uploadFilesHandler","selectedToolIds","webSearchEnabled","tools","onClose","show","toolId","div_class_value","set_style","div6_class_value","VISUALIZER_BUFFER_LENGTH","recording","loading","confirmed","durationSeconds","durationCounter","transcription","startDurationCounter","stopDurationCounter","formatSeconds","seconds","minutes","remainingSeconds","formattedSeconds","speechRecognition","mediaRecorder","audioChunks","MIN_DECIBELS","visualizerData","calculateRMS","sumSquares","normalizedValue","normalizeRMS","rms","scaledRMS","analyseAudio","stream","audioContext","audioStreamSource","analyser","bufferLength","domainData","timeDomainData","processFrame","rmsLevel","transcribeHandler","audioBlob","file","blobToFile","res","transcribeAudio","error","startRecording","$settings","$config","inactivityTimeout","timeoutId","transcript","confirmRecording","stopRecording","overlayElement","src_url_equal","img","img_src_value","WEBUI_BASE_URL","span","textarea","textarea_placeholder_value","form","inputmenu_changes","fileitem_changes","create_if_block_6","button_disabled_value","create_if_block_10","create_if_block_7","input","t7","t7_value","transparentBackground","submitPrompt","stopResponse","autoScroll","atSelectedModel","selectedModels","chatTextAreaElement","filesInputElement","promptsElement","documentsElement","modelsElement","inputFiles","dragged","availableToolIds","visionCapableModels","scrollToBottom","element","uploadFileHandler","uploadedFile","uploadFile","fileItem","WEBUI_API_BASE_URL","SUPPORTED_FILE_TYPE","SUPPORTED_FILE_EXTENSIONS","processFileItem","processDocToVectorDB","uploadWeb","uploadWebToVectorDB","f","uploadYoutubeTranscription","uploadYoutubeTranscriptionToVectorDB","dropZone","handleKeyDown","onDragOver","onDragLeave","onDrop","response","func_1","fileIdx","func_2","$_user","$mobile","isCtrlPressed","regenerateButton","userMessageElement","editButton","commandOptionButton","fullPrompt","clipboardData","showCallOverlay","_d","m","selector_changes","if_block","showSetDefault","saveDefaultModel","it","settings","updateUserSettings","selectedModelIdx","tags","Tags","tags_changes","saveAs","fileSaver","shareEnabled","shareHandler","downloadHandler","chat","downloadTxt","_chat","chatText","message","downloadPdf","downloadChatAsPDF","downloadJSONExport","usermenu_changes","nav","initNewChat","title","$WEBUI_NAME","showModelSelector","showControls","showShareChatModal","showDownloadChatModal","showSidebar","$showSidebar","showArchivedChats","devices","device","button0","button1","create_if_block_8","create_if_block_9","_f","_e","_i","_h","_g","style","circle0","circle1","circle2","video","canvas","create_if_block_5","eventTarget","chatId","modelId","assistantSpeaking","emoji","camera","cameraStream","chatStreaming","hasStartedSpeaking","videoInputDevices","selectedVideoInputDeviceId","getVideoInputDevices","startCamera","startVideoStream","stopVideoStream","track","takeScreenshot","context","dataURL","stopCamera","_responses","stopRecordingCallback","_continue","$showCallOverlay","_audioChunks","lastSoundTime","stopAllAudio","finishedMessages","currentMessageId","currentUtterance","speakSpeechSynthesisHandler","voices","getVoicesLoop","voice","v","r","playAudio","audio","audioElement","audioAbortController","audioCache","emojiCache","fetchAudio","generateEmoji","synthesizeOpenAISpeech","blobUrl","monitorAndPlayAudio","signal","chatStartHandler","chatEventHandler","chatFinishHandler","valves_1_changes","div9","set_input_value","t5","t5_value","t9","t9_value","models","chatFiles","valves","params","div1_intro","create_in_transition","slide","largeScreen","mediaQuery","handleMediaQuery","calloverlay_changes","messageinput_changes","chatcontrols_changes","each_value","ensure_array_like","document_1","title_value","processing","chatIdProp","loaded","stopResponseFlag","messagesContainerElement","showEventConfirmation","eventConfirmationTitle","eventConfirmationMessage","eventConfirmationInput","eventConfirmationInputPlaceholder","eventCallback","selectedModelIds","history","cb","$chatId","onMessageHandler","inputElement","$socket","goto","$page","userSettings","getUserSettings","chatInput","loadChat","getChatById","getTags","chatContent","convertMessagesToHistory","createMessagesList","responseMessageId","chatCompletedHandler","mermaid","chatCompleted","updateChatById","chats","getChatList","chatActionHandler","actionId","chatAction","getChatEventEmitter","userPrompt","_raw","_files","array","userMessageId","uuidv4","userMessage","mIdx","sendPrompt","parentId","newChat","responseMessageIds","responseMessage","createNewChat","_chatId","userContext","queryMemory","acc","createdAtTimestamp","createdAtDate","chatEventEmitter","getWebSearchResults","_response","sendPromptOpenAI","sendPromptOllama","messagesBody","promptTemplate","$user","getAndUpdateUserLocation","idx","baseMessage","imageUrls","lastImageIndex","generateChatCompletion","str","splitStream","lines","line","sentences","extractSentencesForAudio","notification","copyToClipboard","lastSentence","_title","generateChatTitle","setChatTitle","generateOpenAIChatCompletion","_j","_k","textStream","lastUsage","update","citations","usage","handleOpenAIError","_l","_m","errorMessage","innerError","regenerateResponse","continueGeneration","generateTitle","responseId","searchQuery","generateSearchQuery","results","runWebSearch","getTagsById","bannerId","$banners","_messages","currentMessage","div68","div50","div49","div25","div12","div11","div18","div13","div17","div24","div19","div23","div48","div30","div26","div29","div36","div31","div35","div42","div37","div41","div47","div43","div46","div52","div51","div67","div66","div65","div56","div53","div55","div60","div57","div59","div64","div61","div63","t11","t11_value","t17","t17_value","t25","t25_value","t33","t33_value","t39","t39_value","t47","t47_value","t55","t55_value","t61","t61_value","t63","t63_value","t67","t67_value","t71","t71_value","showDocsHandler","showShortcutsHandler","showShortcuts"],"mappings":"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","x_google_ignoreList":[0,1,2,3,4]}